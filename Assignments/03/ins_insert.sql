
insert into a03_title (id, title) values ( '38e956c7-ccbf-4990-4ced-f2961e9525d4', 'Interactive - 01 - Create Table'); --x1--
insert into a03_tag ( id, tag ) values ( 'b42e223f-33d2-47c6-4b21-ef78aa5023cf', 'create table' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( 'b42e223f-33d2-47c6-4b21-ef78aa5023cf', '38e956c7-ccbf-4990-4ced-f2961e9525d4' );
insert into a03_tag ( id, tag ) values ( '75f25dbf-a5ab-4fd2-557e-2e9203ceb120', 'type text' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '75f25dbf-a5ab-4fd2-557e-2e9203ceb120', '38e956c7-ccbf-4990-4ced-f2961e9525d4' );
insert into a03_tag ( id, tag ) values ( '5d6005c5-b4b9-4703-54e7-627aab590b05', 'type int' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '5d6005c5-b4b9-4703-54e7-627aab590b05', '38e956c7-ccbf-4990-4ced-f2961e9525d4' );
insert into a03_tag ( id, tag ) values ( '295abbf7-1e22-4dcf-7a5f-25fdff781df8', 'type varchar' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '295abbf7-1e22-4dcf-7a5f-25fdff781df8', '38e956c7-ccbf-4990-4ced-f2961e9525d4' );
insert into a03_tag ( id, tag ) values ( 'c47e5e69-9123-4a80-669b-171b34fe17f5', 'hw01' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( 'c47e5e69-9123-4a80-669b-171b34fe17f5', '38e956c7-ccbf-4990-4ced-f2961e9525d4' );
update a03_title set body = '{"Lesson":"\u003cstyle\u003e \n.pagebreak { page-break-before: always; } \n.half { height: 200px; } \n\u003c/style\u003e \n \n\n\u003ch1\u003eInteractive - 01 - Create Table\u003c/h1\u003e\n\n\u003cp\u003eCreate a table with 3 columns.  The table name will be \u0026ldquo;name_list\u0026rdquo;.\nThe columns are:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003ereal_name a text column\u003c/li\u003e\n\u003cli\u003eage an integer\u003c/li\u003e\n\n\u003cli\u003e\u003cp\u003estate a 2 character field for a US state code.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003ecreate table \u0026lt;name\u0026gt; ( \n\t\u0026lt;column\u0026gt;,\t \n\t\u0026lt;column\u0026gt;,\t \n\t\u0026lt;column\u0026gt;,\t \n\t... \n\t\u0026lt;column\u0026gt; \n); \n\u003c/code\u003e\u003c/pre\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eThe columns are a comma \u003ccode\u003e,\u003c/code\u003e separated list.   The set of\ncolumns tars with a \u003ccode\u003e(\u003c/code\u003e and ends with a \u003ccode\u003e)\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003eA \u003ccode\u003e;\u003c/code\u003e (semicolon) is used to mark the end of the statement.\u003c/p\u003e\n\n\u003cp\u003eOfficially this is call the Data Definition Language or DDL.\u003c/p\u003e\n\n\u003cp\u003eWe have to declare what we want to store before storing it.\u003c/p\u003e\n\n\u003cp\u003eWe will get back to data-types and SQL in a future homework.\u003c/p\u003e\n\n\u003cp\u003eso with 3 columns\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003e \nDROP TABLE if exists name_list ; \n \nCREATE TABLE name_list ( \n\treal_name text,\t \n\tage int,\t \n\tstate varchar(2) \n); \n \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eBook: Pages 5 to 7\u003c/p\u003e\n\n\u003ch4\u003eTags: \u0026ldquo;create table\u0026rdquo;,\u0026ldquo;type text\u0026rdquo;,\u0026ldquo;type int\u0026rdquo;,\u0026ldquo;type varchar\u0026rdquo;,\u0026ldquo;hw01\u0026rdquo;\u003c/h4\u003e\n","Lesson_no":1}' where title_id = '38e956c7-ccbf-4990-4ced-f2961e9525d4';


insert into a03_title (id, title) values ( '044fb48b-25d8-4ac6-7d97-33cc363980cb', 'Interactive - 02 - Insert data into name_list'); --x1--
insert into a03_tag ( id, tag ) values ( 'eee3cba2-3a18-4760-49f7-13a55bdf4c4b', 'hw02' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( 'eee3cba2-3a18-4760-49f7-13a55bdf4c4b', '044fb48b-25d8-4ac6-7d97-33cc363980cb' );
insert into a03_tag ( id, tag ) values ( '5a4afd48-c48d-431f-57e7-171f237012cc', 'insert' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '5a4afd48-c48d-431f-57e7-171f237012cc', '044fb48b-25d8-4ac6-7d97-33cc363980cb' );
update a03_title set body = '{"Lesson":"\u003cstyle\u003e \n.pagebreak { page-break-before: always; } \n.half { height: 200px; } \n\u003c/style\u003e \n \n\n\u003ch1\u003eInteractive - 02 - Insert data into name_list\u003c/h1\u003e\n\n\u003cp\u003eInsert some data into the table.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003einsert into \u0026lt;name\u0026gt; ( \u0026lt;column-name\u0026gt;, \u0026lt;column-name\u0026gt;, .... ) values \n\t( \u0026lt;colun-data1\u0026gt;, \u0026lt;colun-data2\u0026gt;, ... ), \n\t( \u0026lt;colun-row2\u0026gt;, \u0026lt;colun-row2\u0026gt;, ... ), \n\t( \u0026lt;colun-row2\u0026gt;, \u0026lt;colun-row2\u0026gt;, ... ) \n; \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eso our example, we will use all the columns so we can leave the\nlist of columns out  and just put the data in the table declared\norder.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eINSERT INTO name_list values \n\t( ''bob true'',            22, ''WY'' ), \n\t( ''Jane True'',           20, ''WY'' ), \n\t( ''Tom Ace'',             31, ''NJ'' ), \n\t( ''Steve Pen'',           33, ''NJ'' ), \n\t( ''Laura Jean Alkinoos'', 34, ''PA'' ) \n; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eand a single row (note that the column order\nis chained).  It is better to list the columns\nso that if the table is changed the data can\nstill be loaded.  It is possible to add new columns to a table\nand break old code - so it is better to have:\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003einsert into name_list ( real_name, age, state ) values \n\t( ''bob true'',            22, ''WY'' ), \n... \n... \n... \n... \n\t( ''Laura Jean Alkinoos'', 34, ''PA'' ) \n; \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eAlso note that it is intentional at this point that \u003ccode\u003ebob true\u003c/code\u003e is all lower\ncase.  We will fix that in a little bit.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003e \nINSERT INTO name_list ( real_name, state, age ) \n\tvalues\t( ''Philip Schlump'', ''WY'', 62 ); \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eEach set of data that we inset is separated with a comma, \u003ccode\u003e,\u003c/code\u003e.\nWhen we insert text we use single quotes, \u003ccode\u003e''\u003c/code\u003e to mark that it is\ntext.  To insert a quote mark we put in 2 of them in a row.\nSo, To insert \u003ccode\u003ethat''s\u003c/code\u003e  we would use in our insert statement,\n\u003ccode\u003e''that''''s\u003c/code\u003e`.\u003c/p\u003e\n\n\u003cp\u003eNumbers are respresented as a set of digits.  With fractional(floating point) numbers you put in a decimal\npoint - but note that our column age is not a float - so just whole years.\u003c/p\u003e\n\n\u003cp\u003eIf all has worked correctly then you should have 6 rows in the table.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eselect count(1) as x  \nfrom name_list \n; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003e6 rows is good.  Click to grade the homework.\u003c/p\u003e\n\n\u003cp\u003eBook: Pages 7 to 9\u003c/p\u003e\n\n\u003ch4\u003eTags: \u0026ldquo;hw02\u0026rdquo;,\u0026ldquo;insert\u0026rdquo;\u003c/h4\u003e\n","Lesson_no":2}' where title_id = '044fb48b-25d8-4ac6-7d97-33cc363980cb';


insert into a03_title (id, title) values ( '0ebaa5b2-1603-4b40-79c9-6bc77fedda2d', 'Interactive - 03 - Select data back from the table'); --x1--
insert into a03_tag ( id, tag ) values ( '63d92c7e-90a2-4b4a-7200-584c18c9a4d8', 'select' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '63d92c7e-90a2-4b4a-7200-584c18c9a4d8', '0ebaa5b2-1603-4b40-79c9-6bc77fedda2d' );
insert into a03_tag ( id, tag ) values ( '2ffe8148-1aa0-49ac-7d8f-c4aef4e0b0ec', 'where' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '2ffe8148-1aa0-49ac-7d8f-c4aef4e0b0ec', '0ebaa5b2-1603-4b40-79c9-6bc77fedda2d' );
update a03_title set body = '{"Lesson":"\u003cstyle\u003e \n.pagebreak { page-break-before: always; } \n.half { height: 200px; } \n\u003c/style\u003e \n \n\n\u003ch1\u003eInteractive - 03 - Select data back from the table\u003c/h1\u003e\n\n\u003cp\u003eData is more fun when you can put some in and get it\u003cbr /\u003e\nback later.  Enter \u0026ldquo;select\u0026rdquo;.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eSELECT * from name_list; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003egives you get back all the data.  The \u003ccode\u003e*\u003c/code\u003e is the list\nof columns you get back.  \u003ccode\u003e*\u003c/code\u003e is for all the columns.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eSELECT real_name, state from name_list; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eGives you back just the name and state.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eSELECT lower(real_name) as \u0026quot;real_name_lower\u0026quot;, real_name \nfrom name_list; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eGives you back a lower case version of the name.\u003c/p\u003e\n\n\u003cp\u003eOr make it in order from z to a.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003e \nSELECT lower(real_name) as \u0026quot;real_name_lower\u0026quot;, real_name \n\tFROM name_list \n\tORDER BY 1 desc \n; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eMaybe we just want the names in Wyoming.  This is the\nwhere clause.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003e \nSELECT real_name \n\tFROM name_list \n\tWHERE state = ''WY'' \n; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eRemember that if you want to match a text field you\nhave to use quotes.  Also it is case sensitive.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eselect real_name \nfrom name_list \nwhere state = ''wy'' \n; \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003ewill not give you any rows.  Try it.\u003c/p\u003e\n\n\u003cp\u003eThe query to run before to get your grade is:\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003e \nSELECT real_name \n\tFROM name_list \n\tWHERE state = ''WY'' \n; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eIt should return 3 rows.  This is what is checked for by the application.\u003c/p\u003e\n\n\u003cp\u003eBook: Chapter 2 - pages 11 to 22.\u003c/p\u003e\n\n\u003ch4\u003eTags: select,where\u003c/h4\u003e\n","Lesson_no":3}' where title_id = '0ebaa5b2-1603-4b40-79c9-6bc77fedda2d';


insert into a03_title (id, title) values ( 'f7fb5c5e-00f4-4b1f-62d4-04531d934ff1', 'Interactive - 04 - update the table'); --x1--
insert into a03_tag ( id, tag ) values ( '342ba1a2-6ed1-48ee-4a88-964bdc7715e6', 'update' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '342ba1a2-6ed1-48ee-4a88-964bdc7715e6', 'f7fb5c5e-00f4-4b1f-62d4-04531d934ff1' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '2ffe8148-1aa0-49ac-7d8f-c4aef4e0b0ec', 'f7fb5c5e-00f4-4b1f-62d4-04531d934ff1' );
update a03_title set body = '{"Lesson":"\u003cstyle\u003e \n.pagebreak { page-break-before: always; } \n.half { height: 200px; } \n\u003c/style\u003e \n \n\n\u003ch1\u003eInteractive - 04 - update the table\u003c/h1\u003e\n\n\u003cp\u003eNote that we have an error in our data.  \u003ccode\u003eBob true\u003c/code\u003e should\nbe \u003ccode\u003eBob True\u003c/code\u003e.   Let\u0026rsquo;s change some data.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eupdate \u0026lt;tabe-name\u0026gt; \n\tset \u0026lt;list of columns to modify\u0026gt; \n\twhere \u0026lt;boolean expresison\u0026gt; \n; \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eso\u0026hellip; let\u0026rsquo;s look at the data before the update\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eSELECT * from name_list; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eUpdate it to fix it\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eUPDATE name_list \n\tSET real_name = ''Bob True'' \n\tWHERE real_name = ''bob true'' \n; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eNow let\u0026rsquo;s look at the data:\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eSELECT * from name_list; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eMuch better!  The query should return 6 rows.  The application checks that you are getting back 6 rows\nof data for grading.\u003c/p\u003e\n\n\u003cp\u003eBook: page 139 talks about update.\u003c/p\u003e\n\n\u003ch4\u003eTags: update,where\u003c/h4\u003e\n","Lesson_no":4}' where title_id = 'f7fb5c5e-00f4-4b1f-62d4-04531d934ff1';


insert into a03_title (id, title) values ( 'bfd99218-194d-4ec9-73ba-e8db286d2253', 'Interactive - 05 - insert more data / select unique data'); --x1--
insert into a03_title_to_tag ( tag_id, title_id ) values ( '5a4afd48-c48d-431f-57e7-171f237012cc', 'bfd99218-194d-4ec9-73ba-e8db286d2253' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '63d92c7e-90a2-4b4a-7200-584c18c9a4d8', 'bfd99218-194d-4ec9-73ba-e8db286d2253' );
insert into a03_tag ( id, tag ) values ( '901b69da-9e47-4c86-47ee-c2e099bd59dd', 'distinct' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '901b69da-9e47-4c86-47ee-c2e099bd59dd', 'bfd99218-194d-4ec9-73ba-e8db286d2253' );
insert into a03_tag ( id, tag ) values ( '1e1b349c-65c0-485d-478b-fa44cd7a162a', 'select distinct' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '1e1b349c-65c0-485d-478b-fa44cd7a162a', 'bfd99218-194d-4ec9-73ba-e8db286d2253' );
update a03_title set body = '{"Lesson":"\u003cstyle\u003e \n.pagebreak { page-break-before: always; } \n.half { height: 200px; } \n\u003c/style\u003e \n \n\n\u003ch1\u003eInteractive - 05 - insert more data / select unique data\u003c/h1\u003e\n\n\u003cp\u003eLet\u0026rsquo;s put in some more data - that has some mistakes in it.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eINSERT INTO name_list values \n\t( ''Liz Trubune'',         30, ''WY'' ), \n\t( ''Jane True'',           20, ''WY'' ), \n\t( ''Lary Smith'',          58, ''NJ'' ), \n\t( ''Dave Dave'',           21, ''NJ'' ), \n\t( ''Laura Ann Alkinoos'',  34, ''PA'' ) \n; \n \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eThe problem is that \u0026ldquo;Jane True\u0026rdquo; is now a duplicate!\u003c/p\u003e\n\n\u003cp\u003eLet\u0026rsquo;s see it.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eSELECT * from name_list; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eWe will get how to prevent this later.\nRight now let\u0026rsquo;s get unique data back when the\nactual data has duplicates.   For lots of reasons you\u003cbr /\u003e\ncan get duplicates in a set of selected data.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eSELECT distinct * from name_list; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eThe select should return 10 rows of data.\u003c/p\u003e\n\n\u003cp\u003eBook: pages 12 to 14.\u003c/p\u003e\n\n\u003ch4\u003eTags: insert,select,distinct,select distinct\u003c/h4\u003e\n","Lesson_no":5}' where title_id = 'bfd99218-194d-4ec9-73ba-e8db286d2253';


insert into a03_title (id, title) values ( '98fe692c-1bbf-42a6-7d63-4fb18c427285', 'Interactive - 06 - count rows of data'); --x1--
insert into a03_tag ( id, tag ) values ( '5f43fd5a-fd02-476c-59ae-74f8236126d2', 'count' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '5f43fd5a-fd02-476c-59ae-74f8236126d2', '98fe692c-1bbf-42a6-7d63-4fb18c427285' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '901b69da-9e47-4c86-47ee-c2e099bd59dd', '98fe692c-1bbf-42a6-7d63-4fb18c427285' );
insert into a03_tag ( id, tag ) values ( '07ce6bbf-583f-4336-453f-925d5e74cdcb', 'count distinct' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '07ce6bbf-583f-4336-453f-925d5e74cdcb', '98fe692c-1bbf-42a6-7d63-4fb18c427285' );
update a03_title set body = '{"Lesson":"\u003cstyle\u003e \n.pagebreak { page-break-before: always; } \n.half { height: 200px; } \n\u003c/style\u003e \n \n\n\u003ch1\u003eInteractive - 06 - count rows of data\u003c/h1\u003e\n\n\u003cp\u003euse count to get how many rows.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eSELECT count(*) from name_list; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eYou should get 11 rows.\u003c/p\u003e\n\n\u003cp\u003eor with a where clause\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eSELECT count(*) from name_list \n\tWHERE state = ''NJ'' \n; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eYou should get 4 rows.\u003c/p\u003e\n\n\u003cp\u003ewith a name for the returned data column\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eSELECT count(*) as \u0026quot;count_of_names\u0026quot; \n\tFROM name_list \n; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eYou should get 11 rows.\u003c/p\u003e\n\n\u003cp\u003eBook: page 117 to 118\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eSELECT count(distinct real_name)  \n\tFROM name_list \n\tWHERE state = ''NJ'' \n; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eYou should get back 1 row with a count of 10.\u003c/p\u003e\n\n\u003ch4\u003eTags: count,distinct,\u0026ldquo;count distinct\u0026rdquo;\u003c/h4\u003e\n","Lesson_no":6}' where title_id = '98fe692c-1bbf-42a6-7d63-4fb18c427285';


insert into a03_title (id, title) values ( 'a06a98e1-87cb-4f2d-6224-2a2384d3c3f6', 'Interactive - 07 - add a check constraint on age'); --x1--
insert into a03_tag ( id, tag ) values ( '966037e7-6520-47c8-587d-09bdde9fc3af', 'alter table rename' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '966037e7-6520-47c8-587d-09bdde9fc3af', 'a06a98e1-87cb-4f2d-6224-2a2384d3c3f6' );
insert into a03_tag ( id, tag ) values ( '907ee8b0-1e92-4f5a-51f0-1187830faee9', 'rename' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '907ee8b0-1e92-4f5a-51f0-1187830faee9', 'a06a98e1-87cb-4f2d-6224-2a2384d3c3f6' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '5a4afd48-c48d-431f-57e7-171f237012cc', 'a06a98e1-87cb-4f2d-6224-2a2384d3c3f6' );
insert into a03_tag ( id, tag ) values ( '11bc2cf5-f10c-4bf8-75cb-d20a31ee0ca4', 'drop table' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '11bc2cf5-f10c-4bf8-75cb-d20a31ee0ca4', 'a06a98e1-87cb-4f2d-6224-2a2384d3c3f6' );
insert into a03_tag ( id, tag ) values ( '74073e2a-2610-4da3-6653-566858b7e5a5', 'insert select' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '74073e2a-2610-4da3-6653-566858b7e5a5', 'a06a98e1-87cb-4f2d-6224-2a2384d3c3f6' );
update a03_title set body = '{"Lesson":"\u003cstyle\u003e \n.pagebreak { page-break-before: always; } \n.half { height: 200px; } \n\u003c/style\u003e \n \n\n\u003ch1\u003eInteractive - 07 - add a check constraint on age\u003c/h1\u003e\n\n\u003cp\u003eWe can use the Data Definition Language (DDL) - create table to check\nthat values are in a correct range or value.\u003c/p\u003e\n\n\u003cp\u003eThese are check constrains.\u003c/p\u003e\n\n\u003cp\u003eLet\u0026rsquo;s save our data for later, then recreate the table.\u003c/p\u003e\n\n\u003cp\u003eFirst we are going to rename the table - so we can save\u003cbr /\u003e\nit for later.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eDROP TABLE if exists old_name_list; \nALTER TABLE name_list \n\tRENAME TO old_name_list; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eNow we will re-create the table with the check constraint.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003ecreate table name_list ( \n\treal_name text, \n\tage int check ( age \u0026gt; 0 and age \u0026lt; 154 ),\t \n\tstate char varying (2) \n); \n \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eNow copy the data back.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003einsert into name_list ( real_name, age, state )  \n\tselect real_name, age, state  \n\tfrom old_name_list; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eVerify data amount.  Check how many rows.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eselect count(1) from name_list; \nselect count(1) from old_name_list; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eProvided that the counts are the same let\u0026rsquo;s clean up the temporary table with the old data.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003edrop table old_name_list; \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eAnd let\u0026rsquo;s look at the data.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eselect * from name_list; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eYou should see 11 rows.  The duplicate should be removed.\u003c/p\u003e\n\n\u003cp\u003eBook: page 132\u003c/p\u003e\n\n\u003ch4\u003eTags: \u0026ldquo;alter table rename\u0026rdquo;,\u0026ldquo;rename\u0026rdquo;,\u0026ldquo;insert\u0026rdquo;,\u0026ldquo;drop table\u0026rdquo;,\u0026ldquo;insert select\u0026rdquo;\u003c/h4\u003e\n","Lesson_no":7}' where title_id = 'a06a98e1-87cb-4f2d-6224-2a2384d3c3f6';


insert into a03_title (id, title) values ( '8e80be1b-a17b-4dd2-569f-a896a16e4426', 'Interactive - 08 - create unique id and a primary key'); --x1--
insert into a03_tag ( id, tag ) values ( 'b704725a-b5b8-4584-5984-e2b5ea03bde2', 'primary key' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( 'b704725a-b5b8-4584-5984-e2b5ea03bde2', '8e80be1b-a17b-4dd2-569f-a896a16e4426' );
insert into a03_tag ( id, tag ) values ( 'c3204972-61ef-4f9e-7ccd-80ca24033f04', 'uuid' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( 'c3204972-61ef-4f9e-7ccd-80ca24033f04', '8e80be1b-a17b-4dd2-569f-a896a16e4426' );
insert into a03_tag ( id, tag ) values ( 'cf4054bb-2b2d-40f1-4336-0fd724fbc9ac', 'unique id' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( 'cf4054bb-2b2d-40f1-4336-0fd724fbc9ac', '8e80be1b-a17b-4dd2-569f-a896a16e4426' );
insert into a03_tag ( id, tag ) values ( 'cd9a0a57-f530-49e4-4b5f-4b1979030916', 'UUID' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( 'cd9a0a57-f530-49e4-4b5f-4b1979030916', '8e80be1b-a17b-4dd2-569f-a896a16e4426' );
update a03_title set body = '{"Lesson":"\u003cstyle\u003e \n.pagebreak { page-break-before: always; } \n.half { height: 200px; } \n\u003c/style\u003e \n \n\n\u003ch1\u003eInteractive - 08 - create unique id and a primary key\u003c/h1\u003e\n\n\u003cp\u003eIt is really hard to update data when you don\u0026rsquo;t have a unique way of identifying a row.\nPeople will often imagine that there is something unique in the data.  Some combination\nof name/date/place-of-birth, generally it is not true.\u003c/p\u003e\n\n\u003cp\u003eThe easy way to deal with this is to create unique keys.  PostgreSQL offers two ways\u003cbr /\u003e\nof doing this.  The first is a key that counts up.   This makes short keys, that\u0026rsquo;s good\nbut also creates a bottle neck with a single source of \u0026ldquo;count-up\u0026rdquo; values.  The second\nway is use a university unique identifier or UUID.  UUIDs are can be created in parallel\nand will not collide.  This has lot\u0026rsquo;s of advantages, but they are long, hard to type\nand take up lots of space in your database.\u003c/p\u003e\n\n\u003cp\u003eWe will get back to sequential values later, for a different purpose.  Let\u0026rsquo;s do the\nmore general approach and use UUIDs.\u003c/p\u003e\n\n\u003cp\u003eWe are going to change our table to have a unique ID column, then create an index\u003cbr /\u003e\non that column.\u003c/p\u003e\n\n\u003cp\u003eThis relies on having a way to generate UUIDs, it is an extension package to the\ndefault PostgreSQL database. (double quotes, \u003ccode\u003e\u0026quot;\u003c/code\u003e are correct for this command).\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eCREATE EXTENSION IF NOT EXISTS \u0026quot;uuid-ossp\u0026quot;; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eThere are ways to add a column to the table without re-creating the table.\nThey will not work for this.\u003c/p\u003e\n\n\u003cp\u003eLet\u0026rsquo;s save our data for later, then recreate the table.\u003c/p\u003e\n\n\u003cp\u003eFirst we are going to rename the table, so we can save\u003cbr /\u003e\nit for later. (Familiar, we did this last time)\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003edrop table if exists old_name_list; \nALTER TABLE name_list \n\tRENAME TO old_name_list; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eNow we will re-create the table with the check constraint.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003ecreate table name_list ( \n\tname_list_id UUID NOT NULL DEFAULT uuid_generate_v4() primary key, \n\treal_name text, \n\tage int check ( age \u0026gt; 0 and age \u0026lt; 154 ),\t \n\tstate char varying (2) \n); \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eNow copy the data back.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eINSERT INTO name_list ( real_name, age, state )  \n\tSELECT real_name, age, state  \n\tFROM old_name_list; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eVerify data amount.  Check how many rows.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eselect count(1) from name_list; \nselect count(1) from old_name_list; \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eProvided that the counts are the same let\u0026rsquo;s clean up the temporary table with the old data.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003edrop table old_name_list; \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eThere are 2 parts that we added.  Both a ID column that is unique and\na thing called a \u003ccode\u003ePRIMARY KEY\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003eYour result should be similar to this list (the name_list_id\u0026rsquo;s will\nbe unique to you and will not match the UUIDs below).\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003e             name_list_id             |      real_name      | age | state  \n--------------------------------------+---------------------+-----+------- \n 1fb069ca-a4a2-412a-8401-c835b6c45cb7 | Jane True           |  20 | WY \n 39fff492-f369-4552-bf49-b8d7ae57bf9a | Tom Ace             |  31 | NJ \n 8e91d65f-ee0a-4642-8d62-1cc1e1058238 | Steve Pen           |  33 | NJ \n e245b3ec-9e5f-4112-ac7e-1d9732d9a4f1 | Laura Jean Alkinoos |  34 | PA \n b8c2468e-694d-46de-acc3-e8da239aa1a3 | Philip Schlump      |  62 | WY \n 983b17d2-39f7-45bc-96b2-66ffdbb96c0e | Bob True            |  22 | WY \n 2db6af28-47c7-4107-9b67-bdec3321f14c | Liz Trubune         |  30 | WY \n ea51c6b2-37f0-47ed-9211-d1064d3eacfd | Jane True           |  44 | WY \n 4c827537-1755-4242-8241-a77ff4173554 | Lary Smith          |  58 | NJ \n 3674b39d-4a61-45e0-99e6-65fb7edbbf82 | Dave Dave           |  21 | NJ \n e543c622-24be-4cc2-8241-e8a2dfd1f15c | Laura Ann Alkinoos  |  34 | PA \n(11 rows) \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eThe grading code will look at the table name_list and verify that you have 11 rows of data in it.\u003c/p\u003e\n\n\u003ch4\u003eTags: \u0026ldquo;primary key\u0026rdquo;,\u0026ldquo;uuid\u0026rdquo;,\u0026ldquo;unique id\u0026rdquo;,\u0026ldquo;UUID\u0026rdquo;\u003c/h4\u003e\n","Lesson_no":8}' where title_id = '8e80be1b-a17b-4dd2-569f-a896a16e4426';


insert into a03_title (id, title) values ( '79a31f2c-4967-4335-42fc-8d7a2442906b', 'Interactive - 09 - add a table with state codes'); --x1--
insert into a03_tag ( id, tag ) values ( '45d16247-d8a4-48ab-5685-ffe7451e4c31', 'foreign key' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '45d16247-d8a4-48ab-5685-ffe7451e4c31', '79a31f2c-4967-4335-42fc-8d7a2442906b' );
insert into a03_tag ( id, tag ) values ( '00f961e3-7e54-4ce5-7d0f-96baf3069f29', 'alter table' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '00f961e3-7e54-4ce5-7d0f-96baf3069f29', '79a31f2c-4967-4335-42fc-8d7a2442906b' );
insert into a03_tag ( id, tag ) values ( 'fb3b5ee2-182e-4a28-6d20-1d3820189adf', 'add constraint' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( 'fb3b5ee2-182e-4a28-6d20-1d3820189adf', '79a31f2c-4967-4335-42fc-8d7a2442906b' );
insert into ct_file_list ( file_list_id) values ( '25155a49-feea-4c55-5f12-404657e2a7c2', 9, 'hw09_1.sql' );
insert into ct_file_list ( file_list_id) values ( '705aca12-c6b4-4718-6b36-eab9168f8636', 9, 'hw09_2.sql' );
insert into ct_file_list ( file_list_id) values ( '8c7be4cf-1932-4cc3-401e-de8565bd3679', 9, 'hw09_3.sql' );
insert into ct_file_list ( file_list_id) values ( 'fe23aaf6-d135-46bd-47b2-68cb80b1f1eb', 9, 'hw09_4.sql' );
update a03_title set body = '{"Lesson":"\u003cstyle\u003e \n.pagebreak { page-break-before: always; } \n.half { height: 200px; } \n\u003c/style\u003e \n \n\n\u003ch1\u003eInteractive - 09 - add a table with state codes\u003c/h1\u003e\n\n\u003cp\u003eA check constraint on all the state codes would be very long.   There are also\ntimes when that is just not the best way to check that a value is correct.\u003c/p\u003e\n\n\u003cp\u003eThere is a different way to check that a value is in a range of values.\nThat is to add a new table that contains all the values and have the\ndatabase verify that new values are in this list.\u003c/p\u003e\n\n\u003cp\u003eFirst let\u0026rsquo;s create the table with the values.  We can also have the\ndatabase verify that nobody puts in an empty state name.  This is\nthe \u0026ldquo;NOT NULL\u0026rdquo; on each of the types.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eCREATE TABLE us_state ( \n\tstate_id UUID NOT NULL DEFAULT uuid_generate_v4() primary key, \n\tstate_name text NOT NULL, \n\tstate char varying (2) NOT NULL, \n\tFIPS_code char varying (2) NOT NULL \n); \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eWe will also need an index on the state code so that we can\nreference it.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eCREATE UNIQUE INDEX us_state_uidx1 on us_state ( state ); \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eIf this is not the first time this is run you may need to delete existing data.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eDELETE FROM us_state ; \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eThen we need to populate the state table with states.  Please cut-and-paste\nthis or use the supplied file to insert the states.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eINSERT INTO us_state ( state_name, state, FIPS_code ) values \n\t(''Alabama'',''AL'',''01''), \n\t(''Alaska'',''AK'',''02''), \n\t(''Arizona'',''AZ'',''04''), \n\t(''Arkansas'',''AR'',''05''), \n\t(''California'',''CA'',''06''), \n\t(''Colorado'',''CO'',''08''), \n\t(''Connecticut'',''CT'',''09''), \n\t(''Delaware'',''DE'',''10''), \n\t(''District of Columbia'',''DC'',''11''), \n\t(''Florida'',''FL'',''12''), \n\t(''Georgia'',''GA'',''13''), \n\t(''Hawaii'',''HI'',''15''), \n\t(''Idaho'',''ID'',''16''), \n\t(''Illinois'',''IL'',''17''), \n\t(''Indiana'',''IN'',''18''), \n\t(''Iowa'',''IA'',''19''), \n\t(''Kansas'',''KS'',''20''), \n\t(''Kentucky'',''KY'',''21''), \n\t(''Louisiana'',''LA'',''22''), \n\t(''Maine'',''ME'',''23''), \n\t(''Maryland'',''MD'',''24''), \n\t(''Massachusetts'',''MA'',''25''), \n\t(''Michigan'',''MI'',''26''), \n\t(''Minnesota'',''MN'',''27''), \n\t(''Mississippi'',''MS'',''28''), \n\t(''Missouri'',''MO'',''29''), \n\t(''Montana'',''MT'',''30''), \n\t(''Nebraska'',''NE'',''31''), \n\t(''Nevada'',''NV'',''32''), \n\t(''New Hampshire'',''NH'',''33''), \n\t(''New Jersey'',''NJ'',''34''), \n\t(''New Mexico'',''NM'',''35''), \n\t(''New York'',''NY'',''36''), \n\t(''North Carolina'',''NC'',''37''), \n\t(''North Dakota'',''ND'',''38''), \n\t(''Ohio'',''OH'',''39''), \n\t(''Oklahoma'',''OK'',''40''), \n\t(''Oregon'',''OR'',''41''), \n\t(''Pennsylvania'',''PA'',''42''), \n\t(''Puerto Rico'',''PR'',''72''), \n\t(''Rhode Island'',''RI'',''44''), \n\t(''South Carolina'',''SC'',''45''), \n\t(''South Dakota'',''SD'',''46''), \n\t(''Tennessee'',''TN'',''47''), \n\t(''Texas'',''TX'',''48''), \n\t(''Utah'',''UT'',''49''), \n\t(''Vermont'',''VT'',''50''), \n\t(''Virginia'',''VA'',''51''), \n\t(''Virgin Islands'',''VI'',''78''), \n\t(''Washington'',''WA'',''53''), \n\t(''West Virginia'',''WV'',''54''), \n\t(''Wisconsin'',''WI'',''55''), \n\t(''Wyoming'',''WY'',''56'') \n; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eNow let\u0026rsquo;s make the relationship between them know to the database.\nThis is called a foreign key constraint.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eALTER TABLE name_list  \n\tADD CONSTRAINT name_list_state_fk \n\tFOREIGN KEY (state)  \n\tREFERENCES us_state (state) \n; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eNow when we try to insert data that is has an invalid state code\ninto our list of names it will get rejected.\u003c/p\u003e\n\n\u003cp\u003eThe following SQL will \u003cem\u003enot\u003c/em\u003e run successfully\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003einsert into name_list ( real_name, state ) values \n\t( ''nobody'', ''XX'' ) \n; \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eYou should get an error that looks similar to:\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eERROR:  insert or update on table \u0026quot;name_list\u0026quot; violates foreign key constraint \u0026quot;name_list_state_fk\u0026quot; \nDETAIL:  Key (state)=(XX) is not present in table \u0026quot;us_state\u0026quot;. \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eBook: page 107, 136\u003c/p\u003e\n\n\u003ch4\u003eTags: \u0026ldquo;foreign key\u0026rdquo;,\u0026ldquo;alter table\u0026rdquo;,\u0026ldquo;add constraint\u0026rdquo;\u003c/h4\u003e\n","Lesson_no":9}' where title_id = '79a31f2c-4967-4335-42fc-8d7a2442906b';


insert into a03_title (id, title) values ( '1cdbdfe5-e860-452b-579d-ce687f36c8f5', 'Interactive - 10 - add a index on the name table'); --x1--
insert into a03_tag ( id, tag ) values ( 'b5a8c1a2-0cd2-410b-536f-2e3176721a2e', 'create index' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( 'b5a8c1a2-0cd2-410b-536f-2e3176721a2e', '1cdbdfe5-e860-452b-579d-ce687f36c8f5' );
update a03_title set body = '{"Lesson":"\u003cstyle\u003e \n.pagebreak { page-break-before: always; } \n.half { height: 200px; } \n\u003c/style\u003e \n \n\n\u003ch1\u003eInteractive - 10 - add a index on the name table\u003c/h1\u003e\n\n\u003cp\u003eWe have already added indexes but we need to make this process explicit.\u003c/p\u003e\n\n\u003cp\u003eThe most common indexes are based on special kind of tree called a b-tree.\u003c/p\u003e\n\n\u003cp\u003eIt is a very wide tree that allows us to get to the data stored on disk\nquickly.  This is not the only kind of index.\u003c/p\u003e\n\n\u003cp\u003eThere are indexes for other things that are built into PostgreSQL.\u003c/p\u003e\n\n\u003cp\u003eLet\u0026rsquo;s create an index on the real_name field.\u003c/p\u003e\n\n\u003cp\u003eThe general form for the create index looks like:\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003ecreate [unique] index \u0026lt;index-name\u0026gt; on \u0026lt;table-name\u0026gt; ( \n\t\u0026lt;colunm-name-1\u0026gt;, \n\t\u0026lt;col-2\u0026gt;, \n\t... \n); \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eSo\u0026hellip;\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eCREATE INDEX name_list_idx1 on name_list ( real_name ); \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eNow when we search for a name it will use the index to help to find the\nnames in the table.  If we have a million names in many blocks of data\nit will only take a few blocks of index search to get to the row with\nthe name we are interested in.\u003c/p\u003e\n\n\u003cp\u003eThe disadvantage is that we have to have the exact name to search on.\nDo you remember our lower-case name, \u003ccode\u003ebob true\u003c/code\u003e from the 2nd homework.\nIf we look for that we will not find it at all because we fixed the\nname to be \u003ccode\u003eBob True\u003c/code\u003e.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eselect * from name_list where real_name = ''bob true''; \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eIndexes are important because this is the primary way that we can\ninfluence the performance of a database.   If we add the word \u0026ldquo;unique\u0026rdquo;\nthen it also grantees that a column of data is unique.\u003c/p\u003e\n\n\u003cp\u003eNote that we can build indexes on more than one column.  If that is\nthe case then a for a select to use the multi-column index will\nrequire that all of the columns in the index are in the where\u003cbr /\u003e\nclause.\u003c/p\u003e\n\n\u003cp\u003eIndexes are also used when we sort data to get it back in order.\u003c/p\u003e\n\n\u003cp\u003eBook: Page 108 to 111\u003c/p\u003e\n\n\u003ch4\u003eTags: \u0026ldquo;create index\u0026rdquo;\u003c/h4\u003e\n","Lesson_no":10}' where title_id = '1cdbdfe5-e860-452b-579d-ce687f36c8f5';


insert into a03_title (id, title) values ( 'cb55151c-f31b-4945-66ef-52a6730711db', 'Interactive - 11 - add a index on the name table that is case insensitive.'); --x1--
insert into a03_tag ( id, tag ) values ( '8482824c-e02f-4706-677f-e31120031147', 'index' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '8482824c-e02f-4706-677f-e31120031147', 'cb55151c-f31b-4945-66ef-52a6730711db' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( 'b5a8c1a2-0cd2-410b-536f-2e3176721a2e', 'cb55151c-f31b-4945-66ef-52a6730711db' );
insert into a03_tag ( id, tag ) values ( '843d1404-c92c-4971-4b3c-a00fc953d41a', 'lower' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '843d1404-c92c-4971-4b3c-a00fc953d41a', 'cb55151c-f31b-4945-66ef-52a6730711db' );
update a03_title set body = '{"Lesson":"\u003cstyle\u003e \n.pagebreak { page-break-before: always; } \n.half { height: 200px; } \n\u003c/style\u003e \n \n\n\u003ch1\u003eInteractive - 11 - add a index on the name table that is case insensitive.\u003c/h1\u003e\n\n\u003cp\u003eLet\u0026rsquo;s address the case sensitive problem first.\u003c/p\u003e\n\n\u003cp\u003eWe can create indexes on functions of data.  This allows us to have\nan index where we convert the upper/lower case to all lower case\nand then index this result.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eCREATE INDEX user_real_name_ci_idx1 ON name_list ((lower(real_name))); \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eNow when we search the table using the WHERE clause we can use the \u003ccode\u003elower()\u003c/code\u003e function on\nboth sides of the equal and use the index to find the data.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eSELECT *  \n\tFROM name_list  \n\tWHERE lower(real_name) = lower(''Bob True'') \n; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eIndexes are also a disadvantage.  Every insert of a row now requires an insert\nto each of the indexes.  They take up storage space.   This means that we are\nusing space and time at data insert or update to save time when we select the\ndata back.  Most interactive databases have 10 to 20 times as many selects\nas they do insert/update operations.   So this is usually a good tried off.\u003c/p\u003e\n\n\u003cp\u003eWe can also get the database to tell us the set of indexes that are not\nused.  We may want to get rid of unused indexes.  We can do that with\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003edrop index \u0026lt;index_name\u0026gt;; \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eCare should be taken.  If the index is a \u0026ldquo;UNIQUE\u0026rdquo; index and you remove it\nyou are also removing the unique constraint on the column of data.\u003c/p\u003e\n\n\u003cp\u003eLet\u0026rsquo;s get rid of the index that is upper-lower case on the table.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003edrop index name_list_idx1; \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eThis is the query that I used to find unused indexes (it\u0026rsquo;s a bit complicated):\nWe will use this in a homework on database performance later in the class.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eSELECT \n    idstat.relname AS TABLE_NAME, \n    indexrelname AS INDEX_NAME, \n    idstat.idx_scan AS index_scans_count, \n    pg_size_pretty(pg_relation_size(indexrelid)) AS index_size, \n    tabstat.idx_scan AS table_reads_index_count, \n    tabstat.seq_scan AS table_reads_seq_count, \n    tabstat.seq_scan + tabstat.idx_scan AS table_reads_count, \n    n_tup_upd + n_tup_ins + n_tup_del AS table_writes_count, \n    pg_size_pretty(pg_relation_size(idstat.relid)) AS table_size \nFROM pg_stat_user_indexes AS idstat \n\tJOIN pg_indexes ON indexrelname = indexname \n\t\t\tAND idstat.schemaname = pg_indexes.schemaname \n\tJOIN pg_stat_user_tables AS tabstat ON idstat.relid = tabstat.relid \nWHERE indexdef !~* ''unique'' \nORDER BY \n    idstat.idx_scan DESC, \n    pg_relation_size(indexrelid) DESC \n; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003ePlease cut/past the above query and run it once.\u003c/p\u003e\n\n\u003cp\u003eThings to note:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eThe index name has to be unique.\u003c/li\u003e\n\u003cli\u003eYou can have more than one index on a table.\u003c/li\u003e\n\u003cli\u003eFunction based indexes require that the function be run on every insert.  That takes time.\u003c/li\u003e\n\u003cli\u003eWe can create our own functions and index on them as well.   We will return to this subject later with \u003ccode\u003esoundex()\u003c/code\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch4\u003eTags: index,\u0026ldquo;create index\u0026rdquo;,\u0026ldquo;lower\u0026rdquo;\u003c/h4\u003e\n","Lesson_no":11}' where title_id = 'cb55151c-f31b-4945-66ef-52a6730711db';


insert into a03_title (id, title) values ( 'f4be5c3f-6d3f-47f8-4314-09c2bdbf549d', 'Interactive - 12 - fix our duplicate data'); --x1--
insert into a03_tag ( id, tag ) values ( 'fc6e84cc-cbf6-4150-44e9-b55e1b3a9f97', 'duplicate data' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( 'fc6e84cc-cbf6-4150-44e9-b55e1b3a9f97', 'f4be5c3f-6d3f-47f8-4314-09c2bdbf549d' );
insert into a03_tag ( id, tag ) values ( '08dcd772-9991-44f1-5827-f88b58e34509', 'delete' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '08dcd772-9991-44f1-5827-f88b58e34509', 'f4be5c3f-6d3f-47f8-4314-09c2bdbf549d' );
insert into a03_tag ( id, tag ) values ( 'd6770880-b82a-400e-58c6-845f92107f50', 'type cast' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( 'd6770880-b82a-400e-58c6-845f92107f50', 'f4be5c3f-6d3f-47f8-4314-09c2bdbf549d' );
insert into a03_tag ( id, tag ) values ( 'd5a9b52e-590a-49bc-63a5-0d7a79877f9d', 'min' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( 'd5a9b52e-590a-49bc-63a5-0d7a79877f9d', 'f4be5c3f-6d3f-47f8-4314-09c2bdbf549d' );
insert into a03_tag ( id, tag ) values ( '3967e534-45f7-43ee-468d-cdd7708db3d9', 'not in' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '3967e534-45f7-43ee-468d-cdd7708db3d9', 'f4be5c3f-6d3f-47f8-4314-09c2bdbf549d' );
update a03_title set body = '{"Lesson":"\u003cstyle\u003e \n.pagebreak { page-break-before: always; } \n.half { height: 200px; } \n\u003c/style\u003e \n \n\n\u003ch1\u003eInteractive - 12 - fix our duplicate data\u003c/h1\u003e\n\n\u003cp\u003eNow that we have a unique primary key we can fix the duplicate name and its row.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eSELECT * from name_list; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eThis shows us 2 rows and we would like to delete just one of them.  Without the unique\nprimary key this is really hard to do.  With the key we can delete one of the two rows.\u003c/p\u003e\n\n\u003cp\u003eThis makes for a complex query.   First let\u0026rsquo;s select the UUID column, name_list_id\nwhere the duplicate is.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eSELECT name_list_id \n\tFROM name_list  \n\tWHERE real_name = ''Jane True'' \n; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eNow let\u0026rsquo;s just select 1 of the IDs. To do this we have to convert the UUID to text,\nthat is the \u003ccode\u003e::text\u003c/code\u003e so that we can use a function \u003ccode\u003emin()\u003c/code\u003e on it.  This is kind of\na random pick - but it will give us just 1 UUID.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eSELECT min(name_list_id::text) \n\tFROM name_list  \n\tWHERE real_name = ''Jane True'' \n; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eNow we can delete and skip over the 1 UUID that we picked from above.  This is\nthe \u003ccode\u003enot in\u003c/code\u003e portion - where we put a select inside the delete.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eDELETE FROM name_list \n\tWHERE real_name = ''Jane True'' \n\t  AND name_list_id::text not in ( \n\t\tSELECT min(name_list_id::text) \n\t\tFROM name_list  \n\t\tWHERE real_name = ''Jane True'' \n\t) \n; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eNow select again and we have removed the duplicate.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eSELECT * from name_list; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003ch4\u003eTags: \u0026ldquo;duplicate data\u0026rdquo;,\u0026ldquo;delete\u0026rdquo;,\u0026ldquo;type cast\u0026rdquo;,\u0026ldquo;min\u0026rdquo;,\u0026ldquo;not in\u0026rdquo;\u003c/h4\u003e\n","Lesson_no":12}' where title_id = 'f4be5c3f-6d3f-47f8-4314-09c2bdbf549d';


insert into a03_title (id, title) values ( 'bebfd235-4782-4932-5330-b1c772c7bec2', 'Interactive - 13 - drop both tables'); --x1--
insert into a03_tag ( id, tag ) values ( '025e3d4d-0aa8-4835-67e4-8d4ac0a2acd3', 'reload data' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '025e3d4d-0aa8-4835-67e4-8d4ac0a2acd3', 'bebfd235-4782-4932-5330-b1c772c7bec2' );
insert into a03_tag ( id, tag ) values ( '22a4c0cf-0fc4-4b8b-6e6c-ec2a9b2abfc4', 'drop cascade' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '22a4c0cf-0fc4-4b8b-6e6c-ec2a9b2abfc4', 'bebfd235-4782-4932-5330-b1c772c7bec2' );
insert into ct_file_list ( file_list_id) values ( 'f3d2ec3e-13f0-45a8-578d-45570b323065', 13, 'hw13_4.sql' );
insert into ct_file_list ( file_list_id) values ( 'c2fd3fa2-2049-4d9f-6508-334bfd6f63de', 13, 'hw13_5.sql' );
insert into ct_file_list ( file_list_id) values ( 'c764c26e-0e30-41a0-5207-ea4acd1b7939', 13, 'hw13_6.sql' );
insert into ct_file_list ( file_list_id) values ( '6d74adc9-95ba-423e-73f6-013bb7f5a22b', 13, 'hw13_7.sql' );
update a03_title set body = '{"Lesson":"\u003cstyle\u003e \n.pagebreak { page-break-before: always; } \n.half { height: 200px; } \n\u003c/style\u003e \n \n\n\u003ch1\u003eInteractive - 13 - drop both tables\u003c/h1\u003e\n\n\u003cp\u003eLet\u0026rsquo;s try getting rid of our 2 tables.   Our first attempt to do this will fail.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003edrop table if exists us_state; \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eWe have a dependency via foreign constraint on us_state.  That is name_list.\u003c/p\u003e\n\n\u003cp\u003eWe can do this in order - or we can use an option to \u0026ldquo;cascade\u0026rdquo; the drops.\n\u0026ldquo;cascade\u0026rdquo; is powerful but dangerous.  In PosgreSQL it will drop the table\nand associated constraints.  In Oracle it cascades to the tables referenced!\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eDROP table if exists name_list; \nDROP table if exists us_state; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eNow use the supplied script to re-create the tables.  There will be some additional\ncolumns when you do this that we will use in future homework exercises.\u003c/p\u003e\n\n\u003cp\u003eThe files are hw13_4.sql, hw13_5.sql, hw13_6.sql, hw13_7.sql - run the entire set.  The files are shown below.   After you\nhave run the file do the select to see a table of the states.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003e \nDROP TABLE if exists name_list cascade ; \nDROP TABLE if exists us_state cascade ; \n \nCREATE TABLE us_state ( \n\tstate_id       UUID NOT NULL DEFAULT uuid_generate_v4() primary key, \n\tstate_name     text NOT NULL, \n\tstate          char varying (2) NOT NULL, \n\tFIPS_code      char varying (2) NOT NULL, \n\tarea_rank      int not null default 9999, \n\tarea_sq_mi     numeric not null default 0, \n\tpopulation     int not null default 0, \n\tfed_area       int   not null default 0, \n\tgdp_growth     float null default 0.0, \n\tgdp            float null default 0.0 \n); \n \nCREATE UNIQUE INDEX us_state_uidx1 on us_state ( state ); \n \n \n \nINSERT INTO us_state \n    ( state_name,             state,  FIPS_code,  population, area_rank, area_sq_mi, fed_area, gdp_growth, gdp ) values \n\t( ''Alabama'',               ''AL'',     ''01'' ,      4903185,        25,      50750,     6,         2.0,   196.9  ), \n\t( ''Alaska'',                ''AK'',     ''02'' ,       731545,         1,     570641,    12,        -0.3,    52.3  ), \n\t( ''Arizona'',               ''AZ'',     ''04'' ,      7278717,         6,     113642,    12,         4.0,   309.1  ), \n\t( ''Arkansas'',              ''AR'',     ''05'' ,      3017825,        27,      52075,     8,         0.9,   115.9  ), \n\t( ''California'',            ''CA'',     ''06'' ,     39512223,         3,     155973,    12,         3.5,  2700.0  ), \n\t( ''Colorado'',              ''CO'',     ''08'' ,      5758736,         8,     103730,    10,         3.5,   336.4  ), \n\t( ''Connecticut'',           ''CT'',     ''09'' ,      3565387,        48,       4845,     1,         1.0,   242.2  ), \n\t( ''Delaware'',              ''DE'',     ''10'' ,       973764,        50,       1955,     3,         0.3,    63.9  ), \n\t( ''District of Columbia'',  ''DC'',     ''11'' ,       705749,        52,        137,     5,         3.2,  125.94  ), \n\t( ''Florida'',               ''FL'',     ''12'' ,     21477737,        26,      53997,     6,         3.5,   917.0  ), \n\t( ''Georgia'',               ''GA'',     ''13'' ,     10617423,        21,      57919,     6,         2.6,   522.4  ), \n\t( ''Hawaii'',                ''HI'',     ''15'' ,      1415872,        47,       6423,    12,         1.0,    80.8  ), \n\t( ''Idaho'',                 ''ID'',     ''16'' ,      1787065,        11,      82751,    12,         4.1,    69.9  ), \n\t( ''Illinois'',              ''IL'',     ''17'' ,     12671821,        24,      55593,     7,         2.1,   764.2  ), \n\t( ''Indiana'',               ''IN'',     ''18'' ,      6732219,        38,      35870,     7,         1.9,   326.1  ), \n\t( ''Iowa'',                  ''IA'',     ''19'' ,      3155070,        23,      55875,     7,         1.4,   170.7  ), \n\t( ''Kansas'',                ''KS'',     ''20'' ,      2913314,        13,      81823,    10,         1.9,   152.3  ), \n\t( ''Kentucky'',              ''KY'',     ''21'' ,      4467673,        36,      39732,     8,         1.4,   186.1  ), \n\t( ''Louisiana'',             ''LA'',     ''22'' ,      4648794,        33,      43566,    11,         1.1,   231.2  ), \n\t( ''Maine'',                 ''ME'',     ''23'' ,      1344212,        39,      30865,     1,         1.9,    56.7  ), \n\t( ''Maryland'',              ''MD'',     ''24'' ,      6045680,        42,       9775,     5,         1.6,   367.9  ), \n\t( ''Massachusetts'',         ''MA'',     ''25'' ,      6949503,        45,       7838,     1,         2.7,   501.3  ), \n\t( ''Michigan'',              ''MI'',     ''26'' ,      9986857,        22,      56539,     7,         2.7,   468.4  ), \n\t( ''Minnesota'',             ''MN'',     ''27'' ,      5639632,        14,      79617,     9,         2.2,   331.4  ), \n\t( ''Mississippi'',           ''MS'',     ''28'' ,      2976149,        31,      46914,     6,         1.0,   101.6  ), \n\t( ''Missouri'',              ''MO'',     ''29'' ,      6137428,        18,      68898,     8,         2.3,   282.2  ) \n; \n \nINSERT INTO us_state \n    ( state_name,             state,  FIPS_code,  population, area_rank, area_sq_mi, fed_area, gdp_growth, gdp ) values \n\t( ''Montana'',               ''MT'',     ''30'' ,      1068778,         4,     145556,     9,         0.9,    44.8  ), \n\t( ''Nebraska'',              ''NE'',     ''31'' ,      1934408,        15,      76878,    10,         1.5,   112.2  ), \n\t( ''Nevada'',                ''NV'',     ''32'' ,      3080156,         7,     109806,    12,         3.2,   146.2  ), \n\t( ''New Hampshire'',         ''NH'',     ''33'' ,      1359711,        44,       8969,     1,         2.2,    75.6  ), \n\t( ''New Jersey'',            ''NJ'',     ''34'' ,      8882190,        46,       7419,     5,         2.0,   554.7  ), \n\t( ''New Mexico'',            ''NM'',     ''35'' ,      2096829,         5,     121365,    11,         1.8,    92.6  ), \n\t( ''New York'',              ''NY'',     ''36'' ,     19453561,        30,      47224,     2,         2.1,  1400.0  ), \n\t( ''North Carolina'',        ''NC'',     ''37'' ,     10488084,        29,      48718,     5,         2.9,   496.1  ), \n\t( ''North Dakota'',          ''ND'',     ''38'' ,       762062,        17,      68994,     9,         2.5,    51.2  ), \n\t( ''Ohio'',                  ''OH'',     ''39'' ,     11689100,        35,      40953,     4,         1.8,   601.5  ), \n\t( ''Oklahoma'',              ''OK'',     ''40'' ,      3956971,        19,      68679,    10,         1.8,   193.0  ), \n\t( ''Oregon'',                ''OR'',     ''41'' ,      4217737,        10,      96003,    12,         3.4,   213.7  ), \n\t( ''Pennsylvania'',          ''PA'',     ''42'' ,     12801989,        32,      44820,     4,         2.1,   712.1  ), \n\t( ''Puerto Rico'',           ''PR'',     ''72'' ,      3194000,        49,       3515,     2,         0.4,   101.0  ), \n\t( ''Rhode Island'',          ''RI'',     ''44'' ,      1059361,        51,       1034,     1,         0.6,    53.7  ), \n\t( ''South Carolina'',        ''SC'',     ''45'' ,      5148714,        40,      30111,     5,         1.6,   202.8  ), \n\t( ''South Dakota'',          ''SD'',     ''46'' ,       884659,        16,      75898,     9,         1.3,    45.9  ), \n\t( ''Tennessee'',             ''TN'',     ''47'' ,      6833174,        34,      41220,     6,         3.0,   322.9  ), \n\t( ''Texas'',                 ''TX'',     ''48'' ,     28995881,         2,     261914,    11,         3.2,  1700.0  ), \n\t( ''Utah'',                  ''UT'',     ''49'' ,      3205958,        12,      82168,    12,         4.3,   157.2  ), \n\t( ''Vermont'',               ''VT'',     ''50'' ,       623989,        43,       9249,     1,         1.2,    30.0  ), \n\t( ''Virginia'',              ''VA'',     ''51'' ,      8535519,        37,      39598,     5,         2.4,    71.3  ), \n\t( ''Virgin Islands'',        ''VI'',     ''78'' ,       106977,        53,         68,    12,         0.24,     3.85), \n\t( ''Washington'',            ''WA'',     ''53'' ,      7614893,        20,      66582,    12,         5.7,   506.7  ), \n\t( ''West Virginia'',         ''WV'',     ''54'' ,      1792147,        41,      24087,     5,         2.4,    71.3  ), \n\t( ''Wisconsin'',             ''WI'',     ''55'' ,      5822434,        25,      54314,     7,         2.5,   299.8  ), \n\t( ''Wyoming'',               ''WY'',     ''56'' ,       578759,         9,      97105,    10,         0.3,    38.4  ) \n; \n \n \nCREATE TABLE name_list ( \n\tname_list_id UUID NOT NULL DEFAULT uuid_generate_v4() primary key, \n\treal_name text check ( length(real_name) \u0026gt;= 1 ) not null, \n\tage int check ( age \u0026gt; 0 and age \u0026lt; 154 ) not  null,\t \n\tstate char varying (2) not null, \n\tpay numeric(10,2)  \n); \n \nCREATE INDEX name_list_idx1 on name_list ( real_name ); \nCREATE INDEX user_real_name_ci_idx1 ON name_list ((lower(real_name))); \n \nALTER TABLE name_list \n\tADD CONSTRAINT name_list_state_fk \n\tFOREIGN KEY (state) \n\tREFERENCES us_state (state) \n; \n \nINSERT INTO name_list ( real_name, age, state, pay ) values \n\t( ''Bob True'',            22, ''WY'', 31000 ), \n\t( ''Jane True'',           20, ''WY'', 28000 ), \n\t( ''Tom Ace'',             31, ''NJ'', 82500 ), \n\t( ''Steve Pen'',           33, ''NJ'', 89400 ), \n\t( ''Laura Jean Alkinoos'', 34, ''PA'', 120000 ), \n\t( ''Philip Schlump'',      62, ''WY'', 101200 ), \n\t( ''Liz Trubune'',         30, ''WY'', 48000 ), \n\t( ''Lary Smith'',          58, ''NJ'', 48000 ), \n\t( ''Dave Dave'',           21, ''NJ'', 48000 ), \n\t( ''Laura Ann Alkinoos'',  34, ''PA'', 48000 ) \n; \n \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eYou should have both states and territories with square miles.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eSELECT * from us_state; \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003ch4\u003eTags: \u0026ldquo;reload data\u0026rdquo;,\u0026ldquo;drop cascade\u0026rdquo;\u003c/h4\u003e\n","Lesson_no":13}' where title_id = 'bebfd235-4782-4932-5330-b1c772c7bec2';


insert into a03_title (id, title) values ( '443bf017-dfe0-4a7d-57a6-3919de171b1e', 'Interactive - 14 - data types'); --x1--
insert into a03_tag ( id, tag ) values ( 'dfdc3f1a-89ad-4f4e-5f64-1773ad2145e0', 'data types' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( 'dfdc3f1a-89ad-4f4e-5f64-1773ad2145e0', '443bf017-dfe0-4a7d-57a6-3919de171b1e' );
insert into ct_file_list ( file_list_id) values ( 'a1402e7b-daa2-425f-5c3c-db2ba8051d63', 14, 'hw14_2.sql' );
update a03_title set body = '{"Lesson":"\u003cstyle\u003e \n.pagebreak { page-break-before: always; } \n.half { height: 200px; } \n\u003c/style\u003e \n \n\n\u003ch1\u003eInteractive - 14 - data types\u003c/h1\u003e\n\n\u003cp\u003eThis is really the stuff from chapter 3 in the book.\u003c/p\u003e\n\n\u003cp\u003eWhen we create a table,  ( Already created in the last homework when you ran the file )\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eCREATE TABLE us_state ( \n\tstate_id UUID NOT NULL DEFAULT uuid_generate_v4() primary key, \n\tstate_name text NOT NULL, \n\tstate char varying (2) NOT NULL, \n\tFIPS_code char varying (2) NOT NULL, \n\tarea_rank int not null default 9999, \n\tarea_sq_mi numeric not null default 0 \n); \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003ewe specify that the columns have a \u0026ldquo;type\u0026rdquo; and constraints on the data.\u003c/p\u003e\n\n\u003cp\u003eThe most common set of types are (ordered from my own code on how frequently I use each type):\u003c/p\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003eType\u003c/th\u003e\n\u003cth\u003eDescription\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003etext\u003c/td\u003e\n\u003ctd\u003ea string of 0 or more characters.\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd\u003evarchar(n)\u003c/td\u003e\n\u003ctd\u003ea string of 0 to \u003ccode\u003en\u003c/code\u003e characters.\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd\u003euuid\u003c/td\u003e\n\u003ctd\u003ea UUID.\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd\u003edate\u003c/td\u003e\n\u003ctd\u003ea date - not a time.\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd\u003etime\u003c/td\u003e\n\u003ctd\u003ea time value.\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd\u003ebigint, int8\u003c/td\u003e\n\u003ctd\u003e8 byte integer\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd\u003etimestamp\u003c/td\u003e\n\u003ctd\u003ea date and a time - usually with a time zone.\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd\u003enumeric\u003c/td\u003e\n\u003ctd\u003ea large number with (think 130k digits, before/after decimal point)\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd\u003edecimal\u003c/td\u003e\n\u003ctd\u003ea large number with (think 130k digits, before/after decimal point)\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd\u003efloat\u003c/td\u003e\n\u003ctd\u003e4 byte - a floating point number with an exponent\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd\u003ereal\u003c/td\u003e\n\u003ctd\u003e4 byte - a floating point number with an exponent\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd\u003ejson, jsonb\u003c/td\u003e\n\u003ctd\u003eJSON data\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd\u003edouble precision\u003c/td\u003e\n\u003ctd\u003e8 byte - a floating point number with an exponent\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd\u003ebit, varbit\u003c/td\u003e\n\u003ctd\u003evariable length bit string values\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd\u003eserial\u003c/td\u003e\n\u003ctd\u003ea 4 byte auto-generated integer that counts up\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd\u003einterval\u003c/td\u003e\n\u003ctd\u003ea time interval can be +/- 178million years\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd\u003ebytea\u003c/td\u003e\n\u003ctd\u003ebyte array - binary data\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd\u003eboolean\u003c/td\u003e\n\u003ctd\u003etrue/false\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd\u003epoint, line\u003c/td\u003e\n\u003ctd\u003egeometric data\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd\u003ebox, path\u003c/td\u003e\n\u003ctd\u003egeometric data\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd\u003epolygon, cirlce\u003c/td\u003e\n\u003ctd\u003egeometric data\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd\u003etvector, tsquery\u003c/td\u003e\n\u003ctd\u003efull text search type\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd\u003einet, cidr\u003c/td\u003e\n\u003ctd\u003einterget address tyeps, IPv4 122.4.3.22 or IPV6\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd\u003euser defined tyeps\u003c/td\u003e\n\u003ctd\u003eThe type system is extensible!\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003cp\u003eAlso there is a Geographic Information Package for PostgreSQL that is very good.\nIt is built on top of the geometric data types and GIN indexes.\u003c/p\u003e\n\n\u003cp\u003eWe are not going to use all of these types.  Just a few of the most common ones like timestamp.\u003c/p\u003e\n\n\u003cp\u003eOften we want a column to show when a new row is inserted or updated in a table.\nLet\u0026rsquo;s add these to our name_list table.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eALTER TABLE name_list add updated timestamp ; \nALTER TABLE name_list add created timestamp  \n\tdefault current_timestamp not null  ; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eTo make the \u0026lsquo;updated\u0026rsquo; column work we need have PostgreSQL run some\ncode when an update happens.  This kind of a thing is called a \u0026ldquo;trigger\u0026rdquo;.\u003c/p\u003e\n\n\u003cp\u003eLet\u0026rsquo;s add a trigger to the table.\u003cbr /\u003e\nRun the file \u003ccode\u003ehw14_2.sql\u003c/code\u003e.  The contents of the file is shown below.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003e \nCREATE OR REPLACE function name_list_upd() \nRETURNS trigger AS  \n$$  \nBEGIN  \n  NEW.updated := current_timestamp;  \n  RETURN NEW;  \nEND  \n$$ \nLANGUAGE ''plpgsql''; \n \n \nCREATE TRIGGER name_list_trig \n\tBEFORE update ON name_list \n\tFOR EACH ROW \n\tEXECUTE PROCEDURE name_list_upd(); \n \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eNow when we do an update on this table it will set the updated field\nto the current time.\u003c/p\u003e\n\n\u003ch4\u003eTags: \u0026ldquo;data types\u0026rdquo;\u003c/h4\u003e\n","Lesson_no":14}' where title_id = '443bf017-dfe0-4a7d-57a6-3919de171b1e';


insert into a03_title (id, title) values ( '9afb366e-5081-45c5-54a3-8a878450dfd5', 'Interactive - 15 - select with group data of data'); --x1--
insert into a03_title_to_tag ( tag_id, title_id ) values ( 'd5a9b52e-590a-49bc-63a5-0d7a79877f9d', '9afb366e-5081-45c5-54a3-8a878450dfd5' );
insert into a03_tag ( id, tag ) values ( 'd1840c92-63a2-4bd9-53c8-549759295349', 'max' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( 'd1840c92-63a2-4bd9-53c8-549759295349', '9afb366e-5081-45c5-54a3-8a878450dfd5' );
insert into a03_tag ( id, tag ) values ( 'e129d246-200b-49c2-68d0-5f8ba45df89f', 'avg' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( 'e129d246-200b-49c2-68d0-5f8ba45df89f', '9afb366e-5081-45c5-54a3-8a878450dfd5' );
insert into a03_tag ( id, tag ) values ( '6579cf42-884c-4fd2-72d6-653b7ac2d858', 'group by' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '6579cf42-884c-4fd2-72d6-653b7ac2d858', '9afb366e-5081-45c5-54a3-8a878450dfd5' );
insert into a03_tag ( id, tag ) values ( 'adcabfb4-1983-452d-7ae3-3b7d62379cdc', 'order by' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( 'adcabfb4-1983-452d-7ae3-3b7d62379cdc', '9afb366e-5081-45c5-54a3-8a878450dfd5' );
insert into a03_tag ( id, tag ) values ( 'b54f478a-8fc5-466e-764a-8ec6a119f3bf', 'nested query' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( 'b54f478a-8fc5-466e-764a-8ec6a119f3bf', '9afb366e-5081-45c5-54a3-8a878450dfd5' );
insert into a03_tag ( id, tag ) values ( '22e9ff91-cdfb-4f94-45d6-86fa4d158c6a', 'sub query' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '22e9ff91-cdfb-4f94-45d6-86fa4d158c6a', '9afb366e-5081-45c5-54a3-8a878450dfd5' );
update a03_title set body = '{"Lesson":"\u003cstyle\u003e \n.pagebreak { page-break-before: always; } \n.half { height: 200px; } \n\u003c/style\u003e \n \n\n\u003ch1\u003eInteractive - 15 - select with group data of data\u003c/h1\u003e\n\n\u003cp\u003eSQL has the ability to group data.  When we use the count() function\nwe are grouping by data.  You can only group by data that you\nselect - you can not group by hidden columns.   However you can\nuse a nested select to pick just some of the columns after you\nhave grouped.  The last part of this homework will show this.\nFirst we have to group the data.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eSELECT  \n\t\tfed_area, \n\t\tmin(gdp_growth) as min_growth, \n\t\tavg(gdp_growth) as avg_growth, \n\t\tmax(gdp_growth) as max_growth, \n\t\tstring_agg(state, '','' ORDER BY state) as  state_list \n\tFROM us_state \n\tGROUP BY fed_area \n\tORDER BY fed_area \n; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eYou can group by more than one column.  All the non-grouped columns\nhave to be in some form aggregated.   In this example we have min, max, avg\nand string_agg.\u003c/p\u003e\n\n\u003cp\u003eTo group columns the database has to sort them.  So an order by is usually\nfree.  If you group by a column that there is a b-tree index on the group\nby is much faster.   The database will use the index instead of re-sorting\nthe data.  Other index types do not provide sorted data (gin, gist, hash etc).\u003c/p\u003e\n\n\u003cp\u003eLet\u0026rsquo;s say we just want the avg_growth and the list of states.  We\nhave to have fed_area to do the grouping - but we can nest\nour select.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eSELECT t1.avg_growth, t1.state_list \n\tFROM ( \n\t\tSELECT  \n\t\t\t\tt2.fed_area, \n\t\t\t\tavg(t2.gdp_growth) as avg_growth, \n\t\t\t\tstring_agg(t2.state, '','' ORDER BY state) as  state_list \n\t\t\tFROM us_state as t2 \n\t\t\tGROUP BY t2.fed_area \n\t) as t1 \n; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003ch2\u003eTake Away\u003c/h2\u003e\n\n\u003col\u003e\n\u003cli\u003egroup by\u003c/li\u003e\n\u003cli\u003eorder by\u003c/li\u003e\n\u003cli\u003emin/avg/max\u003c/li\u003e\n\u003cli\u003enested selects in FROM\u003c/li\u003e\n\u003cli\u003eAliasing tables int the \u0026ldquo;FROM\u0026rdquo; with \u0026ldquo;as\u0026rdquo;\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch2\u003eBook\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003egroup by - page 120 to 121\u003c/li\u003e\n\u003cli\u003emin, max - page 119\u003c/li\u003e\n\u003cli\u003eavg - 64, 195\u003c/li\u003e\n\u003cli\u003eorder by - page 15, 16\u003c/li\u003e\n\u003cli\u003ealias table name - page 86\u003c/li\u003e\n\u003cli\u003enested query in From - page 195 (avg used also)\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch4\u003eTags: \u0026ldquo;min\u0026rdquo;,\u0026ldquo;max\u0026rdquo;,\u0026ldquo;avg\u0026rdquo;,\u0026ldquo;group by\u0026rdquo;,\u0026ldquo;order by\u0026rdquo;,\u0026ldquo;nested query\u0026rdquo;,\u0026ldquo;sub query\u0026rdquo;\u003c/h4\u003e\n","Lesson_no":15}' where title_id = '9afb366e-5081-45c5-54a3-8a878450dfd5';


insert into a03_title (id, title) values ( 'c2bd547c-f83e-45e4-5115-c3097b9171e0', 'Interactive - 16 - count matching rows in a select'); --x1--
insert into a03_title_to_tag ( tag_id, title_id ) values ( '6579cf42-884c-4fd2-72d6-653b7ac2d858', 'c2bd547c-f83e-45e4-5115-c3097b9171e0' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( 'e129d246-200b-49c2-68d0-5f8ba45df89f', 'c2bd547c-f83e-45e4-5115-c3097b9171e0' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( 'adcabfb4-1983-452d-7ae3-3b7d62379cdc', 'c2bd547c-f83e-45e4-5115-c3097b9171e0' );
update a03_title set body = '{"Lesson":"\u003cstyle\u003e \n.pagebreak { page-break-before: always; } \n.half { height: 200px; } \n\u003c/style\u003e \n \n\n\u003ch1\u003eInteractive - 16 - count matching rows in a select\u003c/h1\u003e\n\n\u003cp\u003eYou can count stuff that is grouped.   This turns out to be very useful.\u003c/p\u003e\n\n\u003cp\u003eSuppose that we want to know how many states are in a group and the\nsum of the population in the group.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eSELECT  \n\t\tfed_area, \n\t\tround(avg(gdp_growth)::numeric,2)::text||''%'' as avg_growth, \n\t\tsum(population) as sum_population, \n\t\tcount(state) as no_of_states, \n\t\tstring_agg(state, '','' ORDER BY state) as  state_list \n\tFROM us_state \n\tGROUP BY fed_area \n\tORDER BY 2 desc \n; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eYou should get 12 rows order by decreasing average growth.\u003c/p\u003e\n\n\u003ch2\u003eTake Away\u003c/h2\u003e\n\n\u003col\u003e\n\u003cli\u003eYou can count the number of rows in the group with count.\u003c/li\u003e\n\u003cli\u003eYou can order by a column position this is the \u0026ldquo;2 desc\u0026rdquo;.\u003c/li\u003e\n\u003cli\u003eThe function round() takes a numeric argument - but the output of avg() is a double precision float.  A type cast is used.\u003c/li\u003e\n\u003cli\u003eYou can convert from the numeric result of round to text with a \u0026ldquo;::text\u0026rdquo; type cast - then add the \u0026lsquo;%\u0026rsquo; to show it is a percentage.\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch2\u003eBook\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003egroup by - page 120 to 121\u003c/li\u003e\n\u003cli\u003eavg - 64\u003c/li\u003e\n\u003cli\u003eorder by - page 15, 16\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch4\u003eTags: \u0026ldquo;group by\u0026rdquo;,\u0026ldquo;avg\u0026rdquo;,\u0026ldquo;order by\u0026rdquo;\u003c/h4\u003e\n","Lesson_no":16}' where title_id = 'c2bd547c-f83e-45e4-5115-c3097b9171e0';


insert into a03_title (id, title) values ( '50ec81a5-eb22-4860-66f6-074283ef03ca', 'Interactive - 17 - select with join ( inner join, left outer join )'); --x1--
insert into a03_tag ( id, tag ) values ( '09c71630-6e70-49d9-6160-e3c2a588a3a2', 'inner join' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '09c71630-6e70-49d9-6160-e3c2a588a3a2', '50ec81a5-eb22-4860-66f6-074283ef03ca' );
insert into a03_tag ( id, tag ) values ( 'edc4a2f4-20d5-4ffc-5394-3c0e431b8576', 'outer join' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( 'edc4a2f4-20d5-4ffc-5394-3c0e431b8576', '50ec81a5-eb22-4860-66f6-074283ef03ca' );
insert into a03_tag ( id, tag ) values ( 'c25d2d6b-ae7d-47d7-77ce-065cf5a7a3d4', 'left outer join' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( 'c25d2d6b-ae7d-47d7-77ce-065cf5a7a3d4', '50ec81a5-eb22-4860-66f6-074283ef03ca' );
insert into ct_file_list ( file_list_id) values ( '3bc59679-9edd-42ce-6e86-2d929554d3d3', 17, 'hw17_1.sql' );
update a03_title set body = '{"Lesson":"\u003cstyle\u003e \n.pagebreak { page-break-before: always; } \n.half { height: 200px; } \n\u003c/style\u003e \n \n\n\u003ch1\u003eInteractive - 17 - select with join ( inner join, left outer join )\u003c/h1\u003e\n\n\u003cp\u003eSQL starts to get fun, and become a programming task as soon\nas we have more than one table.\u003c/p\u003e\n\n\u003cp\u003eWe have already seen a join between name_list and us_state based\non state code.  Let\u0026rsquo;s get specific on how joins work and how\nto use them.\u003c/p\u003e\n\n\u003cp\u003eThe most common join is the \u0026ldquo;inner\u0026rdquo; join.   This is when two\ntables have a common field and we match that field.\u003c/p\u003e\n\n\u003cp\u003eThe SQL system takes the first table and creates a loop that\nwill iterate across the 2nd table and where the field matches\nit connects (joins) the data together.\u003c/p\u003e\n\n\u003cp\u003eThis is all based on sets of data.\u003c/p\u003e\n\n\u003cp\u003eSuppose that we have 2 tables, employees and departments.\u003c/p\u003e\n\n\u003ch4\u003eEmployee Table\u003c/h4\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003eName\u003c/th\u003e\n\u003cth\u003eDept Code\u003c/th\u003e\n\u003cth\u003ePay\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003eBob\u003c/td\u003e\n\u003ctd\u003e1\u003c/td\u003e\n\u003ctd\u003e$36,000.00\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd\u003eJane\u003c/td\u003e\n\u003ctd\u003e1\u003c/td\u003e\n\u003ctd\u003e$140,000.00\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd\u003eSally\u003c/td\u003e\n\u003ctd\u003e2\u003c/td\u003e\n\u003ctd\u003e$121,000.00\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd\u003eLiz\u003c/td\u003e\n\u003ctd\u003e2\u003c/td\u003e\n\u003ctd\u003e$101,000.00\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd\u003eDave\u003c/td\u003e\n\u003ctd\u003e1\u003c/td\u003e\n\u003ctd\u003e$51,000,00\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd\u003eCEO Kelly\u003c/td\u003e\n\u003ctd\u003e3\u003c/td\u003e\n\u003ctd\u003e$1.00\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd\u003eUncle Bob\u003c/td\u003e\n\u003ctd\u003eNULL\u003c/td\u003e\n\u003ctd\u003e$96,000.00\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd\u003eBrother Charley\u003c/td\u003e\n\u003ctd\u003eNULL\u003c/td\u003e\n\u003ctd\u003e$48,000.00\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003ch4\u003eDepartment\u003c/h4\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003eDepartment\u003c/th\u003e\n\u003cth\u003eDept Code\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003eSales\u003c/td\u003e\n\u003ctd\u003e1\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd\u003eDevelopment\u003c/td\u003e\n\u003ctd\u003e2\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd\u003eExecutive\u003c/td\u003e\n\u003ctd\u003e3\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd\u003eMaintenance\u003c/td\u003e\n\u003ctd\u003e4\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003cp\u003eBoth tables have \u003ccode\u003eDept_Code\u003c/code\u003e and by matching them\nup we can find that Sally and Liz and the\u003cbr /\u003e\nDevelopment Department.\u003c/p\u003e\n\n\u003cp\u003eFile: \u003ccode\u003ehw17_1.sql\u003c/code\u003e\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003e \nDROP TABLE if exists employee; \nDROP TABLE if exists department; \n \nCREATE TABLE employee ( \n\temployee_id serial not null primary key, \n\tname text not null, \n\tdepartment_id  int, \n\tpay numeric(12,2) not null default 0 \n); \n \nCREATE TABLE department ( \n\tdepartment_id  serial not null primary key, \n\tdept_name text not null \n); \n \nINSERT INTO department ( department_id, dept_name ) values \n\t( 1, ''Sales'' ), \n\t( 2, ''Development'' ), \n\t( 3, ''Execuatie'' ), \n\t( 4, ''Maintenance'' ) \n; \n \nINSERT INTO employee (  name, department_id, pay ) values\t \n\t( ''Bob'', 1, 36000 ), \n\t( ''Jane'', 1, 140000 ), \n\t( ''Sally'', 2, 121000 ), \n\t( ''Liz'', 2, 101000 ), \n\t( ''Dave'', 1, 51000 ), \n\t( ''CEO Kelly'', 3, 1 ), \n\t( ''Uncle Bob'', NULL, 96000 ), \n\t( ''Brother Charley'', NULL, 48000 ) \n; \n \n \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eWe have created the table department with a set of used IDs, 1..4.  We need\nto update the number generator for the \u003ccode\u003eserial\u003c/code\u003e data to reflect this.\nIf we don\u0026rsquo;t it will start with 1 and we have already used 1.  We will not\nbe able to insert data into it.\u003c/p\u003e\n\n\u003cp\u003eThe command to do this is:\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eALTER SEQUENCE department_department_id_seq RESTART WITH 5; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eHowever you will want to be able to generate this kind of an alter.\nThe name for the sequence is,  the table name, concatenated with\nan underscore, then the column name, then \u003ccode\u003e_seq\u003c/code\u003e.\u003c/p\u003e\n\n\u003ch2\u003eInner Join\u003c/h2\u003e\n\n\u003cp\u003eThis is the set that both tables have in common.\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"PostgreSQL-Inner-Join.png\" alt=\"PostgreSQL Inner Join\" /\u003e\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eSELECT t1.name as \u0026quot;Employee Name\u0026quot;, t2.dept_name as \u0026quot;Department Name\u0026quot;, t1.pay \u0026quot;Year pay\u0026quot; \n\tFROM employee as t1 \n\t\tJOIN department as t2 on ( t1.department_id = t2.department_id ) \n; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eYou should get back 6 rows.  Note that \u0026ldquo;Uncle Bob\u0026rdquo; fails to show up.\nThis is an inner join - where the common field is not null.\u003c/p\u003e\n\n\u003cp\u003eNote the double quotes \u003ccode\u003e\u0026quot;\u003c/code\u003e around the column names to allow for upper-lower\ncase aliases on column names.\u003c/p\u003e\n\n\u003cp\u003eWe can get the database to fill in NULLs for all the values for\n\u003ccode\u003eUncle Bob\u003c/code\u003e.  This is a left outer join.  This is the 2nd most common\njoin.\u003c/p\u003e\n\n\u003ch2\u003eLeft Outer Join\u003c/h2\u003e\n\n\u003cp\u003eThis is all the rows in the FROM table joined to the right table\nor NULLs where they don\u0026rsquo;t join.\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"PostgreSQL-Left-Outer-Join.png\" alt=\"Left Outer Join\" /\u003e\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eSELECT t1.name as \u0026quot;Employee Name\u0026quot;, t2.dept_name as \u0026quot;Department Name\u0026quot;, t1.pay \u0026quot;Year Pay\u0026quot; \n\tFROM employee as t1 \n\t\tLEFT OUTER JOIN department as t2 on ( t1.department_id = t2.department_id ) \n; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eNow you should get back 8 rows including \u0026ldquo;Uncle Bob\u0026rdquo;.\u003c/p\u003e\n\n\u003cp\u003eNow we can answer the question how many people are not in departments and\nhow much do they get payed.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eSELECt t1.name as \u0026quot;Employee Name\u0026quot;, t2.dept_name as \u0026quot;Department Name\u0026quot;, t1.pay \u0026quot;Year Pay\u0026quot; \n\tFROM employee as t1 \n\t\tLEFT OUTER JOIN department as t2 on ( t1.department_id = t2.department_id ) \n\tWHERE t1.department_id is null \n; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eor how much pay is spent on employees not in departments.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eSELECT sum(t0.pay) as \u0026quot;Total Pay\u0026quot; \nFROM ( \n\tSELECT t1.name, t2.dept_name, t1.pay  \n\tFROM employee as t1 \n\t\tleft outer join department as t2 on ( t1.department_id = t2.department_id ) \n\tWHERE t1.department_id is null \n) t0 \n; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eInteresting \u0026hellip;. That is $144,000.00 payed out to employees that aren\u0026rsquo;t in\ndepartments.\u003c/p\u003e\n\n\u003cp\u003eThere are \u0026ldquo;right\u0026rdquo; joins but usually I just swap the order of the tables and use the left joins.\u003c/p\u003e\n\n\u003ch4\u003eTags: \u0026ldquo;inner join\u0026rdquo;,\u0026ldquo;outer join\u0026rdquo;,\u0026ldquo;left outer join\u0026rdquo;\u003c/h4\u003e\n","Lesson_no":17}' where title_id = '50ec81a5-eb22-4860-66f6-074283ef03ca';


insert into a03_title (id, title) values ( '7c86e4bb-38db-4b6d-6c22-21743ce0ecfb', 'Interactive - 18 - More joins (full joins)'); --x1--
insert into a03_tag ( id, tag ) values ( '1bd4f69a-0ece-4705-721f-a284828bf684', 'full join' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '1bd4f69a-0ece-4705-721f-a284828bf684', '7c86e4bb-38db-4b6d-6c22-21743ce0ecfb' );
insert into a03_tag ( id, tag ) values ( '68d834bc-fd54-4e04-7256-c11d0cfe4dfa', 'full outer join' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '68d834bc-fd54-4e04-7256-c11d0cfe4dfa', '7c86e4bb-38db-4b6d-6c22-21743ce0ecfb' );
update a03_title set body = '{"Lesson":"\u003cstyle\u003e \n.pagebreak { page-break-before: always; } \n.half { height: 200px; } \n\u003c/style\u003e \n \n\n\u003ch1\u003eInteractive - 18 - More joins (full joins)\u003c/h1\u003e\n\n\u003cp\u003eWe will use the same data (hw17_1.sql)\u003c/p\u003e\n\n\u003ch4\u003eEmployee Table\u003c/h4\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003eName\u003c/th\u003e\n\u003cth\u003eDept Code\u003c/th\u003e\n\u003cth\u003ePay\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003eBob\u003c/td\u003e\n\u003ctd\u003e1\u003c/td\u003e\n\u003ctd\u003e$36,000.00\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd\u003eJane\u003c/td\u003e\n\u003ctd\u003e1\u003c/td\u003e\n\u003ctd\u003e$140,000.00\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd\u003eSally\u003c/td\u003e\n\u003ctd\u003e2\u003c/td\u003e\n\u003ctd\u003e$121,000.00\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd\u003eLiz\u003c/td\u003e\n\u003ctd\u003e2\u003c/td\u003e\n\u003ctd\u003e$101,000.00\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd\u003eDave\u003c/td\u003e\n\u003ctd\u003e1\u003c/td\u003e\n\u003ctd\u003e$51,000,00\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd\u003eCEO Kelly\u003c/td\u003e\n\u003ctd\u003e3\u003c/td\u003e\n\u003ctd\u003e$1.00\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd\u003eUncle Bob\u003c/td\u003e\n\u003ctd\u003eNULL\u003c/td\u003e\n\u003ctd\u003e$96,000.00\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd\u003eBrother Charley\u003c/td\u003e\n\u003ctd\u003eNULL\u003c/td\u003e\n\u003ctd\u003e$48,000.00\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003ch4\u003eDepartment\u003c/h4\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003eDepartment\u003c/th\u003e\n\u003cth\u003eDept Code\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003eSales\u003c/td\u003e\n\u003ctd\u003e1\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd\u003eDevelopment\u003c/td\u003e\n\u003ctd\u003e2\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd\u003eExecutive\u003c/td\u003e\n\u003ctd\u003e3\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd\u003eMaintenance\u003c/td\u003e\n\u003ctd\u003e4\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003ch2\u003eFull Join\u003c/h2\u003e\n\n\u003cp\u003eThis is more of a concatenation of rows of data.\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"PostgreSQL-Full-Outer-Join.png\" alt=\"Full Outer Join\" /\u003e\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eSELECT t1.name as \u0026quot;Employee Name\u0026quot;, t2.dept_name as \u0026quot;Department Name\u0026quot;, t1.pay \u0026quot;Year pay\u0026quot; \n\tFROM employee as t1 \n\t\tFULL JOIN  department as t2 on ( t1.department_id = t2.department_id ) \n; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eYou shoudl get back 9 rows - note where the NULL values are.\u003c/p\u003e\n\n\u003ch2\u003eFull Outer Join - Unique to Both tables Rows\u003c/h2\u003e\n\n\u003cp\u003eYou can also use the join to find the rows that are unique in each table.\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"PostgreSQL-Full-Outer-Unique-Join.png\" alt=\"PostgreSQL Inner Join\" /\u003e\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eSELECT t1.name as \u0026quot;Employee Name\u0026quot;, t2.dept_name as \u0026quot;Department Name\u0026quot;, t1.pay \u0026quot;Year pay\u0026quot; \n\tFROM employee as t1 \n\t\tFULL JOIN department as t2 on ( t1.department_id = t2.department_id ) \n\tWHERE t1.name is null  \n\t   OR t2.dept_name is null \n; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eYou should get back 3 rows.\u003c/p\u003e\n\n\u003ch4\u003eTags: \u0026ldquo;full join\u0026rdquo;,\u0026ldquo;full outer join\u0026rdquo;\u003c/h4\u003e\n","Lesson_no":18}' where title_id = '7c86e4bb-38db-4b6d-6c22-21743ce0ecfb';


insert into a03_title (id, title) values ( '5f77fe62-ba7c-4a7d-7922-ec35d0057289', 'Interactive - 19 - select using sub-query and exists'); --x1--
insert into a03_tag ( id, tag ) values ( 'cb34f1f6-1123-433a-5fe9-6d3c7eae2627', 'select exists' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( 'cb34f1f6-1123-433a-5fe9-6d3c7eae2627', '5f77fe62-ba7c-4a7d-7922-ec35d0057289' );
insert into a03_tag ( id, tag ) values ( 'e39ba9cc-f575-4f05-615a-0d4c36697b91', 'sub-query' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( 'e39ba9cc-f575-4f05-615a-0d4c36697b91', '5f77fe62-ba7c-4a7d-7922-ec35d0057289' );
update a03_title set body = '{"Lesson":"\u003cstyle\u003e \n.pagebreak { page-break-before: always; } \n.half { height: 200px; } \n\u003c/style\u003e \n \n\n\u003ch1\u003eInteractive - 19 - select using sub-query and exists\u003c/h1\u003e\n\n\u003cp\u003eLet\u0026rsquo;s use some of our joins to delete some data.\u003c/p\u003e\n\n\u003cp\u003eLet\u0026rsquo;s get rid of the people that are not in a department.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eSELECT t0.name as \u0026quot;Employee Name\u0026quot;, t0.dept_name as \u0026quot;Department Name\u0026quot;, t0.pay \u0026quot;Year Pay\u0026quot; \n\tFROM  ( \n\t\t\tSELECT t1.name, t2.dept_name, t1.pay, t1.employee_id \n\t\t\tFROM employee as t1 \n\t\t\t\tLEFT OUTER join department as t2 on ( t1.department_id = t2.department_id ) \n\t\t\tWHERE t1.department_id is null \n\t\t\tORDER BY 1, 3 desc, 4 \n\t\t) as t0 \n\tWHERE  \n\t\texists ( \n\t\t\tSELECT ''found'' \n\t\t\tFROM employee as t5 \n\t\t\tWHERE t5.pay \u0026gt; 65000 \n\t\t\t  and t5.employee_id = t0.employee_id \n\t\t) \n; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eYou should get back 2 rows.\u003c/p\u003e\n\n\u003cp\u003eThese rows should be the offending rows with the department-less employees.\u003c/p\u003e\n\n\u003ch4\u003eTags: \u0026ldquo;select exists\u0026rdquo;,\u0026ldquo;sub-query\u0026rdquo;\u003c/h4\u003e\n","Lesson_no":19}' where title_id = '5f77fe62-ba7c-4a7d-7922-ec35d0057289';


insert into a03_title (id, title) values ( '97419b4e-1bd8-4e09-5d82-516c7e3072d5', 'Interactive - 20 - delete with in based sub-query'); --x1--
insert into a03_tag ( id, tag ) values ( '263a387d-40ec-4bc1-729b-691088d21f6c', 'delete exists' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '263a387d-40ec-4bc1-729b-691088d21f6c', '97419b4e-1bd8-4e09-5d82-516c7e3072d5' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( 'e39ba9cc-f575-4f05-615a-0d4c36697b91', '97419b4e-1bd8-4e09-5d82-516c7e3072d5' );
update a03_title set body = '{"Lesson":"\u003cstyle\u003e \n.pagebreak { page-break-before: always; } \n.half { height: 200px; } \n\u003c/style\u003e \n \n\n\u003ch1\u003eInteractive - 20 - delete with in based sub-query\u003c/h1\u003e\n\n\u003cp\u003eLet\u0026rsquo;s use some of our joins to delete some data.\u003c/p\u003e\n\n\u003cp\u003eWe will recreate the data from homework 17 again.  The file is hw17_1.sql\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003e \nDROP TABLE if exists employee; \nDROP TABLE if exists department; \n \nCREATE TABLE employee ( \n\temployee_id serial not null primary key, \n\tname text not null, \n\tdepartment_id  int, \n\tpay numeric(12,2) not null default 0 \n); \n \nCREATE TABLE department ( \n\tdepartment_id  serial not null primary key, \n\tdept_name text not null \n); \n \nINSERT INTO department ( department_id, dept_name ) values \n\t( 1, ''Sales'' ), \n\t( 2, ''Development'' ), \n\t( 3, ''Execuatie'' ), \n\t( 4, ''Maintenance'' ) \n; \n \nINSERT INTO employee (  name, department_id, pay ) values\t \n\t( ''Bob'', 1, 36000 ), \n\t( ''Jane'', 1, 140000 ), \n\t( ''Sally'', 2, 121000 ), \n\t( ''Liz'', 2, 101000 ), \n\t( ''Dave'', 1, 51000 ), \n\t( ''CEO Kelly'', 3, 1 ), \n\t( ''Uncle Bob'', NULL, 96000 ), \n\t( ''Brother Charley'', NULL, 48000 ) \n; \n \n \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eLet\u0026rsquo;s get rid of the people that are not in a department.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eDELETE FROM employee as t0 \n\tWHERE t0.employee_id in ( \n\t\tSELECT t1.employee_id \n\t\tFROM employee as t1 \n\t\t\tLEFT OUTER join department as t2 on ( t1.department_id = t2.department_id ) \n\t\tWHERE t1.department_id is null \n\t) \n; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eIt should delete 2 rows.\u003c/p\u003e\n\n\u003cp\u003eThere are performance reasons to use either exists or in.  Exists combines the queries and is better when the tables are similar in size.\nIn is usually better when the left table is much smaller than the parent table.  In results in the inside query running to completion\nbefore the outside query.\u003c/p\u003e\n\n\u003ch4\u003eTags: \u0026ldquo;delete exists\u0026rdquo;,\u0026ldquo;sub-query\u0026rdquo;\u003c/h4\u003e\n","Lesson_no":20}' where title_id = '97419b4e-1bd8-4e09-5d82-516c7e3072d5';


insert into a03_title (id, title) values ( '6a1540fa-61df-4cdb-4fd8-6256e2adf813', 'Interactive - 21 - select with union / minus'); --x1--
insert into a03_tag ( id, tag ) values ( '7c08cc40-1541-4bcc-6600-07ac12336714', 'union' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '7c08cc40-1541-4bcc-6600-07ac12336714', '6a1540fa-61df-4cdb-4fd8-6256e2adf813' );
update a03_title set body = '{"Lesson":"\u003cstyle\u003e \n.pagebreak { page-break-before: always; } \n.half { height: 200px; } \n\u003c/style\u003e \n \n\n\u003ch1\u003eInteractive - 21 - select with union / minus\u003c/h1\u003e\n\n\u003cp\u003eYou can concatenate results with a \u0026ldquo;UNION\u0026rdquo; between two selects.  This can be kind of like a full join\nbut instead of getting back nulls you can fill in values that you like.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003e\tSELECT t1.name as \u0026quot;Employee Name\u0026quot;, ''No Departmnt'' \u0026quot;Department Name\u0026quot;, t1.pay \u0026quot;Year Pay\u0026quot; \n\tFROM employee as t1 \n\tWHERE t1.department_id is null \nUNION \n\tSELECT ''No Name'' as \u0026quot;Employee Name\u0026quot;, t2.dept_name as \u0026quot;Department Name\u0026quot;, 0.0 \u0026quot;Year Pay\u0026quot; \n\tFROM department as t2  \nORDER BY 1 \n; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eYou should get back 4 rows.\u003c/p\u003e\n\n\u003ch4\u003eTags: \u0026ldquo;union\u0026rdquo;\u003c/h4\u003e\n","Lesson_no":21}' where title_id = '6a1540fa-61df-4cdb-4fd8-6256e2adf813';


insert into a03_title (id, title) values ( 'cfa3a093-e97d-46df-7f9f-ef5386ad8ddf', 'Interactive - 22 - recursive select - populating existing tables'); --x1--
insert into a03_tag ( id, tag ) values ( '4336b4c3-af83-48ff-450b-5ba879a79a7a', 'recursive select' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '4336b4c3-af83-48ff-450b-5ba879a79a7a', 'cfa3a093-e97d-46df-7f9f-ef5386ad8ddf' );
insert into a03_tag ( id, tag ) values ( '89fa2a85-5bbd-4644-7804-6d40c1d3f618', 'recursive' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '89fa2a85-5bbd-4644-7804-6d40c1d3f618', 'cfa3a093-e97d-46df-7f9f-ef5386ad8ddf' );
insert into ct_file_list ( file_list_id) values ( 'cfe20061-e9cd-4711-73ac-4d09e2df5ae1', 22, 'hw22_1.sql' );
update a03_title set body = '{"Lesson":"\u003cstyle\u003e \n.pagebreak { page-break-before: always; } \n.half { height: 200px; } \n\u003c/style\u003e \n \n\n\u003ch1\u003eInteractive - 22 - recursive select - populating existing tables\u003c/h1\u003e\n\n\u003cp\u003eIt is also possible to store and query recursive data.   You need a table\nwith and \u0026ldquo;id\u0026rdquo; and a \u0026ldquo;parent_id\u0026rdquo; that referees back to the same table.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eDROP TABLE if exists tree_example ; \n \nCREATE TABLE tree_example ( \n\tid  \t\t\tint not null primary key, \n\tmanager_id  \tint, \n\tname \t\t\ttext \n); \n \nINSERT INTO tree_example ( id, name, manager_id ) values \n\t(1, ''Michael North'', NULL), \n\t(2, ''Megan Berry'', 1), \n\t(3, ''Sarah Berry'', 1), \n\t(4, ''Zoe Black'', 1), \n\t(5, ''Tim James'', 1), \n\t(6, ''Bella Tucker'', 2), \n\t(7, ''Ryan Metcalfe'', 2), \n\t(8, ''Max Mills'', 2), \n\t(9, ''Benjamin Glover'', 2), \n\t(10, ''Carolyn Henderson'', 3), \n\t(11, ''Nicola Kelly'', 3), \n\t(12, ''Alexandra Climo'', 3), \n\t(13, ''Dominic King'', 3), \n\t(14, ''Leonard Gray'', 4), \n\t(15, ''Eric Rampling'', 4), \n\t(16, ''Piers Paige'', 7), \n\t(17, ''Ryan Henderson'', 7), \n\t(18, ''Frank Tucker'', 8), \n\t(19, ''Nathan Ferguson'', 8), \n\t(20, ''Kevin Rampling'', 8) \n; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eNow we can to a recursive query.   In PostgreSQL they are composed of a base query\nunironed with all the children.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eWITH RECURSIVE subordinates AS ( \n\t\tSELECT \n\t\t\tid, \n\t\t\tmanager_id, \n\t\t\tname \n\t\tFROM tree_example \n\t\tWHERE id = 2 \n\tUNION \n\t\tSELECT \n\t\t\te.id, \n\t\t\te.manager_id, \n\t\t\te.name \n\t\tFROM tree_example e \n\t\tINNER JOIN subordinates s ON s.id = e.manager_id \n) SELECT * FROM subordinates \n; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003ch4\u003eTags: \u0026ldquo;recursive select\u0026rdquo;,recursive\u003c/h4\u003e\n","Lesson_no":22}' where title_id = 'cfa3a093-e97d-46df-7f9f-ef5386ad8ddf';


insert into a03_title (id, title) values ( '79819ff4-9118-435f-5528-b99279837f4a', 'Interactive - 23 - with - pre-selects to do stuff.'); --x1--
insert into a03_tag ( id, tag ) values ( '778f9f42-2e47-468e-632b-60ace65c6228', 'with' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '778f9f42-2e47-468e-632b-60ace65c6228', '79819ff4-9118-435f-5528-b99279837f4a' );
insert into a03_tag ( id, tag ) values ( '2a198749-0e79-4786-5e92-bf70e427f60b', 'with select' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '2a198749-0e79-4786-5e92-bf70e427f60b', '79819ff4-9118-435f-5528-b99279837f4a' );
update a03_title set body = '{"Lesson":"\u003cstyle\u003e \n.pagebreak { page-break-before: always; } \n.half { height: 200px; } \n\u003c/style\u003e \n \n\n\u003ch1\u003eInteractive - 23 - with - pre-selects to do stuff.\u003c/h1\u003e\n\n\u003cp\u003eYou can run queries before your main query and give the results names.\nThese are run in order and that can have substantial advantages.\u003c/p\u003e\n\n\u003cp\u003eThe general syntax is\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003ewith \n\ttemp_name as ( select ... ) \n \nselect stufff. \n \n\tfrom  temp_name \n \n; \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cpre\u003e\u003ccode\u003eWITH \n\tmystery_employess as ( select sum(pay) total_pay  from name_list where state = ''WY'' ), \n\tnormal_employees as ( select sum(pay) total_pay from name_list where state in ( ''NJ'', ''NY'' ) ) \nSELECT round( ( tWY.total_pay / ( tWY.total_pay + tEast.total_pay ) ) * 100.0, 2)  as relative_pay \nFROM  \n\tmystery_employess  as tWY \n\t, normal_employees  as tEast \n; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eYou should get back a single row of data that tells you that in Wyoming you get 43% as much pay\nas a job in NY or NJ (Note that the data in this example is not totally accurate.  Also you have\na much lower cost of living in Wyoming than you do in NY NY.)\u003c/p\u003e\n\n\u003ch4\u003eTags: \u0026ldquo;with\u0026rdquo;,\u0026ldquo;with select\u0026rdquo;\u003c/h4\u003e\n","Lesson_no":23}' where title_id = '79819ff4-9118-435f-5528-b99279837f4a';


insert into a03_title (id, title) values ( 'e500e12f-3c0b-465d-6a77-1d4336e020d4', 'Interactive - 24 - truncate table'); --x1--
insert into a03_tag ( id, tag ) values ( '3007d908-6042-41e1-44d0-50f1e545144b', 'truncate' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '3007d908-6042-41e1-44d0-50f1e545144b', 'e500e12f-3c0b-465d-6a77-1d4336e020d4' );
insert into a03_tag ( id, tag ) values ( '06ca5acf-cc6e-4d83-728a-f1e64e277af5', 'fast delete' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '06ca5acf-cc6e-4d83-728a-f1e64e277af5', 'e500e12f-3c0b-465d-6a77-1d4336e020d4' );
insert into a03_tag ( id, tag ) values ( 'a285d924-32ca-47c6-7e7f-00d717bfb93b', 'delete all rows' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( 'a285d924-32ca-47c6-7e7f-00d717bfb93b', 'e500e12f-3c0b-465d-6a77-1d4336e020d4' );
update a03_title set body = '{"Lesson":"\u003cstyle\u003e \n.pagebreak { page-break-before: always; } \n.half { height: 200px; } \n\u003c/style\u003e \n \n\n\u003ch1\u003eInteractive - 24 - truncate table\u003c/h1\u003e\n\n\u003cp\u003ePostgreSQL (and most other SQL databases, Oracle, DB/2, DB/2 Universal etc)\nprovide the ability to discard ALL the data in a table.     This is implemented\nas a re-write of the table header info and putting all the data in the table\non the re-claim block list.  So it is linear time(fast).\u003c/p\u003e\n\n\u003cp\u003eAlso it is a part of the Data Definition Language (not Data Manipulation)\nso it often can not be used in a transaction.  It can not be rolled back\nif the transaction fails.\u003c/p\u003e\n\n\u003cp\u003eAlso when you use truncate stuff like triggers for delete will not fire.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eTRUNCATE TABLE name_list; \nSELECT count(1) from name_list; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eYou should get back 0 rows.\u003c/p\u003e\n\n\u003ch4\u003eTags: \u0026ldquo;truncate\u0026rdquo;,\u0026ldquo;fast delete\u0026rdquo;,\u0026ldquo;delete all rows\u0026rdquo;\u003c/h4\u003e\n","Lesson_no":24}' where title_id = 'e500e12f-3c0b-465d-6a77-1d4336e020d4';


insert into a03_title (id, title) values ( 'c7381fe7-03b7-4c7e-734a-7c1f646d0b56', 'Interactive - 25 - drop cascade'); --x1--
insert into a03_tag ( id, tag ) values ( '56f3e4e5-e93d-42ad-7009-e868382aa59f', 'drop' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '56f3e4e5-e93d-42ad-7009-e868382aa59f', 'c7381fe7-03b7-4c7e-734a-7c1f646d0b56' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '22a4c0cf-0fc4-4b8b-6e6c-ec2a9b2abfc4', 'c7381fe7-03b7-4c7e-734a-7c1f646d0b56' );
insert into ct_file_list ( file_list_id) values ( 'be060328-424e-44ed-5e5a-60cac1a20f28', 25, 'hw13_4.sql' );
insert into ct_file_list ( file_list_id) values ( '484fbde0-0e9b-4400-786c-2cf2f1f3a683', 25, 'hw25_2.sql' );
update a03_title set body = '{"Lesson":"\u003cstyle\u003e \n.pagebreak { page-break-before: always; } \n.half { height: 200px; } \n\u003c/style\u003e \n \n\n\u003ch1\u003eInteractive - 25 - drop cascade\u003c/h1\u003e\n\n\u003cp\u003eYou can drop a table or other database object.  This destroys it.\nPostgreSQL provides the ability to do the \u0026ldquo;drop\u0026rdquo; but only if\nthe object exists.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003edrop table name_list; \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eWill error if the object is not there.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eDROP TABLE if exists name_list cascade; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eDrop can also detach a table from the set of constraints that it\nmay have.  This is the \u0026ldquo;cascade\u0026rdquo; option to remove foreign\nkey constraints.  Do note that in Oracle this will drop\nadditional tables - not just constraints.  Take care with\n\u0026ldquo;cascade\u0026rdquo;.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eDROP TABLE if exists us_state cascade; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eLet\u0026rsquo;s re-create our tables at this point so we have fresh\ndata for future homework problems.\u003c/p\u003e\n\n\u003cp\u003eRun the file to re-create : hw13_4.sql\u003c/p\u003e\n\n\u003cp\u003edrop table if exists us_state cascade;\u003c/p\u003e\n\n\u003ch4\u003eTags: \u0026ldquo;drop\u0026rdquo;,\u0026ldquo;drop cascade\u0026rdquo;\u003c/h4\u003e\n","Lesson_no":25}' where title_id = 'c7381fe7-03b7-4c7e-734a-7c1f646d0b56';


insert into a03_title (id, title) values ( '57f7a378-dba1-420d-6236-f6ce3305c61d', 'Interactive - 26 - 1 to 1 relationship  				(pk to pk)'); --x1--
insert into a03_tag ( id, tag ) values ( '168a492a-dd2d-422e-5909-93719c859f4a', 'setup' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '168a492a-dd2d-422e-5909-93719c859f4a', '57f7a378-dba1-420d-6236-f6ce3305c61d' );
insert into a03_tag ( id, tag ) values ( '8d7d27d2-820c-4c3c-4d9c-e20abb6e7ab9', 'a03_title' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '8d7d27d2-820c-4c3c-4d9c-e20abb6e7ab9', '57f7a378-dba1-420d-6236-f6ce3305c61d' );
insert into a03_tag ( id, tag ) values ( '5ecfaeef-a157-4dfb-6503-7933496e8d37', 'ct_homework_ans' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '5ecfaeef-a157-4dfb-6503-7933496e8d37', '57f7a378-dba1-420d-6236-f6ce3305c61d' );
insert into a03_tag ( id, tag ) values ( '3920b825-45e1-43de-6649-133810b8b321', 'ct_tag' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '3920b825-45e1-43de-6649-133810b8b321', '57f7a378-dba1-420d-6236-f6ce3305c61d' );
insert into a03_tag ( id, tag ) values ( 'b9124c23-5983-4c6f-6194-f23a53efce1e', 'a03_title_to_tag' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( 'b9124c23-5983-4c6f-6194-f23a53efce1e', '57f7a378-dba1-420d-6236-f6ce3305c61d' );
insert into a03_tag ( id, tag ) values ( '302ccbf3-63ef-45e5-5e0d-70cacca3a241', 't_ymux_user' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '302ccbf3-63ef-45e5-5e0d-70cacca3a241', '57f7a378-dba1-420d-6236-f6ce3305c61d' );
insert into a03_tag ( id, tag ) values ( 'cf118384-282f-413d-6fe9-2a12780b4265', 't_ymux_user_log' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( 'cf118384-282f-413d-6fe9-2a12780b4265', '57f7a378-dba1-420d-6236-f6ce3305c61d' );
insert into a03_tag ( id, tag ) values ( '586dfc9f-d348-49a6-5f97-cf2638bd930b', 't_ymux_auth_token' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '586dfc9f-d348-49a6-5f97-cf2638bd930b', '57f7a378-dba1-420d-6236-f6ce3305c61d' );
insert into ct_file_list ( file_list_id) values ( '131186f9-dbcb-440e-62aa-2917d3878409', 26, 'hw26_01.sql' );
insert into ct_file_list ( file_list_id) values ( '485df65d-b1a8-46d6-41e7-55a25b072696', 26, 'hw26_02.sql' );
insert into ct_file_list ( file_list_id) values ( '2f3cebb6-a98e-43d9-52e0-c1b90996a456', 26, 'hw26_03.sql' );
insert into ct_file_list ( file_list_id) values ( '07aa8a0c-a296-4802-7538-e081f6e08d3b', 26, 'hw26_04.sql' );
insert into ct_file_list ( file_list_id) values ( '3ed682d5-242d-43dd-79aa-8884f021aa3b', 26, 'hw26_05.sql' );
insert into ct_file_list ( file_list_id) values ( '56eecc11-4eb6-4c00-7034-5f0c59fe2487', 26, 'hw26_06.sql' );
insert into ct_file_list ( file_list_id) values ( '5ea8bff9-e60e-42a7-5cb7-b2c8df7bdf9a', 26, 'hw26_07.sql' );
insert into ct_file_list ( file_list_id) values ( 'c34f2dc5-155a-45a1-707d-73b1ac9e9fd6', 26, 'hw26_08.sql' );
insert into ct_file_list ( file_list_id) values ( 'b27da3f3-5991-468b-7e2d-81b1e74ae22d', 26, 'hw26_09.sql' );
insert into ct_file_list ( file_list_id) values ( 'dab93d59-a988-46b7-4fb3-b7e0f8e3a32e', 26, 'hw26_10.sql' );
insert into ct_file_list ( file_list_id) values ( '88f2c119-cde2-4b29-5250-42ed74669729', 26, 'hw26_11.sql' );
insert into ct_file_list ( file_list_id) values ( '49006907-defa-4a0a-5d3b-2ec6d4756901', 26, 'hw26_14.sql' );
update a03_title set body = '{"Lesson":"\u003cstyle\u003e \n.pagebreak { page-break-before: always; } \n.half { height: 200px; } \n\u003c/style\u003e \n \n\n\u003ch1\u003eInteractive - 26 - 1 to 1 relationship                (pk to pk)\u003c/h1\u003e\n\n\u003cp\u003eThis exercise creates a bunch of tables, triggers indexes.  Run each of the files.\u003c/p\u003e\n\n\u003cp\u003eThe application uses a small set of user authorization tables from a wrapper application.\nWe have to create the tables and the tables that match with in the application.\u003c/p\u003e\n\n\u003cp\u003eOur 1 to 1 relationship is between \u003ccode\u003e\u0026quot;t_ymux_user\u0026quot;\u003c/code\u003e and our application table\n\u003ccode\u003ect_login\u003c/code\u003e.    ct_login privies extra application specific columns that every user has\nto have.\u003c/p\u003e\n\n\u003cp\u003eWe are just going to create all 6 tables - then explore the relationships.\u003c/p\u003e\n\n\u003ch2\u003e3 Tables From The Security Application\u003c/h2\u003e\n\n\u003cp\u003eThe Tables are \u0026ldquo;t_ymux_user\u0026rdquo; , \u0026ldquo;ct_homework_ans\u0026rdquo;  and  \u0026ldquo;t_ymux_user_log\u0026rdquo; .\u003c/p\u003e\n\n\u003cp\u003eRun the file \u003ccode\u003ehw26_01.sql\u003c/code\u003e\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eCREATE EXTENSION if not exists \u0026quot;uuid-ossp\u0026quot;; \nCREATE EXTENSION if not exists pgcrypto; \n \nDROP TABLE if exists \u0026quot;t_ymux_user\u0026quot; cascade ; \n \nCREATE TABLE \u0026quot;t_ymux_user\u0026quot; ( \n\t  \u0026quot;id\u0026quot;\t\t\t\t\tuuid DEFAULT uuid_generate_v4() not null primary key \n\t, \u0026quot;username\u0026quot; \t\t\ttext \n\t, \u0026quot;password\u0026quot; \t\t\ttext \n\t, \u0026quot;realm\u0026quot; \t\t\t\ttext \n\t, \u0026quot;real_name\u0026quot; \t\t\ttext \n\t, \u0026quot;salt\u0026quot; \t\t\t\ttext \n\t, \u0026quot;email\u0026quot; \t\t\t\ttext \n\t, \u0026quot;email_confirmed\u0026quot; \tchar varying (1) default ''n'' not null \n\t, \u0026quot;setup_2fa_complete\u0026quot; \tchar varying (1) default ''n'' not null \n\t, \u0026quot;rfc_6238_secret\u0026quot;\t\ttext  \n\t, \u0026quot;recovery_token\u0026quot; \t\ttext \n\t, \u0026quot;recovery_expire\u0026quot; \ttimestamp \n\t, \u0026quot;parent_user_id\u0026quot;\t\tuuid \n\t, \u0026quot;org_user_id\u0026quot;\t\t\tuuid \n\t, \u0026quot;auth_token\u0026quot;\t\t\ttext  \n\t, \u0026quot;acct_expire\u0026quot; \t\ttimestamp \n\t, \u0026quot;updated\u0026quot; \t\t\ttimestamp \n\t, \u0026quot;created\u0026quot; \t\t\ttimestamp default current_timestamp not null \n); \n \n \ncreate unique index \u0026quot;t_ymux_user_u1\u0026quot; on \u0026quot;t_ymux_user\u0026quot; ( \u0026quot;username\u0026quot; ); \ncreate index \u0026quot;t_ymux_user_p1\u0026quot; on \u0026quot;t_ymux_user\u0026quot; ( \u0026quot;email\u0026quot; ); \ncreate unique index \u0026quot;t_ymux_user_u3\u0026quot; on \u0026quot;t_ymux_user\u0026quot; ( \u0026quot;recovery_token\u0026quot; ); \ncreate index \u0026quot;t_ymux_user_p2\u0026quot; on \u0026quot;t_ymux_user\u0026quot; ( \u0026quot;created\u0026quot;, \u0026quot;setup_2fa_complete\u0026quot; ); \ncreate index \u0026quot;t_ymux_user_p3\u0026quot; on \u0026quot;t_ymux_user\u0026quot; ( \u0026quot;created\u0026quot;, \u0026quot;email_confirmed\u0026quot; ); \n \n \n \n \nCREATE OR REPLACE function t_ymux_user_upd() \nRETURNS trigger AS $$ \nBEGIN  \n\tNEW.updated := current_timestamp;  \n\tRETURN NEW;  \nEND  \n$$ LANGUAGE ''plpgsql''; \n \n \nCREATE TRIGGER t_ymux_user_trig \n\tBEFORE update ON \u0026quot;t_ymux_user\u0026quot; \n\tFOR EACH ROW \n\tEXECUTE PROCEDURE t_ymux_user_upd(); \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eRun the file \u003ccode\u003ehw26_02.sql\u003c/code\u003e\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003e \n-- -------------------------------------------------------- -- -------------------------------------------------------- \n-- Note the \u0026quot;auth_token\u0026quot; is the \u0026quot;ID\u0026quot; for this row. (Primnary Key) \n-- -------------------------------------------------------- -- -------------------------------------------------------- \n \ndrop TABLE if exists \u0026quot;t_ymux_auth_token\u0026quot; cascade ; \n \nCREATE TABLE \u0026quot;t_ymux_auth_token\u0026quot; ( \n\t  \u0026quot;id\u0026quot;\t\t\t\t\tuuid DEFAULT uuid_generate_v4() not null primary key \n\t, \u0026quot;user_id\u0026quot;\t\t\t\tuuid not null \n\t, \u0026quot;updated\u0026quot; \t\t\ttimestamp \n\t, \u0026quot;created\u0026quot; \t\t\ttimestamp default current_timestamp not null \n); \n \ncreate index \u0026quot;t_ymux_auth_token_p1\u0026quot; on \u0026quot;t_ymux_auth_token\u0026quot; ( \u0026quot;user_id\u0026quot; ); \ncreate index \u0026quot;t_ymux_auth_token_p2\u0026quot; on \u0026quot;t_ymux_auth_token\u0026quot; ( \u0026quot;created\u0026quot; ); \n \n \nALTER TABLE \u0026quot;t_ymux_auth_token\u0026quot; \n\tADD CONSTRAINT \u0026quot;t_ymux_auth_token_user_id_fk1\u0026quot; \n\tFOREIGN KEY (\u0026quot;user_id\u0026quot;) \n\tREFERENCES \u0026quot;t_ymux_user\u0026quot; (\u0026quot;id\u0026quot;) \n; \n \nCREATE OR REPLACE function t_ymux_auth_token_upd() \nRETURNS trigger AS $$ \nBEGIN  \n\tNEW.updated := current_timestamp;  \n\tRETURN NEW;  \nEND  \n$$ LANGUAGE ''plpgsql''; \n \n \nCREATE TRIGGER t_ymux_auth_token_trig \n\tBEFORE update ON \u0026quot;t_ymux_auth_token\u0026quot; \n\tFOR EACH ROW \n\tEXECUTE PROCEDURE t_ymux_auth_token_upd(); \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eRun the file \u003ccode\u003ehw26_03.sql\u003c/code\u003e\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eCREATE SEQUENCE t_log_seq \n  INCREMENT 1 \n  MINVALUE 1 \n  MAXVALUE 9223372036854775807 \n  START 1 \n  CACHE 1; \n \nDROP TABLE if exists \u0026quot;t_ymux_user_log\u0026quot; cascade ; \n \nCREATE TABLE \u0026quot;t_ymux_user_log\u0026quot; ( \n\t  \u0026quot;id\u0026quot;\t\t\t\t\tuuid DEFAULT uuid_generate_v4() not null primary key \n\t, \u0026quot;user_id\u0026quot;\t\t\t\tuuid \t \n\t, \u0026quot;seq\u0026quot;\t \t\t\t\tbigint DEFAULT nextval(''t_log_seq''::regclass) NOT NULL  \n\t, \u0026quot;activity_name\u0026quot;\t\ttext \n\t, \u0026quot;updated\u0026quot; \t\t\ttimestamp \n\t, \u0026quot;created\u0026quot; \t\t\ttimestamp default current_timestamp not null \n); \n \ncreate index \u0026quot;t_ymux_user_log_p1\u0026quot; on \u0026quot;t_ymux_user_log\u0026quot; ( \u0026quot;user_id\u0026quot;, \u0026quot;seq\u0026quot; ); \ncreate index \u0026quot;t_ymux_user_log_p2\u0026quot; on \u0026quot;t_ymux_user_log\u0026quot; ( \u0026quot;user_id\u0026quot;, \u0026quot;created\u0026quot; ); \n \nALTER TABLE \u0026quot;t_ymux_user_log\u0026quot; \n\tADD CONSTRAINT \u0026quot;t_ymux_user_log_user_id_fk1\u0026quot; \n\tFOREIGN KEY (\u0026quot;user_id\u0026quot;) \n\tREFERENCES \u0026quot;t_ymux_user\u0026quot; (\u0026quot;id\u0026quot;) \n; \n \nCREATE OR REPLACE function t_ymux_user_log_upd() \nRETURNS trigger AS $$ \nBEGIN  \n\tNEW.updated := current_timestamp; \n\tRETURN NEW; \nEND \n$$ LANGUAGE ''plpgsql''; \n \n \nCREATE TRIGGER t_ymux_user_log_trig \n\tBEFORE update ON \u0026quot;t_ymux_user_log\u0026quot; \n\tFOR EACH ROW \n\tEXECUTE PROCEDURE t_ymux_user_log_upd(); \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003ch2\u003eApplications Tables\u003c/h2\u003e\n\n\u003cp\u003e\u0026ldquo;t_ymux_user\u0026rdquo; joins to ct_login on a 1 to 1 basis.  Each time a user is inserted\ntinto ct_login a set of rows is populated for all the homework that exits into\nct_homework_ans.\u003c/p\u003e\n\n\u003ch2\u003ect_login\u003c/h2\u003e\n\n\u003cp\u003eRun the file \u003ccode\u003ehw26_04.sql\u003c/code\u003e\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eDROP TABLE if exists ct_login cascade ; \n \nCREATE TABLE ct_login ( \n\t  user_id\t\t\t\t\tuuid not null primary key -- 1 to 1 to \u0026quot;t_ymux_user\u0026quot;.\u0026quot;id\u0026quot; \n\t, pg_acct\t\t\t\t\tchar varying (20) not null \n\t, class_no\t\t\t\t\ttext default ''4010-BC'' not null\t-- 4820 or 4010-BC - one of 2 classes \n\t, lang_to_use\t\t\t\ttext default ''Go'' not null\t\t-- Go or PostgreSQL \n\t, misc\t\t\t\t\t\tJSONb default ''{}'' not null\t\t-- Whatever I forgot \n); \n \ncreate unique index ct_login_u1 on ct_login ( pg_acct ); \ncreate index ct_login_p1 on ct_login using gin ( misc ); \n \nALTER TABLE ct_login \n\tADD CONSTRAINT ct_login_user_id_fk \n\tFOREIGN KEY (user_id) \n\tREFERENCES \u0026quot;t_ymux_user\u0026quot; (\u0026quot;id\u0026quot;) \n; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003ch2\u003ect_homeowrk\u003c/h2\u003e\n\n\u003cp\u003eRun the file \u003ccode\u003ehw26_05.sql\u003c/code\u003e\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eDROP TABLE if exists a03_title cascade; \n \nCREATE TABLE a03_title ( \n\t  title_id\t\t\t\tuuid DEFAULT uuid_generate_v4() not null primary key \n\t, homework_title\t\t\ttext not null \n\t); \n \nCREATE INDEX ct_homework_p1 on a03_title ( homework_no ); \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003ch2\u003ect_homeowrk_ans\u003c/h2\u003e\n\n\u003cp\u003eRun the file \u003ccode\u003ehw26_06.sql\u003c/code\u003e\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eDROP TABLE if exists ct_homework_ans cascade ; \n \nCREATE TABLE ct_homework_ans ( \n\t  homework_ans_id\t\t\tuuid DEFAULT uuid_generate_v4() not null primary key \n\t, title_id\t\t\t\tuuid not null \n\t, user_id\t\t\t\t\tuuid not null \n\t, points\t\t\t\t\tint not null default 0 \n\t, completed\t\t\t\t\tchar(1) default ''n'' not null \n\t, updated\t\t \t\t\ttimestamp \n\t, created \t\t\t\t\ttimestamp default current_timestamp not null \n); \n \n \ncreate unique index ct_homework_ans_u1 on ct_homework_ans (id, user_id ); \ncreate unique index ct_homework_ans_u2 on ct_homework_ans ( user_id, title_id ); \n \n \n-- title_id is fk to a03_title \nALTER TABLE ct_homework_ans \n\tADD CONSTRAINT title_id_fk \n\tFOREIGN KEY (title_id) \n\tREFERENCES a03_title (title_id) \n; \n \n-- user_id is fk to ct_login \nALTER TABLE ct_homework_ans \n\tADD CONSTRAINT user_id_fk \n\tFOREIGN KEY (user_id) \n\tREFERENCES ct_login (user_id) \n; \n \n \nCREATE OR REPLACE function ct_homework_ans_upd() \nRETURNS trigger AS $$ \nBEGIN \n\tNEW.updated := current_timestamp; \n\tRETURN NEW; \nEND \n$$ LANGUAGE ''plpgsql''; \n \n \nCREATE TRIGGER ct_homework_ans_trig \n\tBEFORE update ON ct_homework_ans \n\tFOR EACH ROW \n\tEXECUTE PROCEDURE ct_homework_ans_upd(); \n \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003ch2\u003eTriggers that depend on multiple tables\u003c/h2\u003e\n\n\u003cp\u003eRun the file \u003ccode\u003ehw26_07.sql\u003c/code\u003e\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eCREATE OR REPLACE function ct_homework_ins() \nRETURNS trigger AS $$ \nBEGIN \n\tinsert into ct_homework_ans ( \n\t\tuser_id, \n\t\ttitle_id \n\t) select  \n\t\tt1.user_id, \n\t\tNEW.title_id \n\tfrom ct_login as t1 \n\twhere not exists ( \n\t\t\tselect 1 as \u0026quot;found\u0026quot; \n\t\t\tfrom ct_homework_ans t2 \n\t\t\twhere t2.user_id = t1.user_id\t\t\t \n\t\t\t  and t2.title_id = NEW.title_id \n\t\t) \n\t; \n\tRETURN NEW; \nEND \n$$ LANGUAGE ''plpgsql''; \n \n \nDROP TRIGGER if exists ct_homework_trig_ins_upd on a03_title; \n \nCREATE TRIGGER ct_homework_trig_ins_upd \n\tAFTER insert or update ON a03_title \n\tFOR EACH ROW \n\tEXECUTE PROCEDURE ct_homework_ins(); \n \n \n \n \n \n \nCREATE OR REPLACE function ct_homework_del() \nRETURNS trigger AS $$ \nBEGIN \n\tupdate ct_homework_ans t3 \n\t\tset completed = ''x'' \n\t\twhere t3.title_id = NEW.title_id \n\t\t  and t3.completed = ''n'' \n\t; \n\tRETURN OLD; \nEND \n$$ LANGUAGE ''plpgsql''; \n \n \nDROP TRIGGER if exists ct_homework_trig_del on a03_title; \n \nCREATE TRIGGER ct_homework_trig_del \n\tBEFORE delete ON a03_title \n\tFOR EACH ROW \n\tEXECUTE PROCEDURE ct_homework_del(); \n \n \n \n \n \n \n \n \nCREATE OR REPLACE function ct_login_ins() \nRETURNS trigger AS $$ \nBEGIN \n\tinsert into ct_homework_ans ( \n\t\tuser_id, \n\t\ttitle_id \n\t) select  \n\t\tNEW.user_id, \n\t\tt1.title_id \n\tfrom a03_title as t1 \n\twhere not exists ( \n\t\t\tselect 1 as \u0026quot;found\u0026quot; \n\t\t\tfrom ct_homework_ans t2 \n\t\t\twhere t2.user_id = NEW.user_id\t\t\t \n\t\t\t  and t2.title_id = t1.title_id \n\t\t) \n\t; \n\tRETURN NEW; \nEND \n$$ LANGUAGE ''plpgsql''; \n \n \ndrop TRIGGER if exists ct_login_trig on ct_login; \n \nCREATE TRIGGER ct_login_trig \n\tAFTER insert ON ct_login \n\tFOR EACH ROW \n\tEXECUTE PROCEDURE ct_login_ins(); \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003ch2\u003eHomework tags\u003c/h2\u003e\n\n\u003cp\u003eRun the file \u003ccode\u003ehw26_09.sql\u003c/code\u003e and \u003ccode\u003ehw26_10.sql\u003c/code\u003e\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003e \nDROP TABLE IF EXISTS ct_tag cascade ; \n \nCREATE TABLE ct_tag (  \n\ttag_id uuid DEFAULT uuid_generate_v4() not null primary key, \n\ttag_word text not null \n); \n \nCREATE UNIQUE INDEX ct_tag_p1 on ct_tag ( tag_word ); \n \n \n \nDROP TABLE IF EXISTS a03_title_to_tag cascade ; \n \nCREATE TABLE a03_title_to_tag (  \n\ttag_id \t\tuuid not null, \n\ttitle_id uuid not null, \n\tprimary key (id, tag_id ) \n); \n \nCREATE UNIQUE INDEX a03_title_to_tag_u1 on a03_title_to_tag ( tag_id, title_id ); \n \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003ch2\u003eSetup default data\u003c/h2\u003e\n\n\u003cp\u003eRun the file \u003ccode\u003ehw26_11.sql\u003c/code\u003e to setup data for these tables.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eselect setup_data_26(); \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003ch4\u003eTags: \u0026ldquo;setup\u0026rdquo;,\u0026ldquo;a03_title\u0026rdquo;,\u0026ldquo;ct_homework_ans\u0026rdquo;,\u0026ldquo;ct_tag\u0026rdquo;,\u0026ldquo;a03_title_to_tag\u0026rdquo;,\u0026ldquo;t_ymux_user\u0026rdquo;,\u0026ldquo;t_ymux_user_log\u0026rdquo;,\u0026ldquo;t_ymux_auth_token\u0026rdquo;\u003c/h4\u003e\n","Lesson_no":26}' where title_id = '57f7a378-dba1-420d-6236-f6ce3305c61d';


insert into a03_title (id, title) values ( 'e7ef42f0-9eca-4f68-596c-5c833b62b145', 'Interactive - 27 - 1 to 0 or 1 relationship 			(fk, unique)'); --x1--
insert into a03_tag ( id, tag ) values ( '1a092e76-4056-4ad0-5138-97b7080f1a34', '1' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '1a092e76-4056-4ad0-5138-97b7080f1a34', 'e7ef42f0-9eca-4f68-596c-5c833b62b145' );
update a03_title set body = '{"Lesson":"\u003cstyle\u003e \n.pagebreak { page-break-before: always; } \n.half { height: 200px; } \n\u003c/style\u003e \n \n\n\u003ch1\u003eInteractive - 27 - 1 to 0 or 1 relationship           (fk, unique)\u003c/h1\u003e\n\n\u003cp\u003eNow that we have our tables let\u0026rsquo;s look at the relationship between\n\u003ccode\u003e\u0026quot;t_ymux_user\u0026quot;\u003c/code\u003e and \u003ccode\u003ect_login\u003c/code\u003e.   This is our 1 to 0 or 1 relationship.\u003c/p\u003e\n\n\u003cp\u003eIt is provided by the primary key on ct_login being required but not\nhaving a default value where a key is generated.   This is combined\nwith the foreign key constraint to \u003ccode\u003e\u0026quot;t_ymux_user\u0026quot;\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003eTry an insert to see if you can fake it out (the insert will fail).\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003einsert into ct_login ( user_id, pg_acct ) values ( uuid_generate_v4(), ''x'' ); \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eYou should get an error.   The error indicates that you violated a foreign key and will look similar to:\u003c/p\u003e\n\n\u003cp\u003eIf you ran it in psql or pgAmdmin your error would look like:\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eERROR:  insert or update on table \u0026quot;ct_homework_ans\u0026quot; violates foreign key constraint \u0026quot;user_id_fk\u0026quot; \nDETAIL:  Key (user_id)=(ce1d8fdd-aa04-4bb4-9ef7-72655ff63b95) is not present in table \u0026quot;ct_login\u0026quot;. \nCONTEXT:  SQL statement \u0026quot;insert into ct_homework_ans ( \n\t\tuser_id, \n\t\ttitle_id \n\t) select \n\t\tNEW.user_id, \n\t\tt1.title_id \n\tfrom a03_title as t1 \n\twhere not exists ( \n\t\t\tselect 1 as \u0026quot;found\u0026quot; \n\t\t\tfrom ct_homework_ans t2 \n\t\t\twhere t2.user_id = NEW.user_id \n\t\t\t  and t2.title_id = t1.title_id \n\t\t)\u0026quot; \nPL/pgSQL function ct_login_ins() line 3 at SQL statement \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eIn this tool you get back:\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003e{ \n    \u0026quot;Status\u0026quot;: \u0026quot;error\u0026quot;, \n    \u0026quot;MsgSet\u0026quot;: [ \n        { \n            \u0026quot;Msg\u0026quot;: \u0026quot;pq: insert or update on table \\\u0026quot;ct_homework_ans\\\u0026quot; violates foreign key constraint \\\u0026quot;user_id_fk\\\u0026quot;\u0026quot;, \n            \u0026quot;Stmt\u0026quot;: \u0026quot;insert into ct_login ( user_id, pg_acct ) values ( uuid_generate_v4(), ''x'' )\u0026quot; \n        } \n    ] \n} \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003ch4\u003eTags: 1:0,\u0026ldquo;1 to 0\u0026rdquo;,\u0026ldquo;1:0 relationship\u0026rdquo;,\u0026ldquo;1:1\u0026rdquo;\u003c/h4\u003e\n","Lesson_no":27}' where title_id = 'e7ef42f0-9eca-4f68-596c-5c833b62b145';


insert into a03_title (id, title) values ( '5a856f17-673b-4549-6f4b-31400459e409', 'Interactive - 28 - 1 to n relationship				(fk)'); --x1--
insert into a03_title_to_tag ( tag_id, title_id ) values ( '1a092e76-4056-4ad0-5138-97b7080f1a34', '5a856f17-673b-4549-6f4b-31400459e409' );
update a03_title set body = '{"Lesson":"\u003cstyle\u003e \n.pagebreak { page-break-before: always; } \n.half { height: 200px; } \n\u003c/style\u003e \n \n\n\u003ch1\u003eInteractive - 28 - 1 to n relationship                (fk)\u003c/h1\u003e\n\n\u003cp\u003eThe simple to understand relationship is a 1 to 0..n relationship.\nThis is where a parent key is a primary key and a foreign key\nis in a 2nd table.  We have this relationship between\n\u003ccode\u003e\u0026quot;t_ymux_user\u0026quot;.\u0026quot;id\u0026quot;\u003c/code\u003e and the \u003ccode\u003e\u0026quot;t_ymux_auth_token\u0026quot;\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003eThe table \u003ccode\u003e\u0026quot;t_ymux_auth_token\u0026quot;\u003c/code\u003e has \u0026ldquo;user_id\u0026rdquo; as a column in it.\nA foreign key relationship exists between the 2 tables.  This means\nthat you can have more than 1 auth token for each user.   Basically\na user can login from more than one computer at a time.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eSELECT setup_data_26(); \n \nSELECT t1.email, t2.id as \u0026quot;auth_token\u0026quot; \n\tFROM \u0026quot;t_ymux_user\u0026quot; as t1 \n\t\tjoin \u0026quot;t_ymux_auth_token\u0026quot; as t2 on ( t1.\u0026quot;id\u0026quot; = t2.\u0026quot;user_id\u0026quot; ) \n; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eYou should get back 3 rows.\u003c/p\u003e\n\n\u003ch4\u003eTags:  1:n,\u0026ldquo;1:n relationship\u0026rdquo;\u003c/h4\u003e\n","Lesson_no":28}' where title_id = '5a856f17-673b-4549-6f4b-31400459e409';


insert into a03_title (id, title) values ( '3cbcaa32-508c-4931-51c3-ce93b9327e9f', 'Interactive - 29 - m to n relationship				(fk to join table to fk)'); --x1--
insert into a03_tag ( id, tag ) values ( 'b3cf1a72-73d5-47ea-67b7-de9e3543a4d3', 'm' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( 'b3cf1a72-73d5-47ea-67b7-de9e3543a4d3', '3cbcaa32-508c-4931-51c3-ce93b9327e9f' );
update a03_title set body = '{"Lesson":"\u003cstyle\u003e \n.pagebreak { page-break-before: always; } \n.half { height: 200px; } \n\u003c/style\u003e \n \n\n\u003ch1\u003eInteractive - 29 - m to n relationship                (fk to join table to fk)\u003c/h1\u003e\n\n\u003cp\u003eOur model has a m to n (m:n) relationship in it.  This is between ct_homeowrk\nand ct_tags.\u003c/p\u003e\n\n\u003cp\u003eThis relationship requires an intermediate table.  Each side has a relationship\nto the intermediate table.\u003c/p\u003e\n\n\u003cp\u003ect_tag associates a tag_word with a tag_id  (Shown below - the table was created\nin the script in homework 26 - you don\u0026rsquo;t need to run it.)\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eCREATE TABLE ct_tag (  \n\ttag_id uuid DEFAULT uuid_generate_v4() not null primary key, \n\ttag_word text not null \n); \n \nCREATE UNIQUE INDEX ct_tag_p1 on ct_tag ( tag_word ); \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eTo get  a list of the words do a select from this table.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eSELECT tag_word from ct_tag order by tag_word; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eNote that tag_word has a unique index on it.  This prevents any duplicate tags.\u003c/p\u003e\n\n\u003cp\u003eThe join table has just IDs in it.   To make it efficient it has indexes that\ngo in both directions - this allows searching from ct_tags back to a03_title\nand from a03_title to ct_tags.    One of the unique indexes is the multi-field\nprimary key with title_id, tag_id in it..   This is listed at the bottom\nof the create table.  The second one is a unique index.\u003c/p\u003e\n\n\u003cp\u003e(shown below - do not run, just for reference)\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eCREATE TABLE a03_title_to_tag (  \n\ttag_id \t\tuuid not null, \n\ttitle_id uuid not null, \n\tprimary key (id, tag_id ) \n); \n \nCREATE UNIQUE INDEX a03_title_to_tag_u1 on a03_title_to_tag ( tag_id, title_id ); \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eThe a03_title table (show for reference) is:\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003e \nCREATE TABLE a03_title ( \n\t  title_id\t\t\t\tuuid DEFAULT uuid_generate_v4() not null primary key \n\t); \n \nCREATE INDEX ct_homework_p1 on a03_title ( homework_no ); \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eNow do a select from the join table.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eSELECT * from a03_title_to_tag order by 1, 2; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003ch2\u003eCreative Homework - Assignment 02 - program on your computer.\u003c/h2\u003e\n\n\u003cp\u003eThis Interactive assignment has the tables in it for your Assignment 02.\nThe assignments to be written in Python and generate SQL as output.\u003c/p\u003e\n\n\u003cp\u003eFor this Interactive you get to write the query that will join the\ntables together.  Some data has already been loaded to the tables.\u003c/p\u003e\n\n\u003cp\u003eConstruct a select that joins all 3 tables together.  The select should have\n\u003ccode\u003ehomework_title\u003c/code\u003e and \u003ccode\u003epoints_avail\u003c/code\u003e from the a03_title table in it.\nIt should also have the \u003ccode\u003etag_word\u003c/code\u003e  from ct_tag and it should join from\nct_homework to a03_title_to_tag to ct_tag.   The output should be an ordered\nlist of homework and all the tags that are associated with each homework.\nFor example in homework 29 you should have 3 tags, \u0026ldquo;m to n\u0026rdquo;, \u0026ldquo;m:n\u0026rdquo; and\n\u0026ldquo;m:n relationship\u0026rdquo; as the tags.    Also have the tags sorted alphabetically.\nThis means that \u0026ldquo;m to n\u0026rdquo; will be the last of the 3 tags for homework 29.\u003c/p\u003e\n\n\u003cp\u003eHints:  You need to sort by a column that you do not need to return.\nThis is the homework_no.   So you need to have a sub-select with\nthe order by on the inside select.\nThe example of a join is in homework 19 where we use a sub-select and\nthe order by on the inside select.\u003c/p\u003e\n\n\u003cp\u003eIn homework 11 we have an example of jointing to multiple tables at\nonce.\u003c/p\u003e\n\n\u003cp\u003eThe homework on inner joins is 18.\u003c/p\u003e\n\n\u003cp\u003eIt\u0026rsquo;s important that the sort order by homework_no be done as an\ninteger, not as text.  You will need to use a \u003ccode\u003e::int\u003c/code\u003e to convert\nthe text field to an integer field.\u003c/p\u003e\n\n\u003cp\u003eThe correct output data should look similar to:\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003e                                      homework_title                                      |      tag_word       \n------------------------------------------------------------------------------------------+-------------------- \n  Interactive - 01 - Create Table                                                         | create table \n  Interactive - 01 - Create Table                                                         | hw01 \n  Interactive - 01 - Create Table                                                         | type int \n  Interactive - 01 - Create Table                                                         | type text \n  Interactive - 01 - Create Table                                                         | type varchar \n  Interactive - 02 - Insert data into \u0026quot;name_list\u0026quot;                                         | hw02 \n  Interactive - 02 - Insert data into \u0026quot;name_list\u0026quot;                                         | insert \n... \n... \n... \n  Interactive - 08 - create unique id and a primary key                                   | UUID \n  Interactive - 09 - add a table with state codes                                         | add constraint \n  Interactive - 09 - add a table with state codes                                         | alter table \n  Interactive - 09 - add a table with state codes                                         | foreign key \n  Interactive - 10 - add a index on the name table                                        | create index \n  Interactive - 11 - add a index on the name table that is case insensitive.              | create index \n... \n... \n... \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003ch4\u003eTags: m:n,\u0026ldquo;m to n\u0026rdquo;,\u0026ldquo;m:n\u0026rdquo;,\u0026ldquo;m:n relationship\u0026rdquo;\u003c/h4\u003e\n","Lesson_no":29}' where title_id = '3cbcaa32-508c-4931-51c3-ce93b9327e9f';


insert into a03_title (id, title) values ( 'dc4ab510-f385-4870-7c60-ba2e5befde88', 'Interactive - 30 - 1 to ordered list relationship		(fk to uk with sequence)'); --x1--
insert into a03_tag ( id, tag ) values ( 'ce50542d-a933-45b6-6bcd-8f1b5e2cd169', '1 to list' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( 'ce50542d-a933-45b6-6bcd-8f1b5e2cd169', 'dc4ab510-f385-4870-7c60-ba2e5befde88' );
insert into a03_tag ( id, tag ) values ( 'bd5865ea-7fb6-41be-6c59-e65c341a606e', 'list of rows' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( 'bd5865ea-7fb6-41be-6c59-e65c341a606e', 'dc4ab510-f385-4870-7c60-ba2e5befde88' );
update a03_title set body = '{"Lesson":"\u003cstyle\u003e \n.pagebreak { page-break-before: always; } \n.half { height: 200px; } \n\u003c/style\u003e \n \n\n\u003ch1\u003eInteractive - 30 - 1 to ordered list relationship     (fk to uk with sequence)\u003c/h1\u003e\n\n\u003cp\u003eThe model has a 1 to a list of rows.  This is a more unusual relationship\nbecause the list can be ordered by time.  Usually relationships in a SQL\ndatabase are not inherently ordered.  In  this case we use a sequence\u003cbr /\u003e\ngenerated number to make the set of rows in a specific order.\u003c/p\u003e\n\n\u003cp\u003eTaken from hw26_3.sql that you have already run.\nYou don\u0026rsquo;t have to run it again.\nThe first step is to create a sequence.   This one is \u003ccode\u003et_log_seq\u003c/code\u003e.\nEach time a value is used from the sequenced it increments.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eCREATE SEQUENCE t_log_seq \n  INCREMENT 1 \n  MINVALUE 1 \n  MAXVALUE 9223372036854775807 \n  START 1 \n  CACHE 1; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eFor the field \u0026ldquo;seq\u0026rsquo; in the table we use the sequence.  This is\nthe \u003ccode\u003enextval(''t_log_seq''::regclass)\u003c/code\u003e default value.  When we insert\nwe allow the default value to fill \u003ccode\u003eseq\u003c/code\u003e.   Our join is a 1:n join\nbased on user_id to the user.  Each time a security event happens\nwe insert the type of event to this table.   In a complete\nsecurity system this kind of a \u0026ldquo;log\u0026rdquo; has a trigger on it and\nfor certain events it would generate an email to the user.  An\nexample is the creation of a device/application account or the\nchange of the account password.   Some events would just be logged\nfor later statistical usage - like a login or logout event.\u003c/p\u003e\n\n\u003cp\u003eAlso taken from hw26_3.sql that you have already run.\nYou don\u0026rsquo;t have to run it again.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eCREATE TABLE \u0026quot;t_ymux_user_log\u0026quot; ( \n\t  \u0026quot;id\u0026quot;\t\t\t\t\tuuid DEFAULT uuid_generate_v4() not null primary key \n\t, \u0026quot;user_id\u0026quot;\t\t\t\tuuid \t-- if null then a failed event \n\t, \u0026quot;seq\u0026quot;\t \t\t\t\tbigint DEFAULT nextval(''t_log_seq''::regclass) NOT NULL  \n\t, \u0026quot;activity_name\u0026quot;\t\ttext \n\t, \u0026quot;updated\u0026quot; \t\t\ttimestamp \n\t, \u0026quot;created\u0026quot; \t\t\ttimestamp default current_timestamp not null \n); \n \ncreate index \u0026quot;t_ymux_user_log_p1\u0026quot; on \u0026quot;t_ymux_user_log\u0026quot; ( \u0026quot;user_id\u0026quot;, \u0026quot;seq\u0026quot; ); \ncreate index \u0026quot;t_ymux_user_log_p2\u0026quot; on \u0026quot;t_ymux_user_log\u0026quot; ( \u0026quot;user_id\u0026quot;, \u0026quot;created\u0026quot; ); \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eRun a simple select on t_ymux_user_log.  You should have at least 2 rows in\nit.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eselect * from t_ymux_user_log; \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003ch2\u003eAssignment 03 - Create 2 tables.\u003c/h2\u003e\n\n\u003cp\u003e50 points.\u003c/p\u003e\n\n\u003cp\u003eCreate a table a \u0026ldquo;issue\u0026rdquo; table that has a text body column called \u0026ldquo;body\u0026rdquo;.\nThe table needs to have a UUID primary key that is automatically generated.\nThen create a child table, \u0026ldquo;issue_note\u0026rdquo; that has a list of comments with dates associated\nwith the \u0026ldquo;issue\u0026rdquo; table.   This list of comments needs to be ordered using\na \u0026ldquo;seq\u0026rdquo; column.   Create a sequence to support this column.  Call the sequence \u0026ldquo;t_issue_note_seq\u0026rdquo;.\nBoth tables need to have created/updated columns that are date stamps.\u003c/p\u003e\n\n\u003cp\u003eTurn in the source code for creating the tables with some inserts that put\u003cbr /\u003e\ndata into the tables and a select that verifies an issue and a set of\nissue notes.\u003c/p\u003e\n\n\u003cp\u003eDon\u0026rsquo;t loose your source code for these tables.\nWe will use these tables in the assignment on key word search later in the class.\u003c/p\u003e\n\n\u003ch4\u003eTags: \u0026ldquo;1 to list\u0026rdquo;,\u0026ldquo;list of rows\u0026rdquo;\u003c/h4\u003e\n","Lesson_no":30}' where title_id = 'dc4ab510-f385-4870-7c60-ba2e5befde88';


insert into a03_title (id, title) values ( '1a09f45d-3507-4b03-5060-b4d12b12ef84', 'Interactive - 31 - only one row of data				(uk with no sequence)'); --x1--
insert into a03_tag ( id, tag ) values ( 'b0d5ce48-5630-4c84-78db-8fb6b820640a', 'single row' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( 'b0d5ce48-5630-4c84-78db-8fb6b820640a', '1a09f45d-3507-4b03-5060-b4d12b12ef84' );
insert into a03_tag ( id, tag ) values ( 'f2ab4d16-42b0-4318-6252-037858384f50', 'raise exception' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( 'f2ab4d16-42b0-4318-6252-037858384f50', '1a09f45d-3507-4b03-5060-b4d12b12ef84' );
insert into a03_tag ( id, tag ) values ( '7d8da6b8-3c93-4616-44e4-af38f0ebb4ba', 'trigger' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '7d8da6b8-3c93-4616-44e4-af38f0ebb4ba', '1a09f45d-3507-4b03-5060-b4d12b12ef84' );
insert into a03_tag ( id, tag ) values ( 'e3f4af85-9049-4dd0-5629-b74bb386987d', 'delete trigger' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( 'e3f4af85-9049-4dd0-5629-b74bb386987d', '1a09f45d-3507-4b03-5060-b4d12b12ef84' );
update a03_title set body = '{"Lesson":"\u003cstyle\u003e \n.pagebreak { page-break-before: always; } \n.half { height: 200px; } \n\u003c/style\u003e \n \n\n\u003ch1\u003eInteractive - 31 - only one row of data               (uk with no sequence)\u003c/h1\u003e\n\n\u003cp\u003eWith system configuration tables it is often useful to only have 1 row of data.\nEach configuration item is a distinct column in the table.\u003c/p\u003e\n\n\u003cp\u003eThis can be done with a primary key and a constraint.     The constraint limits the values\non the primary key and results in an error if a attempt to insert a 2nd row occurs.\u003c/p\u003e\n\n\u003cp\u003eIn this example we just have \u003ccode\u003eapplicaiton_name\u003c/code\u003e as the single configuration item.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eDROP TABLE if exists ct_config ; \n \nCREATE TABLE ct_config ( \n\tconfig_id serial primary key check ( config_id = 1 ), \n\tapplication_name text \n); \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eThe first insert will work.  Then 2nd will not.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eINSERT INTO ct_config ( application_name ) values ( ''4820 class'' ); \n \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eand 2nd insert\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003einsert into ct_config ( application_name ) values ( ''4010 blockchain class'' ); \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eon the 2nd insert you should get an error similar to:\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003epsql:hw31_3.sql:3: ERROR:  new row for relation \u0026quot;ct_config\u0026quot; violates check constraint \u0026quot;ct_config_config_id_check\u0026quot; \nDETAIL:  Failing row contains (2, 4010 blockchain class). \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eWe can prevent delete of the row with a trigger.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eCREATE OR REPLACE FUNCTION ct_config_prevent_delete()  \nRETURNS trigger AS $$ \nBEGIN             \n\tIF OLD.config_id = 1 THEN \n\t\tRAISE EXCEPTION ''cannot delete configuration row''; \n\tEND IF; \nEND; \n$$  \nLANGUAGE plpgsql; \n \nCREATE TRIGGER ct_config_prevent_delete  \n\tBEFORE DELETE ON ct_config \n\tFOR EACH ROW EXECUTE PROCEDURE ct_config_prevent_delete(); \n \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eWhen you try to delete:\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003edelete from ct_config; \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eYou should get an error similar to:\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eERROR:  cannot delete configuration row \nCONTEXT:  PL/pgSQL function ct_config_prevent_delete() line 4 at RAISE \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003ch4\u003eTags: \u0026ldquo;single row\u0026rdquo;,\u0026ldquo;raise exception\u0026rdquo;,\u0026ldquo;trigger\u0026rdquo;,\u0026ldquo;delete trigger\u0026rdquo;\u003c/h4\u003e\n","Lesson_no":31}' where title_id = '1a09f45d-3507-4b03-5060-b4d12b12ef84';


insert into a03_title (id, title) values ( '1d769608-2fbc-471c-4b18-7e0259c9cd08', 'Interactive - 32 - only one a fixed set of rows.		(pre-populate with key, pk, check-constraint on key)'); --x1--
insert into a03_tag ( id, tag ) values ( '871d5431-4845-4717-4728-e9843fc8aa58', 'fixed set rows' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '871d5431-4845-4717-4728-e9843fc8aa58', '1d769608-2fbc-471c-4b18-7e0259c9cd08' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '7d8da6b8-3c93-4616-44e4-af38f0ebb4ba', '1d769608-2fbc-471c-4b18-7e0259c9cd08' );
insert into a03_tag ( id, tag ) values ( 'd650bb33-2efc-4638-5485-5b420508c65f', 'check constraint' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( 'd650bb33-2efc-4638-5485-5b420508c65f', '1d769608-2fbc-471c-4b18-7e0259c9cd08' );
update a03_title set body = '{"Lesson":"\u003cstyle\u003e \n.pagebreak { page-break-before: always; } \n.half { height: 200px; } \n\u003c/style\u003e \n \n\n\u003ch1\u003eInteractive - 32 - only one a fixed set of rows.      (pre-populate with key, pk, check-constraint on key)\u003c/h1\u003e\n\n\u003cp\u003eThere is a different way to implement a set of configuration items.  In this case the items\nare stored one in each row in a set of fixed rows.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eDROP  TABLE if exists ct_config_row ; \n \nCREATE TABLE ct_config_row ( \n\t  id\t\t\t\tserial not null primary key \n\t, name \t\t\t\ttext not null check ( name in ( \n\t\t\t\t\t\t\t''security_method'', \n\t\t\t\t\t\t\t''encryption'' \n\t\t\t\t\t\t) ) \n\t, ty \t\t\t\ttext not null default ''str'' \n\t, value \t\t\ttext  \n\t, i_value \t\t\tbigint \n\t, b_value \t\t\tboolean \n); \n \nCREATE UNIQUE INDEX ct_config_row_p1 on ct_config_row ( name ); \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eWith a table like this we can insert some values:\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eINSERT INTO ct_config_row ( name, value ) values\t \n\t( ''security_method'', ''jwt'' ), \n\t( ''encryption'', ''es'' ) \n; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eThe fixed set of configuration items is checked with the check constraint\nand the unique key on name.\u003c/p\u003e\n\n\u003cp\u003eA trigger can be used to prevent deletion of items.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eCREATE OR REPLACE FUNCTION ct_config_row_prevent_delete()  \nRETURNS trigger AS $$ \nBEGIN             \n\tIF OLD.config_id = 1 THEN \n\t\tRAISE EXCEPTION ''cannot delete configuration row''; \n\tEND IF; \nEND; \n$$  \nLANGUAGE plpgsql; \n \nCREATE TRIGGER ct_config_row_prevent_delete  \n\tBEFORE DELETE ON ct_config_row \n\tFOR EACH ROW EXECUTE PROCEDURE ct_config_row_prevent_delete(); \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003ch4\u003eTags: \u0026ldquo;fixed set rows\u0026rdquo;,\u0026ldquo;trigger\u0026rdquo;,\u0026ldquo;check constraint\u0026rdquo;\u003c/h4\u003e\n","Lesson_no":32}' where title_id = '1d769608-2fbc-471c-4b18-7e0259c9cd08';


insert into a03_title (id, title) values ( '48fe241f-8cbb-4381-6e3f-70cfefb45b1c', 'Interactive - 33 - types of indexes (hash, gin)'); --x1--
insert into a03_title_to_tag ( tag_id, title_id ) values ( '8482824c-e02f-4706-677f-e31120031147', '48fe241f-8cbb-4381-6e3f-70cfefb45b1c' );
insert into a03_tag ( id, tag ) values ( '90e16a30-3f99-4467-41ce-f0343dd42186', 'gin index' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '90e16a30-3f99-4467-41ce-f0343dd42186', '48fe241f-8cbb-4381-6e3f-70cfefb45b1c' );
insert into a03_tag ( id, tag ) values ( 'ce92f28a-ea60-47e0-4a0d-b2bca4d75c9e', 'hash index' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( 'ce92f28a-ea60-47e0-4a0d-b2bca4d75c9e', '48fe241f-8cbb-4381-6e3f-70cfefb45b1c' );
update a03_title set body = '{"Lesson":"\u003cstyle\u003e \n.pagebreak { page-break-before: always; } \n.half { height: 200px; } \n\u003c/style\u003e \n \n\n\u003ch1\u003eInteractive - 33 - types of indexes (hash, gin)\u003c/h1\u003e\n\n\u003cp\u003eThe default type of index in most SQL databases is a B-Tree.  This is a wide tree\nthat can produce sorted data based on the data type and ordering of that data.\u003c/p\u003e\n\n\u003cp\u003eThis is not the only kind of index.\u003c/p\u003e\n\n\u003cp\u003eIn some cases ordering of data is meaningless.  For example UUIDs do not have\nany order.  We will still need to have an index to look up a value but\nsorting on UUID rarely makes any sense.  A faster index for data that has\nno order is a \u0026ldquo;hash\u0026rdquo; index.\u003c/p\u003e\n\n\u003cp\u003eAn example of a hash index is:\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eCREATE INDEX ct_config_row_p2 on ct_config_row USING hash ( value ); \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eHash indexes in PostreSQL do not support unique index constraints.  In versions\nbefore 13 of PosgreSQL there are other limitations on how indexes are replicated\nand restored from a backup.\u003c/p\u003e\n\n\u003cp\u003eAnother type of index is a Generalized Inverse Index or GIN index. This is often\nused in conjunction with JSONb data types.\u003c/p\u003e\n\n\u003cp\u003eIn interactive homework 26 part 5 we created a column lesson_body with a data\ntype of JSONb.  We can create a GIN index on this that will allow for fast\u003cbr /\u003e\nsearches of the JSON data.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eCREATE INDEX ct_homework_p2 on a03_title USING gin ( lesson_body ); \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003ch4\u003eTags: \u0026ldquo;index\u0026rdquo;,\u0026ldquo;gin index\u0026rdquo;,\u0026ldquo;hash index\u0026rdquo;\u003c/h4\u003e\n","Lesson_no":33}' where title_id = '48fe241f-8cbb-4381-6e3f-70cfefb45b1c';


insert into a03_title (id, title) values ( 'e9c42bd8-ae41-4338-4f38-3698094b4630', 'Interactive - 34 - explain'); --x1--
insert into ct_file_list ( file_list_id) values ( 'd2387de4-fd68-471b-536a-3427665416bf', 34, 'hw34_5.sql' );
insert into ct_file_list ( file_list_id) values ( '9565d0f6-aa42-46fe-7a1d-7dc7a5e50a99', 34, 'hw34_3.sql' );
update a03_title set body = '{"Lesson":"\u003cstyle\u003e \n.pagebreak { page-break-before: always; } \n.half { height: 200px; } \n\u003c/style\u003e \n \n\n\u003ch1\u003eInteractive - 34 - explain\u003c/h1\u003e\n\n\u003cp\u003eFirst you have to understand that different queries will work and perform in different\u003cbr /\u003e\nways.  The biggest thing is the query hitting an index.  That is not the only thing.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eselect \n          t1.title_id \n        , t1.homework_no \n        , case \n            when t3.pts = 0 then ''n'' \n            when t3.pts is null then ''n'' \n            else ''y'' \n          end as \u0026quot;has_been_seen\u0026quot; \n        , t1.homework_no::int as i_homework_no \n        , coalesce(t3.tries,NULL,0,t3.tries) as tries \n    from a03_title as t1 \n        left outer join ct_homework_seen as t2 on ( t1.title_id = t2.title_id ) \n        left outer join ct_homework_grade as t3 on ( t1.title_id = t3.title_id ) \n    where exists ( \n            select 1 as \u0026quot;found\u0026quot; \n            from ct_login as t3 \n            where t3.user_id = ''7a955820-050a-405c-7e30-310da8152b6d'' \n        ) \n     and ( t3.user_id = ''7a955820-050a-405c-7e30-310da8152b6d'' \n        or t3.user_id is null ) \n    order by 12 asc \n; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003ev.s.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eselect \n          t1.title_id \n        , t1.homework_no \n        , case \n            when t3.pts = 0 then ''n'' \n            when t3.pts is null then ''n'' \n            else ''y'' \n          end as \u0026quot;has_been_seen\u0026quot; \n        , t1.homework_no::int as i_homework_no \n        , coalesce(t3.tries,NULL,0,t3.tries) as tries \n    from a03_title as t1 \n        left outer join ct_homework_seen as t2 on ( t1.title_id = t2.title_id ) \n        left outer join ct_homework_grade as t3 on ( t1.title_id = t3.title_id  \n            and t3.user_id = ''7a955820-050a-405c-7e30-310da8152b6d'' ) \n    where exists ( \n            select 1 as \u0026quot;found\u0026quot; \n            from ct_login as t3 \n            where t3.user_id = ''7a955820-050a-405c-7e30-310da8152b6d'' \n        ) \n     order by 4 asc \n; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eboth produce the same results.  The first one will construct the set of data from the\njoin and then filter it for the user.  An index will not be used because of the \u003ccode\u003eor\u003c/code\u003e and\u003cbr /\u003e\nthe \u003ccode\u003enull\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003eThe 2nd one pre-filters the table \u003ccode\u003ect_homework_graded\u003c/code\u003e for just the single user.  Since this is\nan equal condition an index will be used and this smaller set of data then is then\nused in the join.\u003c/p\u003e\n\n\u003cp\u003eFirst setup the tables and data for this  by running \u003ccode\u003ehw34_5.sql\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003eA better implementation of the 2nd form is (run file \u003ccode\u003ehw34_3.sql\u003c/code\u003e):\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eexplain analyze with per_user_ct_homework_grade as ( \n\t\tselect *  \n\t\tfrom ct_homework_grade as t4 \n\t\twhere t4.user_id =''7a955820-050a-405c-7e30-310da8152b6d''  \n\t) \nselect \n          t1.title_id \n        , t1.homework_no \n        , case \n            when t3.pts = 0 then ''n'' \n            when t3.pts is null then ''n'' \n            else ''y'' \n          end as \u0026quot;has_been_seen\u0026quot; \n        , t1.homework_no::int as i_homework_no \n        , coalesce(t3.tries,NULL,0,t3.tries) as tries \n    from a03_title as t1 \n        left outer join ct_homework_seen as t2 on ( t1.title_id = t2.title_id ) \n        left outer join per_user_ct_homework_grade as t3 on ( t1.title_id = t3.title_id ) \n     order by 4 asc \n; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eThis removes the now unnecessary query to check that it is a valid user id (on ct_login)\nand uses a \u003ccode\u003ewith\u003c/code\u003e to set up the per-user set of data.\u003c/p\u003e\n\n\u003cp\u003eThe question is now how to figure out what the query planner is doing and what queries\nneed to be optimized.\u003c/p\u003e\n","Lesson_no":34}' where title_id = 'e9c42bd8-ae41-4338-4f38-3698094b4630';


insert into a03_title (id, title) values ( '5306c920-e06f-46b4-6d1b-a181d89e8fa8', 'Interactive - 35 - views'); --x1--
insert into a03_tag ( id, tag ) values ( '4387989c-56ac-43cb-4e3d-038d4bf49e9a', 'view' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '4387989c-56ac-43cb-4e3d-038d4bf49e9a', '5306c920-e06f-46b4-6d1b-a181d89e8fa8' );
insert into a03_tag ( id, tag ) values ( '5892a330-1cca-4f55-6d34-616157ca6e52', 'unused index' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '5892a330-1cca-4f55-6d34-616157ca6e52', '5306c920-e06f-46b4-6d1b-a181d89e8fa8' );
insert into ct_file_list ( file_list_id) values ( 'eeeacc56-03b6-4794-5561-4b706609a756', 35, 'hw35_1.sql' );
insert into ct_file_list ( file_list_id) values ( '77a7d05d-9908-4450-70ff-290d42d51ad3', 35, 'hw35_2.sql' );
update a03_title set body = '{"Lesson":"\u003cstyle\u003e \n.pagebreak { page-break-before: always; } \n.half { height: 200px; } \n\u003c/style\u003e \n \n\n\u003ch1\u003eInteractive - 35 - views\u003c/h1\u003e\n\n\u003cp\u003eThe database can create a pre-defined select called a view.\nA view is a query that you set up that looks like a table when selected from but\ncan be a join or other set of operations.  It is kind of like a query-macro.\u003c/p\u003e\n\n\u003cp\u003eFor example we can create a view that let\u0026rsquo;s us list the unused indexes.\u003c/p\u003e\n\n\u003cp\u003eThis is the file hw35_1.sql.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eCREATE OR REPLACE VIEW unused_index as \nSELECT \n    idstat.relname AS TABLE_NAME, \n    indexrelname AS INDEX_NAME, \n    idstat.idx_scan AS index_scans_count, \n    pg_size_pretty(pg_relation_size(indexrelid)) AS index_size, \n    tabstat.idx_scan AS table_reads_index_count, \n    tabstat.seq_scan AS table_reads_seq_count, \n    tabstat.seq_scan + tabstat.idx_scan AS table_reads_count, \n    n_tup_upd + n_tup_ins + n_tup_del AS table_writes_count, \n    pg_size_pretty(pg_relation_size(idstat.relid)) AS table_size \nFROM pg_stat_user_indexes AS idstat \n\tJOIN pg_indexes ON indexrelname = indexname \n\t\t\tAND idstat.schemaname = pg_indexes.schemaname \n\tJOIN pg_stat_user_tables AS tabstat ON idstat.relid = tabstat.relid \nWHERE indexdef !~* ''unique'' \nORDER BY \n    idstat.idx_scan DESC, \n    pg_relation_size(indexrelid) DESC \n; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eThen when we want the list of unused indexes we just select from the view.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eSELECT * from unused_index; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003ch4\u003eTags: view,\u0026ldquo;unused index\u0026rdquo;\u003c/h4\u003e\n","Lesson_no":35}' where title_id = '5306c920-e06f-46b4-6d1b-a181d89e8fa8';


insert into a03_title (id, title) values ( '2e7565b0-84c1-4bab-5f28-088507efd2ac', 'Interactive - 36 - stored procedures'); --x1--
insert into a03_tag ( id, tag ) values ( 'e1f4cf46-e263-49c0-6ae7-82261014475f', 'function' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( 'e1f4cf46-e263-49c0-6ae7-82261014475f', '2e7565b0-84c1-4bab-5f28-088507efd2ac' );
insert into a03_tag ( id, tag ) values ( '37ec65b3-d332-49e2-7471-9cfd558e63c9', 'stored procedure' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '37ec65b3-d332-49e2-7471-9cfd558e63c9', '2e7565b0-84c1-4bab-5f28-088507efd2ac' );
insert into a03_tag ( id, tag ) values ( 'a7367004-a12a-43a5-6ad3-d1fd1fac0595', 'transaction' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( 'a7367004-a12a-43a5-6ad3-d1fd1fac0595', '2e7565b0-84c1-4bab-5f28-088507efd2ac' );
update a03_title set body = '{"Lesson":"\u003cstyle\u003e \n.pagebreak { page-break-before: always; } \n.half { height: 200px; } \n\u003c/style\u003e \n \n\n\u003ch1\u003eInteractive - 36 - stored procedures\u003c/h1\u003e\n\n\u003cp\u003eWe have been using store procedures for a number of examples so far.    Triggers in\nPostgreSQL call stored procedures.   In PostgreSQL all stored procedures are called \u0026ldquo;functions\u0026rdquo;.\u003c/p\u003e\n\n\u003cp\u003ePostgreSQL allows for stored procedures in multiple languages.   The default language is PL/pgSQL\nand this us defined using the \u003ccode\u003eLANGUAGE\u003c/code\u003e specifier.  I usually put this at the end but it can\nbe done at the top also.\u003c/p\u003e\n\n\u003cp\u003eThe section from $$ to $$ is the body that is saved and run when the function is called.\u003c/p\u003e\n\n\u003cp\u003eThere are a slew of options on how a function is run.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eCREATE or REPLACE FUNCTION function_name ( parameter_list varchar ) \nRETURNS varchar  \nAS $$ \nDECLARE \n\tdata text; \nBEGIN \n \n\t-- do something \n \n\tRETURN data; \nEND; \n$$ LANGUAGE plpgsql; \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eThe easy way to call a function is with a \u0026ldquo;select\u0026rdquo;.\nFor example:\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eselect function_name ( ''a'' ); \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eStored procedures have some advantages.  The code is run inside or near to the database.  This makes\nthe cost of moving data back and forth very low.    Stored procedures are a well developed and optimized\ntechnology and tend to be fast.\u003c/p\u003e\n\n\u003cp\u003eWith PL/pgSQL as the language the data types exactly match with the database and the handling of values\nlike NULL is clear and easy.\u003c/p\u003e\n\n\u003cp\u003eWe can check to see if a select fails to return data and for nulls in a fashion that is built into the\nlanguage.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eCREATE or REPLACE FUNCTION function_name ( parameter_list varchar ) \nRETURNS varchar  \nAS $$ \nDECLARE \n\tdata text; \nBEGIN \n \n\tSELECT ''PASS'' \n\t\tINTO data \n\t\tFROM ct_config  \n\t\tWHERE config_id = 1; \n\tIF not found THEN \n\t\tdata = ''FAIL''; \n\tEND IF; \n \n\tRETURN data; \nEND; \n$$ LANGUAGE plpgsql; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eIn PostgreSQL a stored procedure creates a transaction at the \u0026ldquo;BEGIN\u0026rdquo; and ends it at the\n\u0026ldquo;END\u0026rdquo;.  This means that if you \u0026ldquo;RAISE\u0026rdquo; an error in the middle it will result in rolling back\nthe entire transaction.\u003c/p\u003e\n\n\u003cp\u003eStored procedures can return rows of data.  Note the fact that the loop returns a single\nrow and then restart\u0026rsquo;s for each additional row.\u003c/p\u003e\n\n\u003cp\u003eFor example:\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003e-- using table from hw13_4.sql us_state \n \nCREATE OR REPLACE FUNCTION getStateFipsCode()  \nRETURNS SETOF us_state  \nAS $$ \nDECLARE \n    r us_state%rowtype; \nBEGIN \n    FOR r IN \t \n\t\tSELECT * FROM us_state \n\t\tWHERE gdp_growth \u0026gt; 1.0 \n    LOOP \n \n        -- can do some processing here \n \n        RETURN NEXT r; -- return current row of SELECT \n    END LOOP; \n    RETURN; \nEND \n$$ \nLANGUAGE ''plpgsql'' ; \n \nSELECT *  \n\tFROM getStateFipsCode() \n; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003ch4\u003eTags: \u0026ldquo;function\u0026rdquo;,\u0026ldquo;stored procedure\u0026rdquo;,\u0026ldquo;transaction\u0026rdquo;\u003c/h4\u003e\n","Lesson_no":36}' where title_id = '2e7565b0-84c1-4bab-5f28-088507efd2ac';


insert into a03_title (id, title) values ( '32d3525e-51cd-4c8f-499a-a62a40118435', 'Interactive - 37 - encrypted/hashed passwords storage'); --x1--
insert into a03_tag ( id, tag ) values ( 'c727645a-50b8-4a2a-7685-e9245a60fe45', 'password' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( 'c727645a-50b8-4a2a-7685-e9245a60fe45', '32d3525e-51cd-4c8f-499a-a62a40118435' );
insert into a03_tag ( id, tag ) values ( '5f56705e-6418-49e0-57be-08556f995c8f', 'hash password' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '5f56705e-6418-49e0-57be-08556f995c8f', '32d3525e-51cd-4c8f-499a-a62a40118435' );
insert into a03_tag ( id, tag ) values ( '24a21510-467b-4ac6-624d-31e8fd8a72a9', 'encrypted' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '24a21510-467b-4ac6-624d-31e8fd8a72a9', '32d3525e-51cd-4c8f-499a-a62a40118435' );
update a03_title set body = '{"Lesson":"\u003cstyle\u003e \n.pagebreak { page-break-before: always; } \n.half { height: 200px; } \n\u003c/style\u003e \n \n\n\u003ch1\u003eInteractive - 37 - encrypted/hashed passwords storage\u003c/h1\u003e\n\n\u003cp\u003eIt is a good idea to store passwords in a way that if the entire database is lost\nyou do not loos anybody\u0026rsquo;s password.  You need to hash them or encrypt them\nin the table.\u003c/p\u003e\n\n\u003cp\u003eThere are hash functions that are designed for this.  Of of these is\u003cbr /\u003e\nthe blowfish algorithm.  It is denoted to in the encryption parameters as \u0026lsquo;bf\u0026rsquo;.\u003c/p\u003e\n\n\u003cp\u003eFirst, we need to enable pgcrypto:\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eCREATE EXTENSION if not exists pgcrypto; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eThen, we can create a table for storing user credentials:\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003e \nDROP TABLE IF EXISTS example_users ; \n \nCREATE TABLE example_users ( \n\tid SERIAL PRIMARY KEY, \n\temail TEXT NOT NULL UNIQUE, \n\tpassword TEXT NOT NULL \n); \n \n \nCREATE OR REPLACE function example_users_insert() \nRETURNS trigger AS $$ \nDECLARE  \n\tl_salt text; \n\tl_pw text; \nBEGIN \n\tselect gen_salt(''bf'') \n\t\tinto l_salt; \n\tl_pw = NEW.password; \n\tNEW.password = crypt(l_pw, l_salt); \n\tRETURN NEW; \nEND \n$$ LANGUAGE ''plpgsql''; \n \n \nCREATE TRIGGER example_users_insert_trig \nBEFORE insert or update ON example_users \nFOR EACH ROW \nEXECUTE PROCEDURE example_users_insert(); \n \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eWhen we insert into the table we can then save the hash of the password instead of the\npassword itself.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eINSERT INTO example_users (email, password) VALUES  \n\t( ''pschlump@uwyo.edu'', ''my-very-bad-password'') \n; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eWhen we want to validate that a password that has been passed in is correct\nwe compare to the hashed value with:\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eSELECT id  \n\tFROM example_users as t1 \n\tWHERE t1.email = ''pschlump@uwyo.edu'' \n\t  AND t1.password = crypt(''my-very-bad-password'', t1.password) \n; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eThis would be a good candidate to encapsulate into a stored procedure.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eCREATE or REPLACE FUNCTION login_correct ( un varchar, pw varchar ) \nRETURNS varchar  \nAS $$ \nDECLARE \n\tdata text; \nBEGIN \n \n\tBEGIN \n\t\tSELECT ''VALID-USER'' \n\t\t\tINTO data \n\t\t\tFROM example_users as t1 \n\t\t\tWHERE t1.email = un \n\t\t\t  AND t1.password = crypt(pw, t1.password) \n\t\t\t; \n\t\tIF not found THEN \n\t\t\tdata = ''Incorrect username or password.''; \n\t\tEND IF; \n\tEXCEPTION\t \n\t\tWHEN no_data_found THEN \n\t\t\tdata = ''Incorrect username or password.''; \n\t\tWHEN too_many_rows THEN \n\t\t\tdata = ''Incorrect username or password.''; \n\t\tWHEN others THEN \n\t\t\tdata = ''Incorrect username or password.''; \n\tEND; \n \n\tRETURN data; \nEND; \n$$ LANGUAGE plpgsql; \n \nselect login_correct ( ''pschlump@uwyo.edu'', ''my-very-bad-password'' ); \n \nselect login_correct ( ''pschlump@uwyo.edu'', ''my-VERY-bad-password'' ); \n \n \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003ch4\u003eTags: \u0026ldquo;password\u0026rdquo;,\u0026ldquo;hash password\u0026rdquo;,\u0026ldquo;encrypted\u0026rdquo;\u003c/h4\u003e\n","Lesson_no":37}' where title_id = '32d3525e-51cd-4c8f-499a-a62a40118435';


insert into a03_title (id, title) values ( '8b2af9ee-6891-4528-447c-9929b89bd1c7', 'Interactive - 38 - key word lookup'); --x1--
insert into a03_tag ( id, tag ) values ( '42d7abad-8910-4811-5af0-b0d8dbffc518', 'reverse key index' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '42d7abad-8910-4811-5af0-b0d8dbffc518', '8b2af9ee-6891-4528-447c-9929b89bd1c7' );
insert into a03_tag ( id, tag ) values ( '211234b3-7d0f-4ce1-4a20-424a7057ea72', 'like' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '211234b3-7d0f-4ce1-4a20-424a7057ea72', '8b2af9ee-6891-4528-447c-9929b89bd1c7' );
insert into a03_tag ( id, tag ) values ( '4568f926-260a-46a1-786d-871281e5766a', 'keyword' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '4568f926-260a-46a1-786d-871281e5766a', '8b2af9ee-6891-4528-447c-9929b89bd1c7' );
insert into ct_file_list ( file_list_id) values ( '2e994012-21ff-462a-4638-9bc5fac9c94f', 38, 'hw38_07.sql' );
insert into ct_file_list ( file_list_id) values ( '85993f42-5f38-44b0-6dce-e0b7c1fd1c72', 38, 'hw38_10.sql' );
insert into ct_file_list ( file_list_id) values ( '8e7dfc06-3372-4a7f-4912-e78668fc7112', 38, 'hw38_11.sql' );
insert into ct_file_list ( file_list_id) values ( '33c3c7ea-501f-46c9-46c9-41314e89bb3e', 38, 'hw38_12.sql' );
update a03_title set body = '{"Lesson":"\u003cstyle\u003e \n.pagebreak { page-break-before: always; } \n.half { height: 200px; } \n\u003c/style\u003e \n \n\n\u003ch1\u003eInteractive - 38 - key word lookup\u003c/h1\u003e\n\n\u003cp\u003e(Note this set of information is the basis for Assignment 03 on keywords)\u003c/p\u003e\n\n\u003cp\u003ePostgreSQL includes an extensive set of tools for key word lookup.   The word lookup is efficient and takes account of items like language and root words.\u003c/p\u003e\n\n\u003cp\u003eWith regular SQL you have a pattern matching operator, \u003ccode\u003eLIKE\u003c/code\u003e.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eSELECT real_name  \n\tFROM name_list  \n\tWHERE real_name  LIKE ''%ilip%'' \n;  \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eThe \u003ccode\u003e%\u003c/code\u003e is wild card.  Because of the use of a wild car this kind of a query will usually result in a full table scan.  In some cases it is possible to use\na GIST index on the field and that will make the search faster.\u003c/p\u003e\n\n\u003cp\u003ePostgreSQL has an extended set of patterns that allows matching a wider set of values.  This is with the \u003ccode\u003eSIMILAR TO\u003c/code\u003e operator.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eSELECT real_name  \n\tFROM name_list  \n\tWHERE real_name SIMILAR TO ''(p|P)hilip%'' \n;  \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003ePostgreSQL also includes the ability to use regular expressions on text fields.  This uses POSIX regular expressions.  The Operator is the tilde \u003ccode\u003e~\u003c/code\u003e operator.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eSELECT real_name  \n\tFROM name_list  \n\tWHERE real_name ~ ''[pP]hilip.*'' \n;  \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eNone of these takes account of things like \u0026ldquo;San Francisco\u0026rdquo;  is a single \u0026ldquo;term\u0026rdquo; in the English language.   Also things like \u0026ldquo;the\u0026rdquo; are not words that need to\nbe indexed.  Other languages like French have similar constructs.  PostgreSQL has an extensive set of capabilities for efficiently searching and indexing\ntext data.\u003c/p\u003e\n\n\u003cp\u003eComparable tools are Lucine and Elastisearch.  Google also provides dedicated hardware for this kind of search.  All of these alternatives are very\nexpensive.  Many tolls can benefit from a search like this and at a cost of close to 0 (PostgreSQL is open source) this makes for a very interning\nalternative.\u003c/p\u003e\n\n\u003ch2\u003etsvector\u003c/h2\u003e\n\n\u003cp\u003eThe database uses a pair of values and an index.  The first of these is a \u003ccode\u003etsvector\u003c/code\u003e.  This converts text into a set of words and locations.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eSELECT to_tsvector(''The quick brown fox jumped over the lazy dog.'');   \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eWill result in\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003e                      to_tsvector                       \n------------------------------------------------------- \n ''brown'':3 ''dog'':9 ''fox'':4 ''jump'':5 ''lazi'':8 ''quick'':2 \n(1 row) \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eThis set of data has \u0026ldquo;The\u0026rdquo; eliminated the \u0026ldquo;word\u0026rdquo; location for each word.  The words are converted into the root words.  \u0026ldquo;lazy\u0026rdquo; is\u003cbr /\u003e\nconfuted to \u0026ldquo;lazi\u0026rdquo; the root word.\u003c/p\u003e\n\n\u003ch2\u003etsquery\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003etsquery\u003c/code\u003e is the query side of this along with the \u003ccode\u003e@@\u003c/code\u003e operator.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eSELECT to_tsvector(''The quick brown fox jumped over the lazy dog'')   \n    @@ to_tsquery(''fox'') \n; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eWill return \u0026rsquo;t\u0026rsquo; for true.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eSELECT to_tsvector(''The quick brown fox jumped over the lazy dog'')   \n    @@ to_tsquery(''bob'') \n; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eWill return \u0026lsquo;f\u0026rsquo; for false.\u003c/p\u003e\n\n\u003cp\u003eThe query processing also allows for operators in a query.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eSELECT to_tsvector(''The quick brown fox jumped over the lazy dog'')   \n    @@ to_tsquery(''fox | duck'') \n; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eWill return \u0026rsquo;t\u0026rsquo; for true.\u003c/p\u003e\n\n\u003cp\u003eThere are and, \u003ccode\u003e\u0026amp;\u003c/code\u003e, or, \u003ccode\u003e|\u003c/code\u003e and  not, \u003ccode\u003e!\u003c/code\u003e operators.\u003c/p\u003e\n\n\u003ch2\u003eAs a table\u003c/h2\u003e\n\n\u003cp\u003eLet\u0026rsquo;s put the tsvector data type into a table and add some data.\u003c/p\u003e\n\n\u003cp\u003eRun the file \u003ccode\u003ehw38_07.sql\u003c/code\u003e.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eDROP TABLE if exists indexed_docs ; \n \nCREATE TABLE indexed_docs ( \n\tdoc_id UUID NOT NULL DEFAULT uuid_generate_v4() primary key, \n    document_title TEXT NOT NULL, \n    document_body TEXT NOT NULL, \n    document_tokens TSVECTOR  \n); \n \nINSERT INTO indexed_docs ( document_title, document_body ) values \n\t( ''On Tyrany'', ''A book about how to stop tyrants and how to deal with the devaluation of democracy.'' ), \n\t( ''How Democracies Die'', ''A look at how other democracies around the world have failed.'' ) \n; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eNote the use of the \u003ccode\u003eTSVECTOR\u003c/code\u003e data type.\u003c/p\u003e\n\n\u003cp\u003eThe insert will leave the \u003ccode\u003edocument_tokens\u003c/code\u003e as a null field.  We will have to update the table to set\nthe tokens.  Also note that this ignores the \u0026ldquo;document_body\u0026rdquo; field.  We will get to that in a little bit.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eUPDATE indexed_docs d1   \n\tSET document_tokens = to_tsvector(d1.document_title)   \n\tFROM indexed_docs d2 \n;   \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eLet\u0026rsquo;s query for a pair of words.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eSELECT doc_id, document_title  \n\tFROM indexed_docs   \n\tWHERE document_tokens @@ to_tsquery(''die \u0026amp; democracy'') \n;   \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eHaving to update the table after it is changed is far from ideal.   Let\u0026rsquo;s replace this with\na trigger so that the tokens are always updated.    Also we will add a ranking and  the \u003ccode\u003edocument_body\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003eRun the file \u003ccode\u003ehw38_10.sql\u003c/code\u003e:\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eCREATE OR REPLACE function indexed_docs_ins_upd() \nRETURNS trigger AS $$ \nDECLARE \n\tl_lang text; \nBEGIN \n\tl_lang = ''english''; \n\tNEW.document_tokens =  \n\t\tsetweight ( to_tsvector ( l_lang::regconfig, coalesce(NEW.document_title,'''')), ''A'' ) ||\n\t\tsetweight ( to_tsvector ( l_lang::regconfig, coalesce(NEW.document_body,'''')), ''B'' ) \n\t; \n\tRETURN NEW; \nEND \n$$ LANGUAGE ''plpgsql''; \n \n \nDROP TRIGGER if exists  indexd_docs_trig_1 on indexed_docs; \n \nCREATE TRIGGER indexd_docs_trig_1 \n\tBEFORE insert or update ON indexed_docs \n\tFOR EACH ROW \n\tEXECUTE PROCEDURE indexed_docs_ins_upd() \n; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eand we will add some data to verify that the trigger works.\u003c/p\u003e\n\n\u003cp\u003eRun the file \u003ccode\u003ehw38_11.sql\u003c/code\u003e:\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eINSERT INTO indexed_docs ( document_title, document_body ) values \n\t( ''Kleptopia: How Dirty Money Is Conquering the World'', ''How the flow of dirty money is chaing world politics''), \n\t( ''The End of Democracies'', ''How democracies aroudn the world are failing.'' ) \n; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eA select on the indexed_documents will show that all 4 rows have the \u003ccode\u003edocument_tokens\u003c/code\u003e field\u003cbr /\u003e\nfilled in.\u003c/p\u003e\n\n\u003cp\u003eNow add an index to the field so that searches will be fast.\u003c/p\u003e\n\n\u003cp\u003eRun the file \u003ccode\u003ehw38_12.sql\u003c/code\u003e:\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eCREATE INDEX if not exists indexed_docs_tsv_1 ON indexed_docs USING GIN (document_tokens);   \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003ch4\u003eTags: \u0026ldquo;reverse key index\u0026rdquo;,\u0026ldquo;like\u0026rdquo;,\u0026ldquo;keyword\u0026rdquo;\u003c/h4\u003e\n","Lesson_no":38}' where title_id = '8b2af9ee-6891-4528-447c-9929b89bd1c7';


insert into a03_title (id, title) values ( '9021aa4e-9776-495d-5459-e7abcc9aad4e', 'Interactive - 39 - materialized views'); --x1--
insert into a03_tag ( id, tag ) values ( '80b037d5-d658-4508-42b8-8f71e5eccd7b', 'materialized view' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '80b037d5-d658-4508-42b8-8f71e5eccd7b', '9021aa4e-9776-495d-5459-e7abcc9aad4e' );
insert into ct_file_list ( file_list_id) values ( '365a0b5b-6efe-4fd8-765a-3e9026d5d194', 39, 'hw39_0.sql' );
insert into ct_file_list ( file_list_id) values ( 'abf3160c-96a2-4332-6bc9-fae2af79bd28', 39, 'hw39_2.sql' );
update a03_title set body = '{"Lesson":"\u003cstyle\u003e \n.pagebreak { page-break-before: always; } \n.half { height: 200px; } \n\u003c/style\u003e \n \n\n\u003ch1\u003eInteractive - 39 - materialized views\u003c/h1\u003e\n\n\u003cp\u003eOne of the ways that you can improve performance in PostgreSQL and other SQL databases is a materialized view.\nA regular view is a kind of \u0026ldquo;macro\u0026rdquo; that replaces the query\u0026rsquo;s from with the body of the view.\u003c/p\u003e\n\n\u003cp\u003eIn a materialized view the data itself is copied into the \u0026ldquo;view\u0026rdquo; and you can add indexes and other things\nthat optimize queries on this set of data.\u003c/p\u003e\n\n\u003cp\u003eThe downsize to materialized views is that the data can get out of sync with the original data.\u003c/p\u003e\n\n\u003cp\u003eMaterialized views are very useful when the source of the data is a foreign data wrapper.  Especially\nwhen the foreign data is slow or only periodically changes.\u003c/p\u003e\n\n\u003cp\u003eLet\u0026rsquo;s use our table with some names in it. (From Interactive Homework 08)\u003c/p\u003e\n\n\u003cp\u003eRun File \u003ccode\u003ehw39_0.sql\u003c/code\u003e:\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eCREATE EXTENSION if not exists \u0026quot;uuid-ossp\u0026quot;; \nCREATE EXTENSION if not exists pgcrypto; \n \nDROP TABLE if exists name_list ; \n \nCREATE TABLE name_list ( \n\tname_list_id UUID NOT NULL DEFAULT uuid_generate_v4() primary key, \n\treal_name text check ( length(real_name) \u0026gt;= 1 ) not null, \n\tage int check ( age \u0026gt; 0 and age \u0026lt; 154 ) not  null,\t \n\tstate char varying (2) not null, \n\tpay numeric(10,2)  \n); \n \nCREATE INDEX name_list_idx1 on name_list ( real_name ); \nCREATE INDEX user_real_name_ci_idx1 ON name_list ((lower(real_name))); \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eFirst let\u0026rsquo;s refresh the data in name_list so that we know what is in it.\u003c/p\u003e\n\n\u003cp\u003eRun File \u003ccode\u003ehw39_2.sql\u003c/code\u003e:\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eDELETE FROM name_list ; \n \nINSERT INTO name_list ( real_name, age, state, pay ) values \n\t( ''Bob True'',            22, ''WY'', 31000 ), \n\t( ''Jane True'',           20, ''WY'', 28000 ), \n\t( ''Tom Ace'',             31, ''NJ'', 82500 ), \n\t( ''Steve Pen'',           33, ''NJ'', 89400 ), \n\t( ''Laura Jean Alkinoos'', 34, ''PA'', 120000 ), \n\t( ''Philip Schlump'',      62, ''WY'', 101200 ), \n\t( ''Liz Trubune'',         30, ''WY'', 48000 ), \n\t( ''Lary Smith'',          58, ''NJ'', 48000 ), \n\t( ''Dave Dave'',           21, ''NJ'', 48000 ), \n\t( ''Laura Ann Alkinoos'',  34, ''PA'', 48000 ) \n; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eNow a materialize view that rolls up the count of the number of names in each state.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eDROP materialized view count_by_state_of_names ; \n \nCREATE materialized view count_by_state_of_names as \n\tSELECT count(1) as count_by_state, \n\t\tstate \n\tFROM name_list \n\tGROUP BY state \n; \nCREATE INDEX count_by_state_of_names_p1 on count_by_state_of_names ( count_by_state ); \nCREATE INDEX count_by_state_of_names_p2 on count_by_state_of_names ( state ); \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eTo refresh a materialized view you use (you need to do a refresh to populate the view for the first time also):\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eREFRESH MATERIALIZED VIEW count_by_state_of_names; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eNow let\u0026rsquo;s select the data:\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003e \nSELECT * from count_by_state_of_names ; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eYou should get back 3 rows.\u003c/p\u003e\n\n\u003ch4\u003eTags: \u0026ldquo;materialized view\u0026rdquo;\u003c/h4\u003e\n","Lesson_no":39}' where title_id = '9021aa4e-9776-495d-5459-e7abcc9aad4e';


insert into a03_title (id, title) values ( '5066099d-35b5-4d4d-502a-9c7211d0a3db', 'Interactive - 40 - refresh materialized view'); --x1--
insert into a03_title_to_tag ( tag_id, title_id ) values ( '80b037d5-d658-4508-42b8-8f71e5eccd7b', '5066099d-35b5-4d4d-502a-9c7211d0a3db' );
update a03_title set body = '{"Lesson":"\u003cstyle\u003e \n.pagebreak { page-break-before: always; } \n.half { height: 200px; } \n\u003c/style\u003e \n \n\n\u003ch1\u003eInteractive - 40 - refresh materialized view\u003c/h1\u003e\n\n\u003cp\u003eLast time we created a materialized view, \u003ccode\u003ecount_by_state_of_names\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003eThis time let\u0026rsquo;s refresh it with new data.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eREFRESH MATERIALIZED VIEW count_by_state_of_names; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eMaterialized views don\u0026rsquo;t change when the underlying data changes.\u003cbr /\u003e\nYou have to refresh them.\u003c/p\u003e\n\n\u003ch4\u003eTags: \u0026ldquo;materialized view\u0026rdquo;\u003c/h4\u003e\n","Lesson_no":40}' where title_id = '5066099d-35b5-4d4d-502a-9c7211d0a3db';


insert into a03_title (id, title) values ( 'dbad7046-4831-43c1-7572-cea90054a175', 'Interactive - 41 - case/when - if in projected columns'); --x1--
insert into a03_tag ( id, tag ) values ( 'dba7b31f-ce09-4fed-73a8-d684f2adb7c3', 'when' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( 'dba7b31f-ce09-4fed-73a8-d684f2adb7c3', 'dbad7046-4831-43c1-7572-cea90054a175' );
insert into a03_tag ( id, tag ) values ( 'c627f2ce-ccd4-40e2-591a-47bbcc90428f', 'projected data' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( 'c627f2ce-ccd4-40e2-591a-47bbcc90428f', 'dbad7046-4831-43c1-7572-cea90054a175' );
update a03_title set body = '{"Lesson":"\u003cstyle\u003e \n.pagebreak { page-break-before: always; } \n.half { height: 200px; } \n\u003c/style\u003e \n \n\n\u003ch1\u003eInteractive - 41 - case/when - if in projected columns\u003c/h1\u003e\n\n\u003cp\u003eYou can change the return values in the projected columns.\u003c/p\u003e\n\n\u003cp\u003eFor example if you want to map certain values to new values in a query.\nAn example with the name_list table is to create a new column that is\nan in-Wyoming column.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eSELECT \n\t\t  t1.real_name \n\t\t, t1.state \n\t\t, case \n\t\t\twhen t1.state = ''WY'' then ''y'' \n\t\t\twhen t1.state is null then ''n'' \n\t\t\telse ''n'' \n\t\t  end as \u0026quot;in_wyoming\u0026quot; \n\tFROM name_list as t1 \n; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003ch4\u003eTags: \u0026ldquo;when\u0026rdquo;,\u0026ldquo;projected data\u0026rdquo;\u003c/h4\u003e\n","Lesson_no":41}' where title_id = 'dbad7046-4831-43c1-7572-cea90054a175';


insert into a03_title (id, title) values ( '70bf90f4-2a5c-4aff-5965-5ea6ee5772b9', 'Interactive - 42 - foreign data wrapper'); --x1--
insert into a03_tag ( id, tag ) values ( '840778ce-4834-48c7-7def-63128a111682', 'foreign data wrapper' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '840778ce-4834-48c7-7def-63128a111682', '70bf90f4-2a5c-4aff-5965-5ea6ee5772b9' );
insert into a03_tag ( id, tag ) values ( 'd9689c9b-b70b-4d7c-50b5-8093bcf4bc9a', 'csv' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( 'd9689c9b-b70b-4d7c-50b5-8093bcf4bc9a', '70bf90f4-2a5c-4aff-5965-5ea6ee5772b9' );
insert into a03_tag ( id, tag ) values ( '2af4cb63-82bc-4249-7609-ad457bb553c5', 'fdw' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '2af4cb63-82bc-4249-7609-ad457bb553c5', '70bf90f4-2a5c-4aff-5965-5ea6ee5772b9' );
insert into a03_tag ( id, tag ) values ( '1333ec22-d53d-4f0c-66eb-df3033d665b1', 'import data' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '1333ec22-d53d-4f0c-66eb-df3033d665b1', '70bf90f4-2a5c-4aff-5965-5ea6ee5772b9' );
update a03_title set body = '{"Lesson":"\u003cstyle\u003e \n.pagebreak { page-break-before: always; } \n.half { height: 200px; } \n\u003c/style\u003e \n \n\n\u003ch1\u003eInteractive - 42 - foreign data wrapper\u003c/h1\u003e\n\n\u003cp\u003ePostgreSQL can access data outside of the database.  This is called a foreign data wrapper (FDW).   There are all sorts of foreign data\nwrappers.  You can access data in other databases like Oracle or MySQL.  You can access\ndata in NoSQL databases like MongoDB.     For a full list (of over 30 different kinds of data you can access)\n\u003ca href=\"https://wiki.postgresql.org/wiki/Foreign_data_wrappers\"\u003ehttps://wiki.postgresql.org/wiki/Foreign_data_wrappers\u003c/a\u003e .\u003c/p\u003e\n\n\u003cp\u003eAlso you can use files like comma separated value (CSV) files through the FDW.  There is a file_fdw data wrapper!\u003c/p\u003e\n\n\u003cp\u003eTo set this up you need to create the extension in PostgreSQL.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eCREATE EXTENSION if not exists file_fdw; \nCREATE SERVER import FOREIGN DATA WRAPPER file_fdw; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eThen we can use data on the PostgreSQL server and access it.   There is a file with data on our server at \u003ccode\u003e/home/uw4820/hw42_data.csv\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003eThe data in the file is:\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eabc,def \nghi,jkl \nabc,jkl \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eWe can create a table that matches with this and imports the data.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eDROP FOREIGN TABLE if exits table1_import ; \n \nCREATE FOREIGN TABLE table1_import ( \n\tcol1 text, \n\tcol2 text \n) SERVER import OPTIONS ( filename ''/home/uw4820/hw42_03.csv'', format ''csv'' ); \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eNow we can use standard selects to access the data.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003e \nSELECT * from table1_import; \n \nSELECT * from table1_import where col1 = ''abc''; \n \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eThe limitation on the selects and the table is that it will do a full table scan (slow)\neach time you access the data.  If you want to create indexes on it you need to use\na materialized view or create a new table with the data in it.  Then create indexes\nand other data objects based on that table.\u003c/p\u003e\n\n\u003cp\u003eYou can use FDW to access other PostgreSQL databases and other databases in different\nmachines.\u003c/p\u003e\n\n\u003cp\u003eAnother way to access a different database is to use \u003ccode\u003edblink\u003c/code\u003e in a query.  This is\nmore efficient, but can only be used to access database in the same running instance\nof PotreSQL.\u003c/p\u003e\n\n\u003cp\u003eThis is an example of using \u003ccode\u003edblink\u003c/code\u003e - you don\u0026rsquo;t need to run it.  It is just an example.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eSELECT *  \nFROM   table1 as t1  \nLEFT   JOIN ( \n   SELECT * \n   FROM dblink(''dbname=database2'',''SELECT t3.id, t3.code FROM table2 as t3'') AS t2(id int, code text) \n) AS t4 ON t4.column = t1.column \n; \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003ch4\u003eTags: \u0026ldquo;foreign data wrapper\u0026rdquo;,\u0026ldquo;csv\u0026rdquo;,\u0026ldquo;fdw\u0026rdquo;,\u0026ldquo;import data\u0026rdquo;\u003c/h4\u003e\n","Lesson_no":42}' where title_id = '70bf90f4-2a5c-4aff-5965-5ea6ee5772b9';


insert into a03_title (id, title) values ( 'a7da2bb1-5bc2-490c-4865-708a138a0751', 'Interactive - 43 - indexes on functions - soundex'); --x1--
insert into a03_tag ( id, tag ) values ( 'e8c77cd7-7198-49d3-6f10-84be798df6ae', 'fuzzy match' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( 'e8c77cd7-7198-49d3-6f10-84be798df6ae', 'a7da2bb1-5bc2-490c-4865-708a138a0751' );
insert into a03_tag ( id, tag ) values ( '3f6e10ae-81dc-4ad3-5353-2e2e2963f704', 'soundex' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '3f6e10ae-81dc-4ad3-5353-2e2e2963f704', 'a7da2bb1-5bc2-490c-4865-708a138a0751' );
insert into a03_tag ( id, tag ) values ( '28c1668d-3ad4-46e4-617e-02e0faa69cc9', 'function based index' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '28c1668d-3ad4-46e4-617e-02e0faa69cc9', 'a7da2bb1-5bc2-490c-4865-708a138a0751' );
insert into ct_file_list ( file_list_id) values ( '8928f00f-fa68-473e-637b-898855cbb8c7', 43, 'hw43_1.sql' );
update a03_title set body = '{"Lesson":"\u003cstyle\u003e \n.pagebreak { page-break-before: always; } \n.half { height: 200px; } \n\u003c/style\u003e \n \n\n\u003ch1\u003eInteractive - 43 - indexes on functions - soundex\u003c/h1\u003e\n\n\u003cp\u003eYou can create indexes on the output of functions then use this\nto quickly lookup a row that matches.  An example of this is\nsoundex - a fuzzy match for a name that is based on a phonetic\nlookup.\u003c/p\u003e\n\n\u003cp\u003eNote: If you need to have an effective name lookup there are\nbetter functions for this - search for \u003ccode\u003efuzzy-match  postgresql\u003c/code\u003e\nand there is a built in library - but the other fuzzy match\nfunctions are much more complex.\u003c/p\u003e\n\n\u003cp\u003eAnother example would be an upper or lower case function\u003cbr /\u003e\napplied to a text field.\u003c/p\u003e\n\n\u003cp\u003eThis example is the how-to build an index using a function.\nSo\u0026hellip;\u003c/p\u003e\n\n\u003cp\u003eThe function is\u0026hellip;\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eCREATE OR REPLACE FUNCTION soundex(input text) RETURNS text \nIMMUTABLE STRICT COST 500 LANGUAGE plpgsql \nAS $$ \nDECLARE \n\tsoundex text = ''''; \n\tchar text; \n\tsymbol text; \n\tlast_symbol text = ''''; \n\tpos int = 1; \nBEGIN \n\tWHILE length(soundex) \u0026lt; 4 LOOP \n\t\tchar = upper(substr(input, pos, 1)); \n\t\tpos = pos + 1; \n\t\tCASE char \n\t\tWHEN '''' THEN \n\t\t\t-- End of input string \n\t\t\tIF soundex = '''' THEN \n\t\t\t\tRETURN ''''; \n\t\t\tELSE \n\t\t\t\tRETURN rpad(soundex, 4, ''0''); \n\t\t\tEND IF; \n\t\tWHEN ''B'', ''F'', ''P'', ''V'' THEN \n\t\t\tsymbol = ''1''; \n\t\tWHEN ''C'', ''G'', ''J'', ''K'', ''Q'', ''S'', ''X'', ''Z'' THEN \n\t\t\tsymbol = ''2''; \n\t\tWHEN ''D'', ''T'' THEN \n\t\t\tsymbol = ''3''; \n\t\tWHEN ''L'' THEN \n\t\t\tsymbol = ''4''; \n\t\tWHEN ''M'', ''N'' THEN \n\t\t\tsymbol = ''5''; \n\t\tWHEN ''R'' THEN \n\t\t\tsymbol = ''6''; \n\t\tELSE \n\t\t\t-- Not a consonant; no output, but next similar consonant will be re-recorded \n\t\t\tsymbol = ''''; \n\t\tEND CASE; \n \n\t\tIF soundex = '''' THEN \n\t\t\t-- First character; only accept strictly English ASCII characters \n\t\t\tIF char ~\u0026gt;=~ ''A'' AND char ~\u0026lt;=~ ''Z'' THEN \n\t\t\t\tsoundex = char; \n\t\t\t\tlast_symbol = symbol; \n\t\t\tEND IF; \n\t\tELSIF last_symbol != symbol THEN \n\t\t\tsoundex = soundex || symbol; \n\t\t\tlast_symbol = symbol; \n\t\tEND IF; \n\tEND LOOP; \n \n\tRETURN soundex; \nEND; \n$$; \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eYou should already have the function loaded.  This function should be setup as part of your account\nso you should not need to run it.  The file if it is not there is hw43_1.sql.\u003c/p\u003e\n\n\u003cp\u003eTo create the index:\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eCREATE INDEX name_list_func_soundex ON name_list (soundex(real_name)); \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eThen to query on this field:\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eSELECT *  \n\tFROM name_list  \n\tWHERE soundex(real_name) = soundex(''philip schlump'') \n; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eThis will use the output from the function to do the query.  This makes for a fast lookup.\u003c/p\u003e\n\n\u003ch4\u003eTags: \u0026ldquo;fuzzy match\u0026rdquo;,\u0026ldquo;soundex\u0026rdquo;,\u0026ldquo;function based index\u0026rdquo;\u003c/h4\u003e\n","Lesson_no":43}' where title_id = 'a7da2bb1-5bc2-490c-4865-708a138a0751';


insert into a03_title (id, title) values ( '9de85b6f-92cf-4c2d-5092-25c7842b6438', 'Interactive - 44 - alter table to add columns, remove columns'); --x1--
insert into a03_tag ( id, tag ) values ( 'f423c8d3-24cf-4d34-7085-ca3edd24dd86', 'alter' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( 'f423c8d3-24cf-4d34-7085-ca3edd24dd86', '9de85b6f-92cf-4c2d-5092-25c7842b6438' );
insert into a03_tag ( id, tag ) values ( '3230ea1b-3df4-4b8b-7544-29fc42ef9a9f', 'add column' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '3230ea1b-3df4-4b8b-7544-29fc42ef9a9f', '9de85b6f-92cf-4c2d-5092-25c7842b6438' );
update a03_title set body = '{"Lesson":"\u003cstyle\u003e \n.pagebreak { page-break-before: always; } \n.half { height: 200px; } \n\u003c/style\u003e \n \n\n\u003ch1\u003eInteractive - 44 - alter table to add columns, remove columns\u003c/h1\u003e\n\n\u003cp\u003eYou can alter tables to add or remove columns or to rename columns.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eDROP TABLE if exists name_list2 ; \nCREATE TABLE name_list2 ( \n\tname_list_id UUID NOT NULL DEFAULT uuid_generate_v4() primary key, \n\treal_name text check ( length(real_name) \u0026gt;= 1 ) not null, \n\tage int check ( age \u0026gt; 0 and age \u0026lt; 154 ) not  null,\t \n\tstate char varying (2) not null, \n\tpay numeric(10,2)  \n); \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eSuppose that you decide that you really need the state name and a state_2letter_code as the columns.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eALTER TABLE name_list2 rename column state to state_2letter_code; \nALTER TABLE name_list2 add column state varchar(50); \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003ch4\u003eTags: \u0026ldquo;alter\u0026rdquo;,\u0026ldquo;add column\u0026rdquo;\u003c/h4\u003e\n","Lesson_no":44}' where title_id = '9de85b6f-92cf-4c2d-5092-25c7842b6438';


insert into a03_title (id, title) values ( '6ec3df05-f1fa-40ff-7158-21a5eeb92f97', 'Interactive - 45 - alter table to add columns, remove columns'); --x1--
insert into a03_title_to_tag ( tag_id, title_id ) values ( 'f423c8d3-24cf-4d34-7085-ca3edd24dd86', '6ec3df05-f1fa-40ff-7158-21a5eeb92f97' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '3230ea1b-3df4-4b8b-7544-29fc42ef9a9f', '6ec3df05-f1fa-40ff-7158-21a5eeb92f97' );
update a03_title set body = '{"Lesson":"\u003cstyle\u003e \n.pagebreak { page-break-before: always; } \n.half { height: 200px; } \n\u003c/style\u003e \n \n\n\u003ch1\u003eInteractive - 45 - alter table to add columns, remove columns\u003c/h1\u003e\n\n\u003cp\u003eUsing the same table, name_list2 lets add a constraint to the us_state table.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eALTER TABLE name_list2 \n\tADD column state_nick_name text \n; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003ch4\u003eTags: \u0026ldquo;alter\u0026rdquo;,\u0026ldquo;add column\u0026rdquo;\u003c/h4\u003e\n","Lesson_no":45}' where title_id = '6ec3df05-f1fa-40ff-7158-21a5eeb92f97';


insert into a03_title (id, title) values ( 'e9fc7260-c1e8-47fc-6ead-307434fcce7c', 'Interactive - 46 -  NULL - differences between databases'); --x1--
insert into a03_tag ( id, tag ) values ( 'e8cefc39-14a3-4523-462a-edebf4154c4a', 'NULL' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( 'e8cefc39-14a3-4523-462a-edebf4154c4a', 'e9fc7260-c1e8-47fc-6ead-307434fcce7c' );
update a03_title set body = '{"Lesson":"\u003cstyle\u003e \n.pagebreak { page-break-before: always; } \n.half { height: 200px; } \n\u003c/style\u003e \n \n\n\u003ch1\u003eInteractive - 46 -  NULL - differences between databases\u003c/h1\u003e\n\n\u003cp\u003eBy now you have noticed that if a column allows you can have NULL values in it.\nThis is a non-data value.\u003c/p\u003e\n\n\u003cp\u003eThe handling of NULL differers just enough between different databases to make\ncode non-portable from database to database (At least it requires a lot of\u003cbr /\u003e\neffort to port).\u003c/p\u003e\n\n\u003cp\u003eFirst thing to no about NULL is that NULL data is not indexed.  So if you go\nlooking for NULL it will result in a full table scan.\u003c/p\u003e\n\n\u003cp\u003eAlso NULL is not equal to anything.  There is a special pair of operators, \u003ccode\u003eIS NULL\u003c/code\u003e and \u003ccode\u003eIS NOT NULL\u003c/code\u003e\nfor checking if a column or value is null.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eSELECT ''found'' where NULL = NULL; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003ewill return 0 rows because NULL is not equal to anything, even itself.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eSELECT ''found'' where NULL is NULL; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003ePostgreSQL provides 2 functions for dealing with nulls.  The first is \u003ccode\u003enullif\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003eIf the 2 arguments are equal then NULL is returned.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eSELECT nullif(1,1); \n \nSELECT nullif(1,2); \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eIf the 2 arguments are NOT equal then the first argument is returned.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eSELECT nullif(1,2); \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eThe second function is \u003ccode\u003ecoalesce\u003c/code\u003e.\nThis function substitutes a default value when the first argument is NULL.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eSELECT coalesce(NULL,2); \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eIf the first argument is NULL then the defalut, in this case 2, is returned.\u003c/p\u003e\n\n\u003cp\u003eIf the first argument is not NULL then the non-null first argument is returned.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eSELECT coalesce(5,2); \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eNote: In the Oracle database you use the \u0026lsquo;nvl\u0026rsquo; function and a special table with 1 row in it called \u0026lsquo;dual\u0026rsquo;;\u003c/p\u003e\n\n\u003ch4\u003eTags: \u0026ldquo;NULL\u0026rdquo;\u003c/h4\u003e\n","Lesson_no":46}' where title_id = 'e9fc7260-c1e8-47fc-6ead-307434fcce7c';


insert into a03_title (id, title) values ( 'e2238ed5-0ac1-483b-7219-b6385ac8ceb2', 'Interactive - 47 - NoSQL databases ( mongoDB ) v.s. JSONb in PostreSQL'); --x1--
insert into a03_tag ( id, tag ) values ( '8d6345da-bf29-400a-6540-96831833dbee', 'JSONb' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '8d6345da-bf29-400a-6540-96831833dbee', 'e2238ed5-0ac1-483b-7219-b6385ac8ceb2' );
insert into a03_tag ( id, tag ) values ( 'e66182e2-b5e7-4c35-7994-e35e05bbac7a', 'MongoDB' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( 'e66182e2-b5e7-4c35-7994-e35e05bbac7a', 'e2238ed5-0ac1-483b-7219-b6385ac8ceb2' );
insert into ct_file_list ( file_list_id) values ( 'afb66c3b-d0a9-491e-4b9c-5d01d37477df', 47, 'hw47_1.sql' );
update a03_title set body = '{"Lesson":"\u003cstyle\u003e \n.pagebreak { page-break-before: always; } \n.half { height: 200px; } \n\u003c/style\u003e \n \n\n\u003ch1\u003eInteractive - 47 - NoSQL databases ( mongoDB ) v.s. JSONb in PostreSQL\u003c/h1\u003e\n\n\u003cp\u003eOne of the most common alternatives to a SQL database is MongoDB.\nFront end developers like MongoDB because everting is in JSON.\u003c/p\u003e\n\n\u003cp\u003eThere are two reasons why I don\u0026rsquo;t use MongoDB.\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eConcurrency control is incredibly important.  Google reviewed\nits code base and counted the number of defects related to bad\u003cbr /\u003e\nimplementations of custom concurrency control.   The problems\nwere bad enough that Google banned the use of MongoDB.\u003c/li\u003e\n\u003cli\u003eEverything that can be done in MogoDB can be done just as\nfast using JSONb data in PostgreSQL.  Also with PostgreSQL\nyou get a complete relational database with tables and\nindexes and spacial data and\u0026hellip;   That other stuff just\nget thrown in.\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eSo\u0026hellip; Let\u0026rsquo;s look at how to use JSONb in PostgreSQL.\u003c/p\u003e\n\n\u003cp\u003eFirst let\u0026rsquo;s create a table.  This is the same as creating a \u0026ldquo;collection\u0026rdquo;\u003cbr /\u003e\nin MongoDB.  The table will use a GIN index to index all of the\u003cbr /\u003e\ndata in the JSON data.  (Run file \u003ccode\u003ehw47_1.sql\u003c/code\u003e)\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003edrop TABLE if exists test_collection ; \n \nCREATE TABLE test_collection ( \n\tid serial primary key not null, \n\tdata JSONB \n); \n \nCREATE INDEX test_collection_gin_1 ON test_collection USING gin (data); \n \nINSERT INTO test_collection ( data ) values\t \n\t( ''{\u0026quot;name\u0026quot;:\u0026quot;bob\u0026quot;}'' ) \n; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003ePostgreSQL has a slew of operators.\u003c/p\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth align=\"center\"\u003eOperator\u003c/th\u003e\n\u003cth\u003eRight Operand Type\u003c/th\u003e\n\u003cth\u003eDescription\u003c/th\u003e\n\u003cth\u003eExample\u003c/th\u003e\n\u003cth\u003eExample Result\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ccode\u003e-\u0026gt;\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003eint\u003c/td\u003e\n\u003ctd\u003eGet JSON array element (indexed from zero, negative integers count from the end)\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003e''[{\u0026quot;a\u0026quot;:\u0026quot;foo\u0026quot;},{\u0026quot;b\u0026quot;:\u0026quot;bar\u0026quot;},{\u0026quot;c\u0026quot;:\u0026quot;baz\u0026quot;}]''::json-\u0026gt;2\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003e{\u0026quot;c\u0026quot;:\u0026quot;baz\u0026quot;}\u003c/code\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ccode\u003e-\u0026gt;\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003etext\u003c/td\u003e\n\u003ctd\u003eGet JSON object field by key\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003e''{\u0026quot;a\u0026quot;: {\u0026quot;b\u0026quot;:\u0026quot;foo\u0026quot;}}''::json-\u0026gt;''a''\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003e{\u0026quot;b\u0026quot;:\u0026quot;foo\u0026quot;}\u003c/code\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ccode\u003e-\u0026gt;\u0026gt;\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003eint\u003c/td\u003e\n\u003ctd\u003eGet JSON array element as text\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003e''[1,2,3]''::json-\u0026gt;\u0026gt;2\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003e3\u003c/code\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ccode\u003e-\u0026gt;\u0026gt;\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003etext\u003c/td\u003e\n\u003ctd\u003eGet JSON object field as text\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003e''{\u0026quot;a\u0026quot;:1,\u0026quot;b\u0026quot;:2}''::json-\u0026gt;\u0026gt;''b''\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003e2\u003c/code\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ccode\u003e#\u0026gt;\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003etext[]\u003c/td\u003e\n\u003ctd\u003eGet JSON object at specified path\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003e''{\u0026quot;a\u0026quot;: {\u0026quot;b\u0026quot;:{\u0026quot;c\u0026quot;: \u0026quot;foo\u0026quot;}}}''::json#\u0026gt;''{a,b}''\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003e{\u0026quot;c\u0026quot;: \u0026quot;foo\u0026quot;}\u003c/code\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ccode\u003e#\u0026gt;\u0026gt;\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003etext[]\u003c/td\u003e\n\u003ctd\u003eGet JSON object at specified path as text\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003e''{\u0026quot;a\u0026quot;:[1,2,3],\u0026quot;b\u0026quot;:[4,5,6]}''::json#\u0026gt;\u0026gt;''{a,2}''\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003e3\u003c/code\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ccode\u003e@\u0026gt;\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003eJSONb\u003c/td\u003e\n\u003ctd\u003eDoes the left JSON value contain the right JSON path/value entries at the top level?\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003e''{\u0026quot;a\u0026quot;:1, \u0026quot;b\u0026quot;:2}''::JSONb @\u0026gt; ''{\u0026quot;b\u0026quot;:2}''::JSONb\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ccode\u003e\u0026lt;@\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003eJSONb\u003c/td\u003e\n\u003ctd\u003eAre the left JSON path/value entries contained at the top level within the right JSON value?\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003e''{\u0026quot;b\u0026quot;:2}''::JSONb \u0026lt;@ ''{\u0026quot;a\u0026quot;:1, \u0026quot;b\u0026quot;:2}''::JSONb\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ccode\u003e?\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003etext\u003c/td\u003e\n\u003ctd\u003eDoes the string exist as a top-level key within the JSON value?\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003e''{\u0026quot;a\u0026quot;:1, \u0026quot;b\u0026quot;:2}''::JSONb ? ''b''\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ccode\u003e?|\u003c/code\u003e`\u003c/td\u003e\n\u003ctd\u003etext[]\u003c/td\u003e\n\u003ctd\u003eDo any of these array strings exist as top-level keys?\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003e''{\u0026quot;a\u0026quot;:1, \u0026quot;b\u0026quot;:2, \u0026quot;c\u0026quot;:3}''::JSONb ?| array[''b'', ''c'']\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ccode\u003e?\u0026amp;\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003etext[]\u003c/td\u003e\n\u003ctd\u003eDo all of these array strings exist as top-level keys?\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003e''[\u0026quot;a\u0026quot;, \u0026quot;b\u0026quot;]''::JSONb ?\u0026amp; array[''a'', ''b'']\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ccode\u003e||\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003eJSONb\u003c/td\u003e\n\u003ctd\u003eConcatenate two JSONb values into a new JSONb value\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003e''[\u0026quot;a\u0026quot;, \u0026quot;b\u0026quot;]''::JSONb || ''[\u0026quot;c\u0026quot;, \u0026quot;d\u0026quot;]''::JSONb\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ccode\u003e-\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003etext\u003c/td\u003e\n\u003ctd\u003eDelete key/value pair or string element from left operand. Key/value pairs are matched based on their key value.\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003e''{\u0026quot;a\u0026quot;: \u0026quot;b\u0026quot;}''::JSONb - ''a''\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ccode\u003e-\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003einteger\u003c/td\u003e\n\u003ctd\u003eDelete the array element with specified index (Negative integers count from the end). Throws an error if top level container is not an array.\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003e''[\u0026quot;a\u0026quot;, \u0026quot;b\u0026quot;]''::JSONb - 1\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ccode\u003e#-\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003etext[]\u003c/td\u003e\n\u003ctd\u003eDelete the field or element with specified path (for JSON arrays, negative integers count from the end)\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003e''[\u0026quot;a\u0026quot;, {\u0026quot;b\u0026quot;:1}]''::JSONb #- ''{1,b}''\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003cp\u003eFor example:\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eSELECT *  \n\tFROM test_collection  \n\tWHERE data-\u0026gt;\u0026gt;''name'' = ''bob'' \n; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eShould return 1 row the name equal to \u003ccode\u003ebob\u003c/code\u003e.\u003c/p\u003e\n\n\u003ch4\u003eTags: \u0026ldquo;JSONb\u0026rdquo;,\u0026ldquo;MongoDB\u0026rdquo;\u003c/h4\u003e\n","Lesson_no":47}' where title_id = 'e2238ed5-0ac1-483b-7219-b6385ac8ceb2';


insert into a03_title (id, title) values ( 'ffb41beb-3396-4533-79ef-d28eaafa7e9e', 'Interactive - 48 - window functions'); --x1--
insert into a03_title_to_tag ( tag_id, title_id ) values ( 'f423c8d3-24cf-4d34-7085-ca3edd24dd86', 'ffb41beb-3396-4533-79ef-d28eaafa7e9e' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '3230ea1b-3df4-4b8b-7544-29fc42ef9a9f', 'ffb41beb-3396-4533-79ef-d28eaafa7e9e' );
update a03_title set body = '{"Lesson":"\u003cstyle\u003e \n.pagebreak { page-break-before: always; } \n.half { height: 200px; } \n\u003c/style\u003e \n \n\n\u003ch1\u003eInteractive - 48 - window functions\u003c/h1\u003e\n\n\u003cp\u003eWindow functions allow operations of a set of data.  First let\u0026rsquo;s setup an example.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003e \nDROP TABLE if exists emp_sal; \n \nCREATE TABLE emp_sal ( \n\temp_id serial primary key not null, \n\tdept text not null, \n\tsalary numeric \n); \n \nINSERT INTO emp_sal ( dept, emp_id, salary ) values  \n\t( ''Dev''   \t,    11 ,   5200 ), \n\t( ''Dev''   \t,     7 ,   4200 ), \n\t( ''Dev''   \t,     9 ,   4500 ), \n\t( ''Dev''   \t,     8 ,   6000 ), \n\t( ''Dev''   \t,    10 ,   5200 ), \n\t( ''H.R.'' \t,     5 ,   3500 ), \n\t( ''H.R.'' \t,     2 ,   3900 ), \n\t( ''sales''   ,     3 ,   4800 ), \n\t( ''sales''   ,     1 ,   5000 ), \n\t( ''sales''   ,     4 ,   4800 ) \n; \n \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eA window function can be used to calculate the sum of salary across each department.\u003cbr /\u003e\nThis start with the \u003ccode\u003eOVER\u003c/code\u003e operator and a expression of how the data is to be grouped.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eSELECT  \n\t\tdept, \n\t\temp_id, \n\t\tsalary, \n\t\tsum(salary) OVER (PARTITION BY dept)  as  dept_total \n\tFROM emp_sal \n; \n \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003ch4\u003eTags: \u0026ldquo;alter\u0026rdquo;,\u0026ldquo;add column\u0026rdquo;\u003c/h4\u003e\n","Lesson_no":48}' where title_id = 'ffb41beb-3396-4533-79ef-d28eaafa7e9e';


insert into a03_title (id, title) values ( '294c4d6d-f83d-4163-4a8b-2ef9a5c54095', 'Interactive - 49 - PostgreSQL database maintenance'); --x1--
insert into a03_tag ( id, tag ) values ( 'aa807659-feb3-4168-7886-b985d5f5a536', 'vacuum' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( 'aa807659-feb3-4168-7886-b985d5f5a536', '294c4d6d-f83d-4163-4a8b-2ef9a5c54095' );
insert into a03_tag ( id, tag ) values ( '1e5ae91c-e34a-4fbf-67c7-46d95c49c862', 'analyze' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '1e5ae91c-e34a-4fbf-67c7-46d95c49c862', '294c4d6d-f83d-4163-4a8b-2ef9a5c54095' );
update a03_title set body = '{"Lesson":"\u003cstyle\u003e \n.pagebreak { page-break-before: always; } \n.half { height: 200px; } \n\u003c/style\u003e \n \n\n\u003ch1\u003eInteractive - 49 - PostgreSQL database maintenance\u003c/h1\u003e\n\n\u003cp\u003eWhen a table has a substantial change in size the set of statistics\nthat are used to create and optimize queries needs to be updated.\nThis is done with the \u003ccode\u003evacuum\u003c/code\u003e command.\u003c/p\u003e\n\n\u003cp\u003eAlso when deletes occur the data is marked as deleted but the space\nis not reclaimed.   To reclaim the space you need to run a \u003ccode\u003evacuum\u003c/code\u003e\u003cbr /\u003e\non the table or on all tables.   Because this can be a very time\nconsuming process this is often set up to run at an off-peek time.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003evacuum full; \nvacuum analyze name_list; \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003ch4\u003eTags: \u0026ldquo;vacuum\u0026rdquo;,\u0026ldquo;analyze\u0026rdquo;\u003c/h4\u003e\n","Lesson_no":49}' where title_id = '294c4d6d-f83d-4163-4a8b-2ef9a5c54095';


insert into a03_title (id, title) values ( '9ac2fd4c-ca70-4252-6942-20ff425e689d', 'Interactive - 50 - Geometric Data / PostGIS'); --x1--
insert into a03_title_to_tag ( tag_id, title_id ) values ( 'aa807659-feb3-4168-7886-b985d5f5a536', '9ac2fd4c-ca70-4252-6942-20ff425e689d' );
insert into a03_title_to_tag ( tag_id, title_id ) values ( '1e5ae91c-e34a-4fbf-67c7-46d95c49c862', '9ac2fd4c-ca70-4252-6942-20ff425e689d' );
update a03_title set body = '{"Lesson":"\u003cstyle\u003e \n.pagebreak { page-break-before: always; } \n.half { height: 200px; } \n\u003c/style\u003e \n \n\n\u003ch1\u003eInteractive - 50 - Geometric Data / PostGIS\u003c/h1\u003e\n\n\u003cp\u003ePostgreSQL also has a substantial set of constructs that allow both indexing and data storage of points.\nCollectively these base capabilities are built into a very good Geographic Information System, PostGIS.\u003c/p\u003e\n\n\u003cp\u003ePostGIS adds all sorts of fun stuff like projections and data for all the counties in the US.\u003c/p\u003e\n\n\u003cp\u003eBefore using PostGIS you need to understand the basics - like points and lines and that PostgreSQL\ncan store and search spacial data.\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003e \nxyzzy \n \n \n\u003c/code\u003e\u003c/pre\u003e\n\n\u003ch4\u003eTags: \u0026ldquo;vacuum\u0026rdquo;,\u0026ldquo;analyze\u0026rdquo;\u003c/h4\u003e\n","Lesson_no":50}' where title_id = '9ac2fd4c-ca70-4252-6942-20ff425e689d';


